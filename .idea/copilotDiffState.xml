<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/README.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/README.md" />
              <option name="updatedContent" value="# Weather App ️&#10;&#10;Ứng dụng thời tiết Android với thiết kế glassmorphism phong cách iOS, dữ liệu thời tiết real-time và gợi ý trang phục thông minh bằng AI.&#10;&#10;## ✨ Tính Năng&#10;&#10;### Tính Năng Chính&#10;- ️ **Dữ Liệu Thời Tiết Real-time** - Nhiệt độ hiện tại, điều kiện thời tiết và dự báo&#10;-  **Thời Tiết Theo Vị Trí** - Tự động phát hiện vị trí hoặc tìm kiếm thành phố&#10;-  **Thông Số Thời Tiết Chi Tiết** - Chỉ số UV, độ ẩm, tốc độ gió, áp suất, tầm nhìn xa&#10;-  **Dự Báo Theo Giờ &amp; Tuần** - Dự đoán thời tiết toàn diện&#10;-  **Thời Gian Mặt Trời Mọc/Lặn** - Hiển thị sunrise/sunset đẹp mắt&#10;-  **Chỉ Số Chất Lượng Không Khí** - Theo dõi AQI khu vực của bạn&#10;- ⚠️ **Cảnh Báo Thời Tiết** - Thông báo về các cảnh báo thời tiết nguy hiểm&#10;&#10;### Tính Năng Premium&#10;-  **Gợi Ý Trang Phục AI** - Đề xuất quần áo thông minh dựa trên thời tiết&#10;-  **Biểu Đồ Thời Tiết** - Trực quan hóa xu hướng thời tiết&#10;-  **Nền Động** - Hình nền thay đổi theo thời tiết&#10;- ❤️ **Quản Lý Thành Phố Yêu Thích** - Lưu và theo dõi nhiều địa điểm&#10;-  **Widget** - Widget màn hình chính hiển thị thời tiết nhanh&#10;-  **Thông Báo Thời Tiết** - Nhận cảnh báo và cập nhật thời tiết&#10;&#10;##  Thiết Kế&#10;&#10;### Điểm Nổi Bật UI/UX&#10;- **Giao Diện Phong Cách iOS** - Thiết kế sạch sẽ, hiện đại và trực quan&#10;- **Hiệu Ứng Glassmorphism** - Các thành phần UI kính mờ với backdrop blur&#10;- **Typography Cao Cấp** - Phân cấp văn bản được thiết kế cẩn thận&#10;- **Animation Mượt Mà** - Chuyển đổi và tương tác mượt mà&#10;- **Dark Overlay Design** - Khả năng đọc được nâng cao với overlay thanh lịch&#10;&#10;### Hệ Thống Thiết Kế&#10;- Card glassmorphic tùy chỉnh&#10;- Nền gradient đẹp mắt&#10;- Chỉ báo thời tiết dựa trên icon&#10;- Layout responsive cho mọi kích thước màn hình&#10;&#10;## ️ Kiến Trúc Dự Án&#10;&#10;```&#10;app/src/main/java/com/example/weatherapp/&#10;├── ui/&#10;│   ├── activities/          # Các Activity&#10;│   │   ├── MainActivity.java&#10;│   │   ├── SettingsActivity.java&#10;│   │   ├── SearchActivity.java&#10;│   │   ├── OutfitSuggestionActivity.java&#10;│   │   ├── WeatherDetailsActivity.java&#10;│   │   ├── ChartsActivity.java&#10;│   │   └── FavoriteCitiesActivity.java&#10;│   └── adapters/           # Các Adapter&#10;│       ├── OutfitSuggestionAdapter.java&#10;│       └── CityWeatherAdapter.java&#10;├── data/&#10;│   ├── models/             # Data Models&#10;│   │   ├── HourlyForecast.java&#10;│   │   ├── WeeklyForecast.java&#10;│   │   ├── WeatherAlert.java&#10;│   │   ├── OutfitSuggestion.java&#10;│   │   ├── FavoriteCity.java&#10;│   │   └── CityWeather.java&#10;│   ├── api/                # API Services&#10;│   │   ├── WeatherApiService.java&#10;│   │   ├── OpenAIService.java&#10;│   │   └── RetrofitClient.java&#10;│   └── responses/          # API Response Models&#10;│       ├── WeatherResponse.java&#10;│       ├── HourlyForecastResponse.java&#10;│       ├── WeatherAlertsResponse.java&#10;│       ├── UVIndexResponse.java&#10;│       ├── AirQualityResponse.java&#10;│       ├── OpenAIResponse.java&#10;│       └── OpenAIRequest.java&#10;├── utils/                  # Utility Classes&#10;│   ├── LocaleHelper.java&#10;│   ├── BlurHelper.java&#10;│   ├── FavoriteCitiesManager.java&#10;│   └── OutfitSuggestionService.java&#10;├── notification/           # Notification System&#10;│   ├── WeatherNotificationManager.java&#10;│   ├── WeatherNotificationWorker.java&#10;│   └── NotificationReceiver.java&#10;└── widget/                 # Home Screen Widget&#10;    └── WeatherWidget.java&#10;```&#10;&#10;## ️ Công Nghệ&#10;&#10;- **Ngôn Ngữ**: Java&#10;- **Nền Tảng**: Android (API 24+)&#10;- **Kiến Trúc**: Clean Architecture với package structure chuẩn&#10;- **UI Framework**: Native Android XML layouts&#10;- **Weather API**: OpenWeatherMap API&#10;- **AI API**: OpenAI GPT cho gợi ý trang phục&#10;- **Location Services**: Android Location API&#10;- **Networking**: Retrofit 2&#10;- **Background Tasks**: WorkManager&#10;- **Data Persistence**: SharedPreferences &amp; File Storage&#10;&#10;##  Yêu Cầu&#10;&#10;- Android Studio Arctic Fox trở lên&#10;- Android SDK API 24+ (Android 7.0)&#10;- OpenWeatherMap API Key&#10;- OpenAI API Key (cho tính năng AI)&#10;- Kết nối Internet&#10;&#10;##  Cài Đặt&#10;&#10;1. **Clone repository**&#10;   ```bash&#10;   git clone https://github.com/nichikei/weather-app.git&#10;   cd weather-app&#10;   ```&#10;&#10;2. **Mở project trong Android Studio**&#10;   - File → Open → Chọn thư mục project&#10;&#10;3. **Cấu hình API Keys**&#10;   - Tạo file `local.properties` (nếu chưa có)&#10;   - Thêm API keys của bạn:&#10;   ```properties&#10;   OPENWEATHER_API_KEY=your_openweather_api_key_here&#10;   OPENAI_API_KEY=your_openai_api_key_here&#10;   ```&#10;&#10;4. **Build project**&#10;   - Build → Clean Project&#10;   - Build → Rebuild Project&#10;&#10;5. **Chạy ứng dụng**&#10;   - Chọn device/emulator&#10;   - Run → Run 'app'&#10;&#10;##  Cách Sử Dụng&#10;&#10;1. **Lần Đầu Mở App**&#10;   - Cấp quyền truy cập vị trí&#10;   - App sẽ tự động lấy thời tiết vị trí hiện tại&#10;&#10;2. **Tìm Kiếm Thành Phố**&#10;   - Nhấn icon tìm kiếm ở top bar&#10;   - Nhập tên thành phố&#10;   - Chọn từ kết quả tìm kiếm&#10;&#10;3. **Xem Dự Báo**&#10;   - Vuốt cards để xem dự báo theo giờ/tuần&#10;   - Nhấn vào card để xem chi tiết&#10;&#10;4. **Gợi Ý Trang Phục**&#10;   - Nhấn icon trang phục để xem gợi ý AI&#10;   - Dựa trên nhiệt độ, thời tiết và hoạt động&#10;&#10;5. **Cài Đặt**&#10;   - Nhấn icon cài đặt&#10;   - Tùy chỉnh đơn vị (°C/°F)&#10;   - Bật/tắt thông báo&#10;   - Quản lý thành phố yêu thích&#10;&#10;##  Roadmap&#10;&#10;- [ ] Thêm nhiều ngôn ngữ (tiếng Anh, v.v.)&#10;- [ ] Tích hợp Material You dynamic colors&#10;- [ ] Chế độ offline với cache&#10;- [ ] Radar thời tiết&#10;- [ ] Chia sẻ thông tin thời tiết lên social media&#10;- [ ] Widget nâng cao với nhiều layout&#10;&#10;##  Đóng Góp&#10;&#10;Mọi đóng góp đều được chào đón!&#10;&#10;1. Fork repository&#10;2. Tạo branch mới (`git checkout -b feature/AmazingFeature`)&#10;3. Commit changes (`git commit -m 'Add some AmazingFeature'`)&#10;4. Push lên branch (`git push origin feature/AmazingFeature`)&#10;5. Mở Pull Request&#10;&#10;##  License&#10;&#10;Project này được phân phối dưới MIT License. Xem file `LICENSE` để biết thêm chi tiết.&#10;&#10;##  Tác Giả&#10;&#10;**Nichikei**&#10;- GitHub: [@nichikei](https://github.com/nichikei)&#10;- Repository: [weather-app](https://github.com/nichikei/weather-app)&#10;&#10;##  Cảm Ơn&#10;&#10;- [OpenWeatherMap](https://openweathermap.org/) - Weather data API&#10;- [OpenAI](https://openai.com/) - AI outfit suggestions&#10;- [Flaticon](https://www.flaticon.com/) - Weather icons&#10;- [Unsplash](https://unsplash.com/) - Background images&#10;&#10;---&#10;&#10;⭐ Nếu bạn thấy project này hữu ích, hãy cho một star nhé!&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/data/api/OpenAIService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/data/api/OpenAIService.java" />
              <option name="updatedContent" value="package com.example.weatherapp.data.api;&#10;&#10;import com.example.weatherapp.data.responses.OpenAIRequest;&#10;import com.example.weatherapp.data.responses.OpenAIResponse;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.http.Body;&#10;import retrofit2.http.Header;&#10;import retrofit2.http.POST;&#10;&#10;public interface OpenAIService {&#10;    @POST(&quot;v1/chat/completions&quot;)&#10;    Call&lt;OpenAIResponse&gt; getChatCompletion(&#10;            @Header(&quot;Authorization&quot;) String authorization,&#10;            @Body OpenAIRequest request&#10;    );&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/data/api/RetrofitClient.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/data/api/RetrofitClient.java" />
              <option name="updatedContent" value="package com.example.weatherapp.data.api;&#10;&#10;import java.util.concurrent.TimeUnit;&#10;&#10;import okhttp3.OkHttpClient;&#10;import retrofit2.Retrofit;&#10;import retrofit2.converter.gson.GsonConverterFactory;&#10;&#10;public class RetrofitClient {&#10;    private static final String BASE_URL = &quot;https://api.openweathermap.org/data/2.5/&quot;;&#10;    private static RetrofitClient instance;&#10;    private final Retrofit retrofit;&#10;&#10;    private RetrofitClient() {&#10;        // Cấu hình OkHttpClient với timeout để tránh network timeout&#10;        OkHttpClient okHttpClient = new OkHttpClient.Builder()&#10;                .connectTimeout(30, TimeUnit.SECONDS) // Timeout khi kết nối - 30 giây&#10;                .readTimeout(30, TimeUnit.SECONDS)    // Timeout khi đọc dữ liệu - 30 giây&#10;                .writeTimeout(30, TimeUnit.SECONDS)   // Timeout khi ghi dữ liệu - 30 giây&#10;                .retryOnConnectionFailure(true)       // Tự động retry khi lỗi kết nối&#10;                .build();&#10;&#10;        retrofit = new Retrofit.Builder()&#10;                .baseUrl(BASE_URL)&#10;                .client(okHttpClient)  // Thêm OkHttpClient với timeout config&#10;                .addConverterFactory(GsonConverterFactory.create())&#10;                .build();&#10;    }&#10;&#10;    public static synchronized RetrofitClient getInstance() {&#10;        if (instance == null) {&#10;            instance = new RetrofitClient();&#10;        }&#10;        return instance;&#10;    }&#10;&#10;    public WeatherApiService getWeatherApi() {&#10;        return retrofit.create(WeatherApiService.class);&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/data/api/WeatherApiService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/data/api/WeatherApiService.java" />
              <option name="originalContent" value="package com.example.weatherapp.data.api;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.http.GET;&#10;import retrofit2.http.Query;&#10;&#10;public interface WeatherApiService {&#10;    @GET(&quot;weather&quot;)&#10;    Call&lt;WeatherResponse&gt; getWeatherByCity(&#10;            @Query(&quot;q&quot;) String cityName,&#10;            @Query(&quot;appid&quot;) String apiKey,&#10;            @Query(&quot;units&quot;) String units&#10;    );&#10;&#10;    @GET(&quot;weather&quot;)&#10;    Call&lt;WeatherResponse&gt; getWeatherByCoordinates(&#10;            @Query(&quot;lat&quot;) double latitude,&#10;            @Query(&quot;lon&quot;) double longitude,&#10;            @Query(&quot;appid&quot;) String apiKey,&#10;            @Query(&quot;units&quot;) String units&#10;    );&#10;&#10;    @GET(&quot;forecast&quot;)&#10;    Call&lt;HourlyForecastResponse&gt; getHourlyForecast(&#10;            @Query(&quot;q&quot;) String cityName,&#10;            @Query(&quot;appid&quot;) String apiKey,&#10;            @Query(&quot;units&quot;) String units&#10;    );&#10;&#10;    @GET(&quot;forecast&quot;)&#10;    Call&lt;HourlyForecastResponse&gt; getHourlyForecastByCoordinates(&#10;            @Query(&quot;lat&quot;) double latitude,&#10;            @Query(&quot;lon&quot;) double longitude,&#10;            @Query(&quot;appid&quot;) String apiKey,&#10;            @Query(&quot;units&quot;) String units&#10;    );&#10;&#10;    @GET(&quot;uvi&quot;)&#10;    Call&lt;UVIndexResponse&gt; getUVIndex(&#10;            @Query(&quot;lat&quot;) double lat,&#10;            @Query(&quot;lon&quot;) double lon,&#10;            @Query(&quot;appid&quot;) String apiKey&#10;    );&#10;&#10;    @GET(&quot;air_pollution&quot;)&#10;    Call&lt;AirQualityResponse&gt; getAirQuality(&#10;            @Query(&quot;lat&quot;) double lat,&#10;            @Query(&quot;lon&quot;) double lon,&#10;            @Query(&quot;appid&quot;) String apiKey&#10;    );&#10;&#10;    @GET(&quot;onecall&quot;)&#10;    Call&lt;WeatherAlertsResponse&gt; getWeatherAlerts(&#10;            @Query(&quot;lat&quot;) double lat,&#10;            @Query(&quot;lon&quot;) double lon,&#10;            @Query(&quot;appid&quot;) String apiKey,&#10;            @Query(&quot;exclude&quot;) String exclude&#10;    );&#10;}&#10;&#10;&#10;" />
              <option name="updatedContent" value="package com.example.weatherapp.data.api;&#10;&#10;import com.example.weatherapp.data.responses.AirQualityResponse;&#10;import com.example.weatherapp.data.responses.HourlyForecastResponse;&#10;import com.example.weatherapp.data.responses.UVIndexResponse;&#10;import com.example.weatherapp.data.responses.WeatherAlertsResponse;&#10;import com.example.weatherapp.data.responses.WeatherResponse;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.http.GET;&#10;import retrofit2.http.Query;&#10;&#10;public interface WeatherApiService {&#10;    @GET(&quot;weather&quot;)&#10;    Call&lt;WeatherResponse&gt; getWeatherByCity(&#10;            @Query(&quot;q&quot;) String cityName,&#10;            @Query(&quot;appid&quot;) String apiKey,&#10;            @Query(&quot;units&quot;) String units&#10;    );&#10;&#10;    @GET(&quot;weather&quot;)&#10;    Call&lt;WeatherResponse&gt; getWeatherByCoordinates(&#10;            @Query(&quot;lat&quot;) double latitude,&#10;            @Query(&quot;lon&quot;) double longitude,&#10;            @Query(&quot;appid&quot;) String apiKey,&#10;            @Query(&quot;units&quot;) String units&#10;    );&#10;&#10;    @GET(&quot;forecast&quot;)&#10;    Call&lt;HourlyForecastResponse&gt; getHourlyForecast(&#10;            @Query(&quot;q&quot;) String cityName,&#10;            @Query(&quot;appid&quot;) String apiKey,&#10;            @Query(&quot;units&quot;) String units&#10;    );&#10;&#10;    @GET(&quot;forecast&quot;)&#10;    Call&lt;HourlyForecastResponse&gt; getHourlyForecastByCoordinates(&#10;            @Query(&quot;lat&quot;) double latitude,&#10;            @Query(&quot;lon&quot;) double longitude,&#10;            @Query(&quot;appid&quot;) String apiKey,&#10;            @Query(&quot;units&quot;) String units&#10;    );&#10;&#10;    @GET(&quot;uvi&quot;)&#10;    Call&lt;UVIndexResponse&gt; getUVIndex(&#10;            @Query(&quot;lat&quot;) double lat,&#10;            @Query(&quot;lon&quot;) double lon,&#10;            @Query(&quot;appid&quot;) String apiKey&#10;    );&#10;&#10;    @GET(&quot;air_pollution&quot;)&#10;    Call&lt;AirQualityResponse&gt; getAirQuality(&#10;            @Query(&quot;lat&quot;) double lat,&#10;            @Query(&quot;lon&quot;) double lon,&#10;            @Query(&quot;appid&quot;) String apiKey&#10;    );&#10;&#10;    @GET(&quot;onecall&quot;)&#10;    Call&lt;WeatherAlertsResponse&gt; getWeatherAlerts(&#10;            @Query(&quot;lat&quot;) double lat,&#10;            @Query(&quot;lon&quot;) double lon,&#10;            @Query(&quot;appid&quot;) String apiKey,&#10;            @Query(&quot;exclude&quot;) String exclude&#10;    );&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/data/models/CityWeather.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/data/models/CityWeather.java" />
              <option name="originalContent" value="package com.example.weatherapp.data.models;&#10;&#10;public class CityWeather {&#10;    private String cityName;&#10;    private String country;&#10;    private String weatherDescription;&#10;    private int temperature;&#10;    private int highTemp;&#10;    private int lowTemp;&#10;    private String iconName;&#10;    private int iconResourceId;&#10;    private int gradientBackground; // Gradient drawable resource for card&#10;&#10;    public CityWeather(String cityName, String country, String weatherDescription,&#10;                       int temperature, int highTemp, int lowTemp, String iconName) {&#10;        this.cityName = cityName;&#10;        this.country = country;&#10;        this.weatherDescription = weatherDescription;&#10;        this.temperature = temperature;&#10;        this.highTemp = highTemp;&#10;        this.lowTemp = lowTemp;&#10;        this.iconName = iconName;&#10;        this.iconResourceId = 0;&#10;        this.gradientBackground = R.drawable.gradient_weather_1; // Default gradient&#10;    }&#10;&#10;    // Full constructor with icon resource and gradient&#10;    public CityWeather(String cityName, String country, String weatherDescription,&#10;                       int temperature, int highTemp, int lowTemp,&#10;                       int iconResourceId, int gradientBackground) {&#10;        this.cityName = cityName;&#10;        this.country = country;&#10;        this.weatherDescription = weatherDescription;&#10;        this.temperature = temperature;&#10;        this.highTemp = highTemp;&#10;        this.lowTemp = lowTemp;&#10;        this.iconName = &quot;&quot;;&#10;        this.iconResourceId = iconResourceId;&#10;        this.gradientBackground = gradientBackground;&#10;    }&#10;&#10;    public String getCityName() {&#10;        return cityName;&#10;    }&#10;&#10;    public String getCountry() {&#10;        return country;&#10;    }&#10;&#10;    public String getWeatherDescription() {&#10;        return weatherDescription;&#10;    }&#10;&#10;    public int getTemperature() {&#10;        return temperature;&#10;    }&#10;&#10;    public int getHighTemp() {&#10;        return highTemp;&#10;    }&#10;&#10;    public int getLowTemp() {&#10;        return lowTemp;&#10;    }&#10;&#10;    public String getIconName() {&#10;        return iconName;&#10;    }&#10;&#10;    public int getIconResourceId() {&#10;        return iconResourceId;&#10;    }&#10;&#10;    public void setIconResourceId(int iconResourceId) {&#10;        this.iconResourceId = iconResourceId;&#10;    }&#10;&#10;    public int getGradientBackground() {&#10;        return gradientBackground;&#10;    }&#10;&#10;    public void setGradientBackground(int gradientBackground) {&#10;        this.gradientBackground = gradientBackground;&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.weatherapp.data.models;&#13;&#10;&#13;&#10;import com.example.weatherapp.R;&#13;&#10;&#13;&#10;public class CityWeather {&#13;&#10;    private String cityName;&#13;&#10;    private String country;&#13;&#10;    private String weatherDescription;&#13;&#10;    private int temperature;&#13;&#10;    private int highTemp;&#13;&#10;    private int lowTemp;&#13;&#10;    private String iconName;&#13;&#10;    private int iconResourceId;&#13;&#10;    private int gradientBackground; // Gradient drawable resource for card&#13;&#10;&#13;&#10;    public CityWeather(String cityName, String country, String weatherDescription,&#13;&#10;                       int temperature, int highTemp, int lowTemp, String iconName) {&#13;&#10;        this.cityName = cityName;&#13;&#10;        this.country = country;&#13;&#10;        this.weatherDescription = weatherDescription;&#13;&#10;        this.temperature = temperature;&#13;&#10;        this.highTemp = highTemp;&#13;&#10;        this.lowTemp = lowTemp;&#13;&#10;        this.iconName = iconName;&#13;&#10;        this.iconResourceId = 0;&#13;&#10;        this.gradientBackground = R.drawable.gradient_weather_1; // Default gradient&#13;&#10;    }&#13;&#10;&#13;&#10;    // Full constructor with icon resource and gradient&#13;&#10;    public CityWeather(String cityName, String country, String weatherDescription,&#13;&#10;                       int temperature, int highTemp, int lowTemp,&#13;&#10;                       int iconResourceId, int gradientBackground) {&#13;&#10;        this.cityName = cityName;&#13;&#10;        this.country = country;&#13;&#10;        this.weatherDescription = weatherDescription;&#13;&#10;        this.temperature = temperature;&#13;&#10;        this.highTemp = highTemp;&#13;&#10;        this.lowTemp = lowTemp;&#13;&#10;        this.iconName = &quot;&quot;;&#13;&#10;        this.iconResourceId = iconResourceId;&#13;&#10;        this.gradientBackground = gradientBackground;&#13;&#10;    }&#13;&#10;&#13;&#10;    public String getCityName() {&#13;&#10;        return cityName;&#13;&#10;    }&#13;&#10;&#13;&#10;    public String getCountry() {&#13;&#10;        return country;&#13;&#10;    }&#13;&#10;&#13;&#10;    public String getWeatherDescription() {&#13;&#10;        return weatherDescription;&#13;&#10;    }&#13;&#10;&#13;&#10;    public int getTemperature() {&#13;&#10;        return temperature;&#13;&#10;    }&#13;&#10;&#13;&#10;    public int getHighTemp() {&#13;&#10;        return highTemp;&#13;&#10;    }&#13;&#10;&#13;&#10;    public int getLowTemp() {&#13;&#10;        return lowTemp;&#13;&#10;    }&#13;&#10;&#13;&#10;    public String getIconName() {&#13;&#10;        return iconName;&#13;&#10;    }&#13;&#10;&#13;&#10;    public int getIconResourceId() {&#13;&#10;        return iconResourceId;&#13;&#10;    }&#13;&#10;&#13;&#10;    public void setIconResourceId(int iconResourceId) {&#13;&#10;        this.iconResourceId = iconResourceId;&#13;&#10;    }&#13;&#10;&#13;&#10;    public int getGradientBackground() {&#13;&#10;        return gradientBackground;&#13;&#10;    }&#13;&#10;&#13;&#10;    public void setGradientBackground(int gradientBackground) {&#13;&#10;        this.gradientBackground = gradientBackground;&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/data/responses/WeatherAlertsResponse.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/data/responses/WeatherAlertsResponse.java" />
              <option name="originalContent" value="package com.example.weatherapp.data.responses;&#10;&#10;import com.google.gson.annotations.SerializedName;&#10;import java.util.List;&#10;&#10;public class WeatherAlertsResponse {&#10;    @SerializedName(&quot;alerts&quot;)&#10;    private List&lt;WeatherAlert&gt; alerts;&#10;&#10;    public List&lt;WeatherAlert&gt; getAlerts() {&#10;        return alerts;&#10;    }&#10;&#10;    public boolean hasAlerts() {&#10;        return alerts != null &amp;&amp; !alerts.isEmpty();&#10;    }&#10;}&#10;&#10;&#10;" />
              <option name="updatedContent" value="package com.example.weatherapp.data.responses;&#10;&#10;import com.example.weatherapp.data.models.WeatherAlert;&#10;import com.google.gson.annotations.SerializedName;&#10;import java.util.List;&#10;&#10;public class WeatherAlertsResponse {&#10;    @SerializedName(&quot;alerts&quot;)&#10;    private List&lt;WeatherAlert&gt; alerts;&#10;&#10;    public List&lt;WeatherAlert&gt; getAlerts() {&#10;        return alerts;&#10;    }&#10;&#10;    public boolean hasAlerts() {&#10;        return alerts != null &amp;&amp; !alerts.isEmpty();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/notification/WeatherNotificationManager.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/notification/WeatherNotificationManager.java" />
              <option name="originalContent" value="package com.example.weatherapp.notification;&#10;&#10;import android.app.NotificationChannel;&#10;import android.app.NotificationManager;&#10;import android.app.PendingIntent;&#10;import android.content.Context;&#10;import android.content.Intent;&#10;import android.os.Build;&#10;&#10;import androidx.core.app.NotificationCompat;&#10;import androidx.core.app.NotificationManagerCompat;&#10;&#10;public class WeatherNotificationManager {&#10;&#10;    private static final String CHANNEL_ID = &quot;weather_alerts&quot;;&#10;    private static final String CHANNEL_NAME = &quot;Weather Alerts&quot;;&#10;    private static final String CHANNEL_DESC = &quot;Notifications for weather updates and alerts&quot;;&#10;    private static final int NOTIFICATION_ID = 1001;&#10;&#10;    private final Context context;&#10;    private final NotificationManagerCompat notificationManager;&#10;&#10;    public WeatherNotificationManager(Context context) {&#10;        this.context = context;&#10;        this.notificationManager = NotificationManagerCompat.from(context);&#10;        createNotificationChannel();&#10;    }&#10;&#10;    private void createNotificationChannel() {&#10;        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {&#10;            NotificationChannel channel = new NotificationChannel(&#10;                    CHANNEL_ID,&#10;                    CHANNEL_NAME,&#10;                    NotificationManager.IMPORTANCE_DEFAULT&#10;            );&#10;            channel.setDescription(CHANNEL_DESC);&#10;            channel.enableVibration(true);&#10;            channel.setShowBadge(true);&#10;&#10;            NotificationManager manager = context.getSystemService(NotificationManager.class);&#10;            if (manager != null) {&#10;                manager.createNotificationChannel(channel);&#10;            }&#10;        }&#10;    }&#10;&#10;    public void showWeatherNotification(String cityName, String temperature, String condition, String weatherIcon) {&#10;        // Intent to open MainActivity when notification is clicked&#10;        Intent intent = new Intent(context, MainActivity.class);&#10;        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);&#10;        PendingIntent pendingIntent = PendingIntent.getActivity(&#10;                context,&#10;                0,&#10;                intent,&#10;                PendingIntent.FLAG_IMMUTABLE | PendingIntent.FLAG_UPDATE_CURRENT&#10;        );&#10;&#10;        // Refresh action&#10;        Intent refreshIntent = new Intent(context, NotificationReceiver.class);&#10;        refreshIntent.setAction(&quot;com.example.weatherapp.ACTION_REFRESH_WEATHER&quot;);&#10;        PendingIntent refreshPendingIntent = PendingIntent.getBroadcast(&#10;                context,&#10;                0,&#10;                refreshIntent,&#10;                PendingIntent.FLAG_IMMUTABLE | PendingIntent.FLAG_UPDATE_CURRENT&#10;        );&#10;&#10;        // Build notification&#10;        NotificationCompat.Builder builder = new NotificationCompat.Builder(context, CHANNEL_ID)&#10;                .setSmallIcon(R.drawable.ic_launcher_foreground)&#10;                .setContentTitle(cityName + &quot; Weather&quot;)&#10;                .setContentText(temperature + &quot; • &quot; + condition)&#10;                .setStyle(new NotificationCompat.BigTextStyle()&#10;                        .bigText(&quot;Current temperature: &quot; + temperature + &quot;\n&quot; +&#10;                                &quot;Condition: &quot; + condition + &quot;\n&quot; +&#10;                                &quot;Tap to see more details&quot;))&#10;                .setPriority(NotificationCompat.PRIORITY_DEFAULT)&#10;                .setContentIntent(pendingIntent)&#10;                .setAutoCancel(true)&#10;                .addAction(R.drawable.ic_launcher_foreground, &quot;Refresh&quot;, refreshPendingIntent)&#10;                .setVibrate(new long[]{0, 500, 200, 500});&#10;&#10;        // Show notification&#10;        try {&#10;            notificationManager.notify(NOTIFICATION_ID, builder.build());&#10;        } catch (SecurityException e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;    public void showWeatherAlert(String title, String message, String alertType) {&#10;        Intent intent = new Intent(context, MainActivity.class);&#10;        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);&#10;        PendingIntent pendingIntent = PendingIntent.getActivity(&#10;                context,&#10;                0,&#10;                intent,&#10;                PendingIntent.FLAG_IMMUTABLE | PendingIntent.FLAG_UPDATE_CURRENT&#10;        );&#10;&#10;        NotificationCompat.Builder builder = new NotificationCompat.Builder(context, CHANNEL_ID)&#10;                .setSmallIcon(R.drawable.ic_launcher_foreground)&#10;                .setContentTitle(title)&#10;                .setContentText(message)&#10;                .setStyle(new NotificationCompat.BigTextStyle().bigText(message))&#10;                .setPriority(NotificationCompat.PRIORITY_HIGH)&#10;                .setContentIntent(pendingIntent)&#10;                .setAutoCancel(true)&#10;                .setVibrate(new long[]{0, 500, 200, 500, 200, 500});&#10;&#10;        try {&#10;            notificationManager.notify(NOTIFICATION_ID + 1, builder.build());&#10;        } catch (SecurityException e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;    public void cancelAllNotifications() {&#10;        notificationManager.cancelAll();&#10;    }&#10;&#10;    public boolean areNotificationsEnabled() {&#10;        return notificationManager.areNotificationsEnabled();&#10;    }&#10;}&#10;&#10;&#10;" />
              <option name="updatedContent" value="package com.example.weatherapp.notification;&#10;&#10;import android.app.NotificationChannel;&#10;import android.app.NotificationManager;&#10;import android.app.PendingIntent;&#10;import android.content.Context;&#10;import android.content.Intent;&#10;import android.os.Build;&#10;&#10;import androidx.core.app.NotificationCompat;&#10;import androidx.core.app.NotificationManagerCompat;&#10;&#10;import com.example.weatherapp.R;&#10;import com.example.weatherapp.ui.activities.MainActivity;&#10;&#10;public class WeatherNotificationManager {&#10;&#10;    private static final String CHANNEL_ID = &quot;weather_alerts&quot;;&#10;    private static final String CHANNEL_NAME = &quot;Weather Alerts&quot;;&#10;    private static final String CHANNEL_DESC = &quot;Notifications for weather updates and alerts&quot;;&#10;    private static final int NOTIFICATION_ID = 1001;&#10;&#10;    private final Context context;&#10;    private final NotificationManagerCompat notificationManager;&#10;&#10;    public WeatherNotificationManager(Context context) {&#10;        this.context = context;&#10;        this.notificationManager = NotificationManagerCompat.from(context);&#10;        createNotificationChannel();&#10;    }&#10;&#10;    private void createNotificationChannel() {&#10;        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {&#10;            NotificationChannel channel = new NotificationChannel(&#10;                    CHANNEL_ID,&#10;                    CHANNEL_NAME,&#10;                    NotificationManager.IMPORTANCE_DEFAULT&#10;            );&#10;            channel.setDescription(CHANNEL_DESC);&#10;            channel.enableVibration(true);&#10;            channel.setShowBadge(true);&#10;&#10;            NotificationManager manager = context.getSystemService(NotificationManager.class);&#10;            if (manager != null) {&#10;                manager.createNotificationChannel(channel);&#10;            }&#10;        }&#10;    }&#10;&#10;    public void showWeatherNotification(String cityName, String temperature, String condition, String weatherIcon) {&#10;        // Intent to open MainActivity when notification is clicked&#10;        Intent intent = new Intent(context, MainActivity.class);&#10;        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);&#10;        PendingIntent pendingIntent = PendingIntent.getActivity(&#10;                context,&#10;                0,&#10;                intent,&#10;                PendingIntent.FLAG_IMMUTABLE | PendingIntent.FLAG_UPDATE_CURRENT&#10;        );&#10;&#10;        // Refresh action&#10;        Intent refreshIntent = new Intent(context, NotificationReceiver.class);&#10;        refreshIntent.setAction(&quot;com.example.weatherapp.ACTION_REFRESH_WEATHER&quot;);&#10;        PendingIntent refreshPendingIntent = PendingIntent.getBroadcast(&#10;                context,&#10;                0,&#10;                refreshIntent,&#10;                PendingIntent.FLAG_IMMUTABLE | PendingIntent.FLAG_UPDATE_CURRENT&#10;        );&#10;&#10;        // Build notification&#10;        NotificationCompat.Builder builder = new NotificationCompat.Builder(context, CHANNEL_ID)&#10;                .setSmallIcon(R.drawable.ic_launcher_foreground)&#10;                .setContentTitle(cityName + &quot; Weather&quot;)&#10;                .setContentText(temperature + &quot; • &quot; + condition)&#10;                .setStyle(new NotificationCompat.BigTextStyle()&#10;                        .bigText(&quot;Current temperature: &quot; + temperature + &quot;\n&quot; +&#10;                                &quot;Condition: &quot; + condition + &quot;\n&quot; +&#10;                                &quot;Tap to see more details&quot;))&#10;                .setPriority(NotificationCompat.PRIORITY_DEFAULT)&#10;                .setContentIntent(pendingIntent)&#10;                .setAutoCancel(true)&#10;                .addAction(R.drawable.ic_launcher_foreground, &quot;Refresh&quot;, refreshPendingIntent)&#10;                .setVibrate(new long[]{0, 500, 200, 500});&#10;&#10;        // Show notification&#10;        try {&#10;            notificationManager.notify(NOTIFICATION_ID, builder.build());&#10;        } catch (SecurityException e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;    public void showWeatherAlert(String title, String message, String alertType) {&#10;        Intent intent = new Intent(context, MainActivity.class);&#10;        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);&#10;        PendingIntent pendingIntent = PendingIntent.getActivity(&#10;                context,&#10;                0,&#10;                intent,&#10;                PendingIntent.FLAG_IMMUTABLE | PendingIntent.FLAG_UPDATE_CURRENT&#10;        );&#10;&#10;        NotificationCompat.Builder builder = new NotificationCompat.Builder(context, CHANNEL_ID)&#10;                .setSmallIcon(R.drawable.ic_launcher_foreground)&#10;                .setContentTitle(title)&#10;                .setContentText(message)&#10;                .setStyle(new NotificationCompat.BigTextStyle().bigText(message))&#10;                .setPriority(NotificationCompat.PRIORITY_HIGH)&#10;                .setContentIntent(pendingIntent)&#10;                .setAutoCancel(true)&#10;                .setVibrate(new long[]{0, 500, 200, 500, 200, 500});&#10;&#10;        try {&#10;            notificationManager.notify(NOTIFICATION_ID + 1, builder.build());&#10;        } catch (SecurityException e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;    public void cancelAllNotifications() {&#10;        notificationManager.cancelAll();&#10;    }&#10;&#10;    public boolean areNotificationsEnabled() {&#10;        return notificationManager.areNotificationsEnabled();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/notification/WeatherNotificationWorker.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/notification/WeatherNotificationWorker.java" />
              <option name="originalContent" value="package com.example.weatherapp.notification;&#10;&#10;import android.content.Context;&#10;import android.content.SharedPreferences;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.work.Worker;&#10;import androidx.work.WorkerParameters;&#10;&#10;import java.util.Locale;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Response;&#10;&#10;public class WeatherNotificationWorker extends Worker {&#10;&#10;    private static final String API_KEY = &quot;bd5e378503939ddaee76f12ad7a97608&quot;;&#10;    private static final String PREFS_NAME = &quot;WeatherAppPrefs&quot;;&#10;    private static final String KEY_LAST_CITY = &quot;last_city&quot;;&#10;    private static final String KEY_NOTIFICATIONS = &quot;notifications&quot;;&#10;&#10;    public WeatherNotificationWorker(@NonNull Context context, @NonNull WorkerParameters params) {&#10;        super(context, params);&#10;    }&#10;&#10;    @NonNull&#10;    @Override&#10;    public Result doWork() {&#10;        Context context = getApplicationContext();&#10;        SharedPreferences prefs = context.getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE);&#10;&#10;        // Check if notifications are enabled&#10;        boolean notificationsEnabled = prefs.getBoolean(KEY_NOTIFICATIONS, true);&#10;        if (!notificationsEnabled) {&#10;            return Result.success();&#10;        }&#10;&#10;        // Get last searched city (default to Hanoi)&#10;        String cityName = prefs.getString(KEY_LAST_CITY, &quot;Hanoi&quot;);&#10;&#10;        // Get temperature unit&#10;        String tempUnit = SettingsActivity.getTemperatureUnit(prefs);&#10;        String units = tempUnit.equals(&quot;celsius&quot;) ? &quot;metric&quot; : &quot;imperial&quot;;&#10;&#10;        try {&#10;            // Fetch weather data&#10;            WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;            Call&lt;WeatherResponse&gt; call = apiService.getWeatherByCity(cityName, API_KEY, units);&#10;            Response&lt;WeatherResponse&gt; response = call.execute();&#10;&#10;            if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                WeatherResponse weather = response.body();&#10;&#10;                // Get weather details&#10;                double temp = weather.getMain().getTemp();&#10;                String condition = weather.getWeather().get(0).getDescription();&#10;                String tempSymbol = tempUnit.equals(&quot;celsius&quot;) ? &quot;°C&quot; : &quot;°F&quot;;&#10;                String temperature = String.format(Locale.getDefault(), &quot;%.0f%s&quot;, temp, tempSymbol);&#10;&#10;                // Show notification&#10;                WeatherNotificationManager notificationManager = new WeatherNotificationManager(context);&#10;                notificationManager.showWeatherNotification(&#10;                        weather.getName(),&#10;                        temperature,&#10;                        capitalizeWords(condition),&#10;                        weather.getWeather().get(0).getIcon()&#10;                );&#10;&#10;                // Check for weather alerts&#10;                checkWeatherAlerts(weather, notificationManager);&#10;&#10;                return Result.success();&#10;            } else {&#10;                return Result.retry();&#10;            }&#10;        } catch (Exception e) {&#10;            e.printStackTrace();&#10;            return Result.failure();&#10;        }&#10;    }&#10;&#10;    private void checkWeatherAlerts(WeatherResponse weather, WeatherNotificationManager notificationManager) {&#10;        // Check for extreme weather conditions&#10;        String mainCondition = weather.getWeather().get(0).getMain().toLowerCase();&#10;        double temp = weather.getMain().getTemp();&#10;        int humidity = weather.getMain().getHumidity();&#10;&#10;        // Temperature alerts&#10;        if (temp &gt; 35) {&#10;            notificationManager.showWeatherAlert(&#10;                    &quot;⚠️ High Temperature Alert&quot;,&#10;                    &quot;Temperature is extremely high (&quot; + (int)temp + &quot;°). Stay hydrated and avoid direct sunlight.&quot;,&#10;                    &quot;high_temp&quot;&#10;            );&#10;        } else if (temp &lt; 0) {&#10;            notificationManager.showWeatherAlert(&#10;                    &quot;❄️ Freezing Temperature Alert&quot;,&#10;                    &quot;Temperature is below freezing (&quot; + (int)temp + &quot;°). Dress warmly and be careful on roads.&quot;,&#10;                    &quot;low_temp&quot;&#10;            );&#10;        }&#10;&#10;        // Storm/Rain alerts&#10;        if (mainCondition.contains(&quot;thunderstorm&quot;)) {&#10;            notificationManager.showWeatherAlert(&#10;                    &quot;⚡ Thunderstorm Alert&quot;,&#10;                    &quot;Thunderstorm detected in your area. Stay indoors and avoid outdoor activities.&quot;,&#10;                    &quot;thunderstorm&quot;&#10;            );&#10;        } else if (mainCondition.contains(&quot;rain&quot;) &amp;&amp; weather.getRain() != null) {&#10;            Double rainfall = weather.getRain().get1h();&#10;            if (rainfall != null &amp;&amp; rainfall &gt; 5) {&#10;                notificationManager.showWeatherAlert(&#10;                        &quot;️ Heavy Rain Alert&quot;,&#10;                        &quot;Heavy rainfall expected. Carry an umbrella and drive carefully.&quot;,&#10;                        &quot;heavy_rain&quot;&#10;                );&#10;            }&#10;        }&#10;&#10;        // High humidity alert&#10;        if (humidity &gt; 85) {&#10;            notificationManager.showWeatherAlert(&#10;                    &quot; High Humidity Alert&quot;,&#10;                    &quot;Humidity is very high (&quot; + humidity + &quot;%). It may feel uncomfortable outside.&quot;,&#10;                    &quot;high_humidity&quot;&#10;            );&#10;        }&#10;    }&#10;&#10;    private String capitalizeWords(String str) {&#10;        String[] words = str.split(&quot;\\s&quot;);&#10;        StringBuilder capitalizedWords = new StringBuilder();&#10;&#10;        for (String word : words) {&#10;            if (!word.isEmpty()) {&#10;                capitalizedWords.append(Character.toUpperCase(word.charAt(0)))&#10;                        .append(word.substring(1))&#10;                        .append(&quot; &quot;);&#10;            }&#10;        }&#10;&#10;        return capitalizedWords.toString().trim();&#10;    }&#10;}&#10;&#10;&#10;" />
              <option name="updatedContent" value="package com.example.weatherapp.notification;&#10;&#10;import android.content.Context;&#10;import android.content.SharedPreferences;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.work.Worker;&#10;import androidx.work.WorkerParameters;&#10;&#10;import com.example.weatherapp.data.api.RetrofitClient;&#10;import com.example.weatherapp.data.api.WeatherApiService;&#10;import com.example.weatherapp.data.responses.WeatherResponse;&#10;import com.example.weatherapp.ui.activities.SettingsActivity;&#10;&#10;import java.util.Locale;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Response;&#10;&#10;public class WeatherNotificationWorker extends Worker {&#10;&#10;    private static final String API_KEY = &quot;bd5e378503939ddaee76f12ad7a97608&quot;;&#10;    private static final String PREFS_NAME = &quot;WeatherAppPrefs&quot;;&#10;    private static final String KEY_LAST_CITY = &quot;last_city&quot;;&#10;    private static final String KEY_NOTIFICATIONS = &quot;notifications&quot;;&#10;&#10;    public WeatherNotificationWorker(@NonNull Context context, @NonNull WorkerParameters params) {&#10;        super(context, params);&#10;    }&#10;&#10;    @NonNull&#10;    @Override&#10;    public Result doWork() {&#10;        Context context = getApplicationContext();&#10;        SharedPreferences prefs = context.getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE);&#10;&#10;        // Check if notifications are enabled&#10;        boolean notificationsEnabled = prefs.getBoolean(KEY_NOTIFICATIONS, true);&#10;        if (!notificationsEnabled) {&#10;            return Result.success();&#10;        }&#10;&#10;        // Get last searched city (default to Hanoi)&#10;        String cityName = prefs.getString(KEY_LAST_CITY, &quot;Hanoi&quot;);&#10;&#10;        // Get temperature unit&#10;        String tempUnit = SettingsActivity.getTemperatureUnit(prefs);&#10;        String units = tempUnit.equals(&quot;celsius&quot;) ? &quot;metric&quot; : &quot;imperial&quot;;&#10;&#10;        try {&#10;            // Fetch weather data&#10;            WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;            Call&lt;WeatherResponse&gt; call = apiService.getWeatherByCity(cityName, API_KEY, units);&#10;            Response&lt;WeatherResponse&gt; response = call.execute();&#10;&#10;            if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                WeatherResponse weather = response.body();&#10;&#10;                // Get weather details&#10;                double temp = weather.getMain().getTemp();&#10;                String condition = weather.getWeather().get(0).getDescription();&#10;                String tempSymbol = tempUnit.equals(&quot;celsius&quot;) ? &quot;°C&quot; : &quot;°F&quot;;&#10;                String temperature = String.format(Locale.getDefault(), &quot;%.0f%s&quot;, temp, tempSymbol);&#10;&#10;                // Show notification&#10;                WeatherNotificationManager notificationManager = new WeatherNotificationManager(context);&#10;                notificationManager.showWeatherNotification(&#10;                        weather.getName(),&#10;                        temperature,&#10;                        capitalizeWords(condition),&#10;                        weather.getWeather().get(0).getIcon()&#10;                );&#10;&#10;                // Check for weather alerts&#10;                checkWeatherAlerts(weather, notificationManager);&#10;&#10;                return Result.success();&#10;            } else {&#10;                return Result.retry();&#10;            }&#10;        } catch (Exception e) {&#10;            e.printStackTrace();&#10;            return Result.failure();&#10;        }&#10;    }&#10;&#10;    private void checkWeatherAlerts(WeatherResponse weather, WeatherNotificationManager notificationManager) {&#10;        // Check for extreme weather conditions&#10;        String mainCondition = weather.getWeather().get(0).getMain().toLowerCase();&#10;        double temp = weather.getMain().getTemp();&#10;        int humidity = weather.getMain().getHumidity();&#10;&#10;        // Temperature alerts&#10;        if (temp &gt; 35) {&#10;            notificationManager.showWeatherAlert(&#10;                    &quot;⚠️ High Temperature Alert&quot;,&#10;                    &quot;Temperature is extremely high (&quot; + (int)temp + &quot;°). Stay hydrated and avoid direct sunlight.&quot;,&#10;                    &quot;high_temp&quot;&#10;            );&#10;        } else if (temp &lt; 0) {&#10;            notificationManager.showWeatherAlert(&#10;                    &quot;❄️ Freezing Temperature Alert&quot;,&#10;                    &quot;Temperature is below freezing (&quot; + (int)temp + &quot;°). Dress warmly and be careful on roads.&quot;,&#10;                    &quot;low_temp&quot;&#10;            );&#10;        }&#10;&#10;        // Storm/Rain alerts&#10;        if (mainCondition.contains(&quot;thunderstorm&quot;)) {&#10;            notificationManager.showWeatherAlert(&#10;                    &quot;⚡ Thunderstorm Alert&quot;,&#10;                    &quot;Thunderstorm detected in your area. Stay indoors and avoid outdoor activities.&quot;,&#10;                    &quot;thunderstorm&quot;&#10;            );&#10;        } else if (mainCondition.contains(&quot;rain&quot;) &amp;&amp; weather.getRain() != null) {&#10;            Double rainfall = weather.getRain().get1h();&#10;            if (rainfall != null &amp;&amp; rainfall &gt; 5) {&#10;                notificationManager.showWeatherAlert(&#10;                        &quot;️ Heavy Rain Alert&quot;,&#10;                        &quot;Heavy rainfall expected. Carry an umbrella and drive carefully.&quot;,&#10;                        &quot;heavy_rain&quot;&#10;                );&#10;            }&#10;        }&#10;&#10;        // High humidity alert&#10;        if (humidity &gt; 85) {&#10;            notificationManager.showWeatherAlert(&#10;                    &quot; High Humidity Alert&quot;,&#10;                    &quot;Humidity is very high (&quot; + humidity + &quot;%). It may feel uncomfortable outside.&quot;,&#10;                    &quot;high_humidity&quot;&#10;            );&#10;        }&#10;    }&#10;&#10;    private String capitalizeWords(String str) {&#10;        String[] words = str.split(&quot;\\s&quot;);&#10;        StringBuilder capitalizedWords = new StringBuilder();&#10;&#10;        for (String word : words) {&#10;            if (!word.isEmpty()) {&#10;                capitalizedWords.append(Character.toUpperCase(word.charAt(0)))&#10;                        .append(word.substring(1))&#10;                        .append(&quot; &quot;);&#10;            }&#10;        }&#10;&#10;        return capitalizedWords.toString().trim();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/activities/ChartsActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/activities/ChartsActivity.java" />
              <option name="originalContent" value="package com.example.weatherapp.ui.activities;&#10;&#10;import android.content.SharedPreferences;&#10;import android.os.Bundle;&#10;import android.widget.ImageButton;&#10;import android.widget.TextView;&#10;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;&#10;import com.github.mikephil.charting.charts.BarChart;&#10;import com.github.mikephil.charting.charts.LineChart;&#10;import com.github.mikephil.charting.components.XAxis;&#10;import com.github.mikephil.charting.data.BarData;&#10;import com.github.mikephil.charting.data.BarDataSet;&#10;import com.github.mikephil.charting.data.BarEntry;&#10;import com.github.mikephil.charting.data.Entry;&#10;import com.github.mikephil.charting.data.LineData;&#10;import com.github.mikephil.charting.data.LineDataSet;&#10;import com.github.mikephil.charting.formatter.ValueFormatter;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;public class ChartsActivity extends AppCompatActivity {&#10;&#10;    private HourlyForecastResponse hourlyForecastData;&#10;    private WeatherResponse currentWeatherData;&#10;    private int currentUVIndex;&#10;    private String windSpeedUnit = &quot;ms&quot;;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_charts);&#10;&#10;        // Get data from intent&#10;        hourlyForecastData = (HourlyForecastResponse) getIntent().getSerializableExtra(&quot;hourly_data&quot;);&#10;        currentWeatherData = (WeatherResponse) getIntent().getSerializableExtra(&quot;current_data&quot;);&#10;        currentUVIndex = getIntent().getIntExtra(&quot;uv_index&quot;, 0);&#10;&#10;        // Load settings&#10;        SharedPreferences prefs = getSharedPreferences(&quot;WeatherAppPrefs&quot;, MODE_PRIVATE);&#10;        windSpeedUnit = SettingsActivity.getWindSpeedUnit(prefs);&#10;&#10;        // Setup back button&#10;        ImageButton btnBack = findViewById(R.id.btnBack);&#10;        if (btnBack != null) {&#10;            btnBack.setOnClickListener(v -&gt; finish());&#10;        }&#10;&#10;        // Update title&#10;        TextView tvTitle = findViewById(R.id.tvChartTitle);&#10;        if (tvTitle != null &amp;&amp; currentWeatherData != null) {&#10;            tvTitle.setText(currentWeatherData.getName() + &quot; - &quot; + getString(R.string.weather_statistics));&#10;        }&#10;&#10;        // Setup all charts&#10;        setupTemperatureChart();&#10;        setupWeatherStatsChart();&#10;        setupRainProbabilityChart();&#10;        setupWindSpeedChart();&#10;        setupHumidityChart();&#10;    }&#10;&#10;    private void setupTemperatureChart() {&#10;        if (hourlyForecastData == null || hourlyForecastData.getList() == null) {&#10;            return;&#10;        }&#10;&#10;        LineChart chart = findViewById(R.id.temperatureChart);&#10;        if (chart == null) return;&#10;&#10;        List&lt;Entry&gt; entries = new ArrayList&lt;&gt;();&#10;&#10;        int count = Math.min(12, hourlyForecastData.getList().size());&#10;        for (int i = 0; i &lt; count; i++) {&#10;            HourlyForecastResponse.HourlyItem item = hourlyForecastData.getList().get(i);&#10;            float temp = (float) item.getMain().getTemp();&#10;            entries.add(new Entry(i, temp));&#10;        }&#10;&#10;        LineDataSet dataSet = new LineDataSet(entries, &quot;Temperature&quot;);&#10;        // Unified purple gradient theme&#10;        dataSet.setColor(0xFF9B6FFF); // Soft purple&#10;        dataSet.setCircleColor(0xFFE2DDFD);&#10;        dataSet.setLineWidth(3.5f);&#10;        dataSet.setCircleRadius(6f);&#10;        dataSet.setDrawCircleHole(true);&#10;        dataSet.setCircleHoleColor(0xFF5B3E9E);&#10;        dataSet.setCircleHoleRadius(3f);&#10;        dataSet.setValueTextSize(11f);&#10;        dataSet.setValueTextColor(0xFFFFFFFF);&#10;        dataSet.setDrawFilled(true);&#10;        dataSet.setFillColor(0xFF7B5EC6);&#10;        dataSet.setFillAlpha(100);&#10;        dataSet.setMode(LineDataSet.Mode.CUBIC_BEZIER);&#10;        dataSet.setCubicIntensity(0.15f);&#10;&#10;        LineData lineData = new LineData(dataSet);&#10;        chart.setData(lineData);&#10;&#10;        setupChart(chart);&#10;        chart.animateXY(1200, 1200);&#10;        chart.invalidate();&#10;    }&#10;&#10;    private void setupWeatherStatsChart() {&#10;        if (currentWeatherData == null) return;&#10;&#10;        BarChart chart = findViewById(R.id.weatherStatsChart);&#10;        if (chart == null) return;&#10;&#10;        List&lt;BarEntry&gt; entries = new ArrayList&lt;&gt;();&#10;        entries.add(new BarEntry(0, currentWeatherData.getMain().getHumidity()));&#10;        entries.add(new BarEntry(1, (float) currentWeatherData.getWind().getSpeed() * 3.6f));&#10;        entries.add(new BarEntry(2, currentWeatherData.getMain().getPressure() / 10f));&#10;        entries.add(new BarEntry(3, currentUVIndex * 10f));&#10;&#10;        BarDataSet dataSet = new BarDataSet(entries, &quot;Weather Stats&quot;);&#10;        // Unified gradient color scheme - cyan to purple&#10;        int[] colors = {0xFF4FC3F7, 0xFF29B6F6, 0xFFFFB347, 0xFFFF6B9D};&#10;        dataSet.setColors(colors);&#10;        dataSet.setValueTextSize(12f);&#10;        dataSet.setValueTextColor(0xFFFFFFFF);&#10;        dataSet.setHighLightAlpha(255);&#10;&#10;        BarData barData = new BarData(dataSet);&#10;        barData.setBarWidth(0.6f);&#10;        chart.setData(barData);&#10;&#10;        setupBarChart(chart);&#10;        chart.animateY(1200);&#10;        chart.invalidate();&#10;    }&#10;&#10;    private void setupRainProbabilityChart() {&#10;        if (hourlyForecastData == null || hourlyForecastData.getList() == null) return;&#10;&#10;        LineChart chart = findViewById(R.id.rainProbabilityChart);&#10;        if (chart == null) return;&#10;&#10;        List&lt;Entry&gt; entries = new ArrayList&lt;&gt;();&#10;        int count = Math.min(12, hourlyForecastData.getList().size());&#10;        for (int i = 0; i &lt; count; i++) {&#10;            HourlyForecastResponse.HourlyItem item = hourlyForecastData.getList().get(i);&#10;            float rainProb = (float) (item.getPop() * 100);&#10;            entries.add(new Entry(i, rainProb));&#10;        }&#10;&#10;        LineDataSet dataSet = new LineDataSet(entries, &quot;Rain Probability&quot;);&#10;        // Unified blue theme for water&#10;        dataSet.setColor(0xFF4FC3F7);&#10;        dataSet.setCircleColor(0xFF81D4FA);&#10;        dataSet.setLineWidth(3.5f);&#10;        dataSet.setCircleRadius(5f);&#10;        dataSet.setDrawCircleHole(true);&#10;        dataSet.setCircleHoleColor(0xFF29B6F6);&#10;        dataSet.setCircleHoleRadius(2.5f);&#10;        dataSet.setDrawFilled(true);&#10;        dataSet.setFillColor(0xFF4FC3F7);&#10;        dataSet.setFillAlpha(100);&#10;        dataSet.setMode(LineDataSet.Mode.CUBIC_BEZIER);&#10;        dataSet.setCubicIntensity(0.15f);&#10;        dataSet.setDrawValues(false);&#10;&#10;        LineData lineData = new LineData(dataSet);&#10;        chart.setData(lineData);&#10;&#10;        setupChart(chart);&#10;        chart.getAxisLeft().setAxisMinimum(0f);&#10;        chart.getAxisLeft().setAxisMaximum(100f);&#10;        chart.animateXY(1200, 1200);&#10;        chart.invalidate();&#10;    }&#10;&#10;    private void setupWindSpeedChart() {&#10;        if (hourlyForecastData == null || hourlyForecastData.getList() == null) return;&#10;&#10;        LineChart chart = findViewById(R.id.windSpeedChart);&#10;        if (chart == null) return;&#10;&#10;        List&lt;Entry&gt; entries = new ArrayList&lt;&gt;();&#10;        int count = Math.min(12, hourlyForecastData.getList().size());&#10;        for (int i = 0; i &lt; count; i++) {&#10;            HourlyForecastResponse.HourlyItem item = hourlyForecastData.getList().get(i);&#10;            float windSpeed = (float) item.getWind().getSpeed();&#10;&#10;            if (windSpeedUnit.equals(&quot;kmh&quot;)) {&#10;                windSpeed = windSpeed * 3.6f;&#10;            }&#10;            entries.add(new Entry(i, windSpeed));&#10;        }&#10;&#10;        LineDataSet dataSet = new LineDataSet(entries, &quot;Wind Speed&quot;);&#10;        // Unified green theme for wind&#10;        dataSet.setColor(0xFF66BB6A);&#10;        dataSet.setCircleColor(0xFF81C784);&#10;        dataSet.setLineWidth(3.5f);&#10;        dataSet.setCircleRadius(5f);&#10;        dataSet.setDrawCircleHole(true);&#10;        dataSet.setCircleHoleColor(0xFF4CAF50);&#10;        dataSet.setCircleHoleRadius(2.5f);&#10;        dataSet.setDrawFilled(true);&#10;        dataSet.setFillColor(0xFF66BB6A);&#10;        dataSet.setFillAlpha(100);&#10;        dataSet.setMode(LineDataSet.Mode.CUBIC_BEZIER);&#10;        dataSet.setCubicIntensity(0.15f);&#10;        dataSet.setDrawValues(false);&#10;&#10;        LineData lineData = new LineData(dataSet);&#10;        chart.setData(lineData);&#10;&#10;        setupChart(chart);&#10;        chart.animateXY(1200, 1200);&#10;        chart.invalidate();&#10;    }&#10;&#10;    private void setupHumidityChart() {&#10;        if (hourlyForecastData == null || hourlyForecastData.getList() == null) return;&#10;&#10;        LineChart chart = findViewById(R.id.humidityChart);&#10;        if (chart == null) return;&#10;&#10;        List&lt;Entry&gt; entries = new ArrayList&lt;&gt;();&#10;        int count = Math.min(12, hourlyForecastData.getList().size());&#10;        for (int i = 0; i &lt; count; i++) {&#10;            HourlyForecastResponse.HourlyItem item = hourlyForecastData.getList().get(i);&#10;            float humidity = (float) item.getMain().getHumidity();&#10;            entries.add(new Entry(i, humidity));&#10;        }&#10;&#10;        LineDataSet dataSet = new LineDataSet(entries, &quot;Humidity&quot;);&#10;        // Unified cyan theme for humidity&#10;        dataSet.setColor(0xFF26C6DA);&#10;        dataSet.setCircleColor(0xFF4DD0E1);&#10;        dataSet.setLineWidth(3.5f);&#10;        dataSet.setCircleRadius(5f);&#10;        dataSet.setDrawCircleHole(true);&#10;        dataSet.setCircleHoleColor(0xFF00BCD4);&#10;        dataSet.setCircleHoleRadius(2.5f);&#10;        dataSet.setDrawFilled(true);&#10;        dataSet.setFillColor(0xFF26C6DA);&#10;        dataSet.setFillAlpha(100);&#10;        dataSet.setMode(LineDataSet.Mode.CUBIC_BEZIER);&#10;        dataSet.setCubicIntensity(0.15f);&#10;        dataSet.setDrawValues(false);&#10;&#10;        LineData lineData = new LineData(dataSet);&#10;        chart.setData(lineData);&#10;&#10;        setupChart(chart);&#10;        chart.getAxisLeft().setAxisMinimum(0f);&#10;        chart.getAxisLeft().setAxisMaximum(100f);&#10;        chart.animateXY(1200, 1200);&#10;        chart.invalidate();&#10;    }&#10;&#10;    private void setupChart(LineChart chart) {&#10;        chart.getDescription().setEnabled(false);&#10;        chart.getLegend().setEnabled(false);&#10;        chart.setDrawGridBackground(false);&#10;        chart.getAxisRight().setEnabled(false);&#10;        chart.getXAxis().setPosition(XAxis.XAxisPosition.BOTTOM);&#10;        chart.getXAxis().setTextColor(0xCCFFFFFF); // Slightly transparent white&#10;        chart.getXAxis().setTextSize(11f);&#10;        chart.getXAxis().setDrawGridLines(false);&#10;        chart.getXAxis().setDrawAxisLine(true);&#10;        chart.getXAxis().setAxisLineColor(0x40FFFFFF);&#10;        chart.getXAxis().setAxisLineWidth(1.5f);&#10;        chart.getAxisLeft().setTextColor(0xCCFFFFFF);&#10;        chart.getAxisLeft().setTextSize(11f);&#10;        chart.getAxisLeft().setDrawGridLines(true);&#10;        chart.getAxisLeft().setGridColor(0x30FFFFFF);&#10;        chart.getAxisLeft().setGridLineWidth(1f);&#10;        chart.getAxisLeft().setDrawAxisLine(false);&#10;        chart.setTouchEnabled(true);&#10;        chart.setDragEnabled(true);&#10;        chart.setScaleEnabled(false);&#10;        chart.setPinchZoom(false);&#10;        chart.setExtraOffsets(8, 16, 8, 8); // Better spacing&#10;    }&#10;&#10;    private void setupBarChart(BarChart chart) {&#10;        chart.getDescription().setEnabled(false);&#10;        chart.getLegend().setEnabled(false);&#10;        chart.setDrawGridBackground(false);&#10;        chart.getAxisRight().setEnabled(false);&#10;        chart.getXAxis().setPosition(XAxis.XAxisPosition.BOTTOM);&#10;        chart.getXAxis().setTextColor(0xCCFFFFFF);&#10;        chart.getXAxis().setTextSize(11f);&#10;        chart.getXAxis().setDrawGridLines(false);&#10;        chart.getXAxis().setDrawAxisLine(true);&#10;        chart.getXAxis().setAxisLineColor(0x40FFFFFF);&#10;        chart.getXAxis().setAxisLineWidth(1.5f);&#10;        chart.getXAxis().setGranularity(1f);&#10;        chart.getXAxis().setValueFormatter(new ValueFormatter() {&#10;            private final String[] labels = {&quot;Humidity&quot;, &quot;Wind&quot;, &quot;Pressure&quot;, &quot;UV Index&quot;};&#10;            @Override&#10;            public String getFormattedValue(float value) {&#10;                int index = (int) value;&#10;                return index &gt;= 0 &amp;&amp; index &lt; labels.length ? labels[index] : &quot;&quot;;&#10;            }&#10;        });&#10;        chart.getAxisLeft().setTextColor(0xCCFFFFFF);&#10;        chart.getAxisLeft().setTextSize(11f);&#10;        chart.getAxisLeft().setDrawGridLines(true);&#10;        chart.getAxisLeft().setGridColor(0x30FFFFFF);&#10;        chart.getAxisLeft().setGridLineWidth(1f);&#10;        chart.getAxisLeft().setDrawAxisLine(false);&#10;        chart.setTouchEnabled(false);&#10;        chart.setFitBars(true);&#10;        chart.setExtraOffsets(8, 16, 8, 8); // Better spacing&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.weatherapp.ui.activities;&#13;&#10;&#13;&#10;import android.content.SharedPreferences;&#13;&#10;import android.os.Bundle;&#13;&#10;import android.widget.ImageButton;&#13;&#10;import android.widget.TextView;&#13;&#10;&#13;&#10;import androidx.appcompat.app.AppCompatActivity;&#13;&#10;&#13;&#10;import com.example.weatherapp.R;&#13;&#10;import com.example.weatherapp.data.responses.HourlyForecastResponse;&#13;&#10;import com.example.weatherapp.data.responses.WeatherResponse;&#13;&#10;import com.github.mikephil.charting.charts.BarChart;&#13;&#10;import com.github.mikephil.charting.charts.LineChart;&#13;&#10;import com.github.mikephil.charting.components.XAxis;&#13;&#10;import com.github.mikephil.charting.data.BarData;&#13;&#10;import com.github.mikephil.charting.data.BarDataSet;&#13;&#10;import com.github.mikephil.charting.data.BarEntry;&#13;&#10;import com.github.mikephil.charting.data.Entry;&#13;&#10;import com.github.mikephil.charting.data.LineData;&#13;&#10;import com.github.mikephil.charting.data.LineDataSet;&#13;&#10;import com.github.mikephil.charting.formatter.ValueFormatter;&#13;&#10;&#13;&#10;import java.util.ArrayList;&#13;&#10;import java.util.List;&#13;&#10;&#13;&#10;public class ChartsActivity extends AppCompatActivity {&#13;&#10;&#13;&#10;    private HourlyForecastResponse hourlyForecastData;&#13;&#10;    private WeatherResponse currentWeatherData;&#13;&#10;    private int currentUVIndex;&#13;&#10;    private String windSpeedUnit = &quot;ms&quot;;&#13;&#10;&#13;&#10;    @Override&#13;&#10;    protected void onCreate(Bundle savedInstanceState) {&#13;&#10;        super.onCreate(savedInstanceState);&#13;&#10;        setContentView(R.layout.activity_charts);&#13;&#10;&#13;&#10;        // Get data from intent&#13;&#10;        hourlyForecastData = (HourlyForecastResponse) getIntent().getSerializableExtra(&quot;hourly_data&quot;);&#13;&#10;        currentWeatherData = (WeatherResponse) getIntent().getSerializableExtra(&quot;current_data&quot;);&#13;&#10;        currentUVIndex = getIntent().getIntExtra(&quot;uv_index&quot;, 0);&#13;&#10;&#13;&#10;        // Load settings&#13;&#10;        SharedPreferences prefs = getSharedPreferences(&quot;WeatherAppPrefs&quot;, MODE_PRIVATE);&#13;&#10;        windSpeedUnit = SettingsActivity.getWindSpeedUnit(prefs);&#13;&#10;&#13;&#10;        // Setup back button&#13;&#10;        ImageButton btnBack = findViewById(R.id.btnBack);&#13;&#10;        if (btnBack != null) {&#13;&#10;            btnBack.setOnClickListener(v -&gt; finish());&#13;&#10;        }&#13;&#10;&#13;&#10;        // Update title&#13;&#10;        TextView tvTitle = findViewById(R.id.tvChartTitle);&#13;&#10;        if (tvTitle != null &amp;&amp; currentWeatherData != null) {&#13;&#10;            tvTitle.setText(currentWeatherData.getName() + &quot; - &quot; + getString(R.string.weather_statistics));&#13;&#10;        }&#13;&#10;&#13;&#10;        // Setup all charts&#13;&#10;        setupTemperatureChart();&#13;&#10;        setupWeatherStatsChart();&#13;&#10;        setupRainProbabilityChart();&#13;&#10;        setupWindSpeedChart();&#13;&#10;        setupHumidityChart();&#13;&#10;    }&#13;&#10;&#13;&#10;    private void setupTemperatureChart() {&#13;&#10;        if (hourlyForecastData == null || hourlyForecastData.getList() == null) {&#13;&#10;            return;&#13;&#10;        }&#13;&#10;&#13;&#10;        LineChart chart = findViewById(R.id.temperatureChart);&#13;&#10;        if (chart == null) return;&#13;&#10;&#13;&#10;        List&lt;Entry&gt; entries = new ArrayList&lt;&gt;();&#13;&#10;&#13;&#10;        int count = Math.min(12, hourlyForecastData.getList().size());&#13;&#10;        for (int i = 0; i &lt; count; i++) {&#13;&#10;            HourlyForecastResponse.HourlyItem item = hourlyForecastData.getList().get(i);&#13;&#10;            float temp = (float) item.getMain().getTemp();&#13;&#10;            entries.add(new Entry(i, temp));&#13;&#10;        }&#13;&#10;&#13;&#10;        LineDataSet dataSet = new LineDataSet(entries, &quot;Temperature&quot;);&#13;&#10;        // Unified purple gradient theme&#13;&#10;        dataSet.setColor(0xFF9B6FFF); // Soft purple&#13;&#10;        dataSet.setCircleColor(0xFFE2DDFD);&#13;&#10;        dataSet.setLineWidth(3.5f);&#13;&#10;        dataSet.setCircleRadius(6f);&#13;&#10;        dataSet.setDrawCircleHole(true);&#13;&#10;        dataSet.setCircleHoleColor(0xFF5B3E9E);&#13;&#10;        dataSet.setCircleHoleRadius(3f);&#13;&#10;        dataSet.setValueTextSize(11f);&#13;&#10;        dataSet.setValueTextColor(0xFFFFFFFF);&#13;&#10;        dataSet.setDrawFilled(true);&#13;&#10;        dataSet.setFillColor(0xFF7B5EC6);&#13;&#10;        dataSet.setFillAlpha(100);&#13;&#10;        dataSet.setMode(LineDataSet.Mode.CUBIC_BEZIER);&#13;&#10;        dataSet.setCubicIntensity(0.15f);&#13;&#10;&#13;&#10;        LineData lineData = new LineData(dataSet);&#13;&#10;        chart.setData(lineData);&#13;&#10;&#13;&#10;        setupChart(chart);&#13;&#10;        chart.animateXY(1200, 1200);&#13;&#10;        chart.invalidate();&#13;&#10;    }&#13;&#10;&#13;&#10;    private void setupWeatherStatsChart() {&#13;&#10;        if (currentWeatherData == null) return;&#13;&#10;&#13;&#10;        BarChart chart = findViewById(R.id.weatherStatsChart);&#13;&#10;        if (chart == null) return;&#13;&#10;&#13;&#10;        List&lt;BarEntry&gt; entries = new ArrayList&lt;&gt;();&#13;&#10;        entries.add(new BarEntry(0, currentWeatherData.getMain().getHumidity()));&#13;&#10;        entries.add(new BarEntry(1, (float) currentWeatherData.getWind().getSpeed() * 3.6f));&#13;&#10;        entries.add(new BarEntry(2, currentWeatherData.getMain().getPressure() / 10f));&#13;&#10;        entries.add(new BarEntry(3, currentUVIndex * 10f));&#13;&#10;&#13;&#10;        BarDataSet dataSet = new BarDataSet(entries, &quot;Weather Stats&quot;);&#13;&#10;        // Unified gradient color scheme - cyan to purple&#13;&#10;        int[] colors = {0xFF4FC3F7, 0xFF29B6F6, 0xFFFFB347, 0xFFFF6B9D};&#13;&#10;        dataSet.setColors(colors);&#13;&#10;        dataSet.setValueTextSize(12f);&#13;&#10;        dataSet.setValueTextColor(0xFFFFFFFF);&#13;&#10;        dataSet.setHighLightAlpha(255);&#13;&#10;&#13;&#10;        BarData barData = new BarData(dataSet);&#13;&#10;        barData.setBarWidth(0.6f);&#13;&#10;        chart.setData(barData);&#13;&#10;&#13;&#10;        setupBarChart(chart);&#13;&#10;        chart.animateY(1200);&#13;&#10;        chart.invalidate();&#13;&#10;    }&#13;&#10;&#13;&#10;    private void setupRainProbabilityChart() {&#13;&#10;        if (hourlyForecastData == null || hourlyForecastData.getList() == null) return;&#13;&#10;&#13;&#10;        LineChart chart = findViewById(R.id.rainProbabilityChart);&#13;&#10;        if (chart == null) return;&#13;&#10;&#13;&#10;        List&lt;Entry&gt; entries = new ArrayList&lt;&gt;();&#13;&#10;        int count = Math.min(12, hourlyForecastData.getList().size());&#13;&#10;        for (int i = 0; i &lt; count; i++) {&#13;&#10;            HourlyForecastResponse.HourlyItem item = hourlyForecastData.getList().get(i);&#13;&#10;            float rainProb = (float) (item.getPop() * 100);&#13;&#10;            entries.add(new Entry(i, rainProb));&#13;&#10;        }&#13;&#10;&#13;&#10;        LineDataSet dataSet = new LineDataSet(entries, &quot;Rain Probability&quot;);&#13;&#10;        // Unified blue theme for water&#13;&#10;        dataSet.setColor(0xFF4FC3F7);&#13;&#10;        dataSet.setCircleColor(0xFF81D4FA);&#13;&#10;        dataSet.setLineWidth(3.5f);&#13;&#10;        dataSet.setCircleRadius(5f);&#13;&#10;        dataSet.setDrawCircleHole(true);&#13;&#10;        dataSet.setCircleHoleColor(0xFF29B6F6);&#13;&#10;        dataSet.setCircleHoleRadius(2.5f);&#13;&#10;        dataSet.setDrawFilled(true);&#13;&#10;        dataSet.setFillColor(0xFF4FC3F7);&#13;&#10;        dataSet.setFillAlpha(100);&#13;&#10;        dataSet.setMode(LineDataSet.Mode.CUBIC_BEZIER);&#13;&#10;        dataSet.setCubicIntensity(0.15f);&#13;&#10;        dataSet.setDrawValues(false);&#13;&#10;&#13;&#10;        LineData lineData = new LineData(dataSet);&#13;&#10;        chart.setData(lineData);&#13;&#10;&#13;&#10;        setupChart(chart);&#13;&#10;        chart.getAxisLeft().setAxisMinimum(0f);&#13;&#10;        chart.getAxisLeft().setAxisMaximum(100f);&#13;&#10;        chart.animateXY(1200, 1200);&#13;&#10;        chart.invalidate();&#13;&#10;    }&#13;&#10;&#13;&#10;    private void setupWindSpeedChart() {&#13;&#10;        if (hourlyForecastData == null || hourlyForecastData.getList() == null) return;&#13;&#10;&#13;&#10;        LineChart chart = findViewById(R.id.windSpeedChart);&#13;&#10;        if (chart == null) return;&#13;&#10;&#13;&#10;        List&lt;Entry&gt; entries = new ArrayList&lt;&gt;();&#13;&#10;        int count = Math.min(12, hourlyForecastData.getList().size());&#13;&#10;        for (int i = 0; i &lt; count; i++) {&#13;&#10;            HourlyForecastResponse.HourlyItem item = hourlyForecastData.getList().get(i);&#13;&#10;            float windSpeed = (float) item.getWind().getSpeed();&#13;&#10;&#13;&#10;            if (windSpeedUnit.equals(&quot;kmh&quot;)) {&#13;&#10;                windSpeed = windSpeed * 3.6f;&#13;&#10;            }&#13;&#10;            entries.add(new Entry(i, windSpeed));&#13;&#10;        }&#13;&#10;&#13;&#10;        LineDataSet dataSet = new LineDataSet(entries, &quot;Wind Speed&quot;);&#13;&#10;        // Unified green theme for wind&#13;&#10;        dataSet.setColor(0xFF66BB6A);&#13;&#10;        dataSet.setCircleColor(0xFF81C784);&#13;&#10;        dataSet.setLineWidth(3.5f);&#13;&#10;        dataSet.setCircleRadius(5f);&#13;&#10;        dataSet.setDrawCircleHole(true);&#13;&#10;        dataSet.setCircleHoleColor(0xFF4CAF50);&#13;&#10;        dataSet.setCircleHoleRadius(2.5f);&#13;&#10;        dataSet.setDrawFilled(true);&#13;&#10;        dataSet.setFillColor(0xFF66BB6A);&#13;&#10;        dataSet.setFillAlpha(100);&#13;&#10;        dataSet.setMode(LineDataSet.Mode.CUBIC_BEZIER);&#13;&#10;        dataSet.setCubicIntensity(0.15f);&#13;&#10;        dataSet.setDrawValues(false);&#13;&#10;&#13;&#10;        LineData lineData = new LineData(dataSet);&#13;&#10;        chart.setData(lineData);&#13;&#10;&#13;&#10;        setupChart(chart);&#13;&#10;        chart.animateXY(1200, 1200);&#13;&#10;        chart.invalidate();&#13;&#10;    }&#13;&#10;&#13;&#10;    private void setupHumidityChart() {&#13;&#10;        if (hourlyForecastData == null || hourlyForecastData.getList() == null) return;&#13;&#10;&#13;&#10;        LineChart chart = findViewById(R.id.humidityChart);&#13;&#10;        if (chart == null) return;&#13;&#10;&#13;&#10;        List&lt;Entry&gt; entries = new ArrayList&lt;&gt;();&#13;&#10;        int count = Math.min(12, hourlyForecastData.getList().size());&#13;&#10;        for (int i = 0; i &lt; count; i++) {&#13;&#10;            HourlyForecastResponse.HourlyItem item = hourlyForecastData.getList().get(i);&#13;&#10;            float humidity = (float) item.getMain().getHumidity();&#13;&#10;            entries.add(new Entry(i, humidity));&#13;&#10;        }&#13;&#10;&#13;&#10;        LineDataSet dataSet = new LineDataSet(entries, &quot;Humidity&quot;);&#13;&#10;        // Unified cyan theme for humidity&#13;&#10;        dataSet.setColor(0xFF26C6DA);&#13;&#10;        dataSet.setCircleColor(0xFF4DD0E1);&#13;&#10;        dataSet.setLineWidth(3.5f);&#13;&#10;        dataSet.setCircleRadius(5f);&#13;&#10;        dataSet.setDrawCircleHole(true);&#13;&#10;        dataSet.setCircleHoleColor(0xFF00BCD4);&#13;&#10;        dataSet.setCircleHoleRadius(2.5f);&#13;&#10;        dataSet.setDrawFilled(true);&#13;&#10;        dataSet.setFillColor(0xFF26C6DA);&#13;&#10;        dataSet.setFillAlpha(100);&#13;&#10;        dataSet.setMode(LineDataSet.Mode.CUBIC_BEZIER);&#13;&#10;        dataSet.setCubicIntensity(0.15f);&#13;&#10;        dataSet.setDrawValues(false);&#13;&#10;&#13;&#10;        LineData lineData = new LineData(dataSet);&#13;&#10;        chart.setData(lineData);&#13;&#10;&#13;&#10;        setupChart(chart);&#13;&#10;        chart.getAxisLeft().setAxisMinimum(0f);&#13;&#10;        chart.getAxisLeft().setAxisMaximum(100f);&#13;&#10;        chart.animateXY(1200, 1200);&#13;&#10;        chart.invalidate();&#13;&#10;    }&#13;&#10;&#13;&#10;    private void setupChart(LineChart chart) {&#13;&#10;        chart.getDescription().setEnabled(false);&#13;&#10;        chart.getLegend().setEnabled(false);&#13;&#10;        chart.setDrawGridBackground(false);&#13;&#10;        chart.getAxisRight().setEnabled(false);&#13;&#10;        chart.getXAxis().setPosition(XAxis.XAxisPosition.BOTTOM);&#13;&#10;        chart.getXAxis().setTextColor(0xCCFFFFFF); // Slightly transparent white&#13;&#10;        chart.getXAxis().setTextSize(11f);&#13;&#10;        chart.getXAxis().setDrawGridLines(false);&#13;&#10;        chart.getXAxis().setDrawAxisLine(true);&#13;&#10;        chart.getXAxis().setAxisLineColor(0x40FFFFFF);&#13;&#10;        chart.getXAxis().setAxisLineWidth(1.5f);&#13;&#10;        chart.getAxisLeft().setTextColor(0xCCFFFFFF);&#13;&#10;        chart.getAxisLeft().setTextSize(11f);&#13;&#10;        chart.getAxisLeft().setDrawGridLines(true);&#13;&#10;        chart.getAxisLeft().setGridColor(0x30FFFFFF);&#13;&#10;        chart.getAxisLeft().setGridLineWidth(1f);&#13;&#10;        chart.getAxisLeft().setDrawAxisLine(false);&#13;&#10;        chart.setTouchEnabled(true);&#13;&#10;        chart.setDragEnabled(true);&#13;&#10;        chart.setScaleEnabled(false);&#13;&#10;        chart.setPinchZoom(false);&#13;&#10;        chart.setExtraOffsets(8, 16, 8, 8); // Better spacing&#13;&#10;    }&#13;&#10;&#13;&#10;    private void setupBarChart(BarChart chart) {&#13;&#10;        chart.getDescription().setEnabled(false);&#13;&#10;        chart.getLegend().setEnabled(false);&#13;&#10;        chart.setDrawGridBackground(false);&#13;&#10;        chart.getAxisRight().setEnabled(false);&#13;&#10;        chart.getXAxis().setPosition(XAxis.XAxisPosition.BOTTOM);&#13;&#10;        chart.getXAxis().setTextColor(0xCCFFFFFF);&#13;&#10;        chart.getXAxis().setTextSize(11f);&#13;&#10;        chart.getXAxis().setDrawGridLines(false);&#13;&#10;        chart.getXAxis().setDrawAxisLine(true);&#13;&#10;        chart.getXAxis().setAxisLineColor(0x40FFFFFF);&#13;&#10;        chart.getXAxis().setAxisLineWidth(1.5f);&#13;&#10;        chart.getXAxis().setGranularity(1f);&#13;&#10;        chart.getXAxis().setValueFormatter(new ValueFormatter() {&#13;&#10;            private final String[] labels = {&quot;Humidity&quot;, &quot;Wind&quot;, &quot;Pressure&quot;, &quot;UV Index&quot;};&#13;&#10;            @Override&#13;&#10;            public String getFormattedValue(float value) {&#13;&#10;                int index = (int) value;&#13;&#10;                return index &gt;= 0 &amp;&amp; index &lt; labels.length ? labels[index] : &quot;&quot;;&#13;&#10;            }&#13;&#10;        });&#13;&#10;        chart.getAxisLeft().setTextColor(0xCCFFFFFF);&#13;&#10;        chart.getAxisLeft().setTextSize(11f);&#13;&#10;        chart.getAxisLeft().setDrawGridLines(true);&#13;&#10;        chart.getAxisLeft().setGridColor(0x30FFFFFF);&#13;&#10;        chart.getAxisLeft().setGridLineWidth(1f);&#13;&#10;        chart.getAxisLeft().setDrawAxisLine(false);&#13;&#10;        chart.setTouchEnabled(false);&#13;&#10;        chart.setFitBars(true);&#13;&#10;        chart.setExtraOffsets(8, 16, 8, 8); // Better spacing&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/activities/FavoriteCitiesActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/activities/FavoriteCitiesActivity.java" />
              <option name="originalContent" value="package com.example.weatherapp.ui.activities;&#10;&#10;import android.content.Intent;&#10;import android.os.Bundle;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.ImageButton;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.appcompat.app.AlertDialog;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.google.android.material.floatingactionbutton.FloatingActionButton;&#10;&#10;import java.util.List;&#10;import java.util.Locale;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class FavoriteCitiesActivity extends AppCompatActivity {&#10;&#10;    private static final String API_KEY = &quot;bd5e378503939ddaee76f12ad7a97608&quot;;&#10;    private RecyclerView recyclerView;&#10;    private FavoriteCitiesAdapter adapter;&#10;    private FavoriteCitiesManager favoritesManager;&#10;    private View tvEmptyState; // Changed from TextView to View&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_favorite_cities);&#10;&#10;        favoritesManager = new FavoriteCitiesManager(this);&#10;&#10;        recyclerView = findViewById(R.id.recyclerViewFavorites);&#10;        tvEmptyState = findViewById(R.id.tvEmptyState); // Now correctly typed as View (LinearLayout)&#10;        FloatingActionButton fabAddCity = findViewById(R.id.fabAddCity);&#10;        ImageButton btnBack = findViewById(R.id.btnBack);&#10;&#10;        recyclerView.setLayoutManager(new LinearLayoutManager(this));&#10;&#10;        loadFavoriteCities();&#10;&#10;        fabAddCity.setOnClickListener(v -&gt; {&#10;            if (favoritesManager.canAddMoreCities()) {&#10;                // Open search activity to add new city&#10;                Intent intent = new Intent(this, SearchActivity.class);&#10;                intent.putExtra(&quot;ADD_TO_FAVORITES&quot;, true);&#10;                startActivity(intent);&#10;            } else {&#10;                Toast.makeText(this, &quot;Maximum 10 favorite cities allowed&quot;, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;&#10;        btnBack.setOnClickListener(v -&gt; finish());&#10;    }&#10;&#10;    @Override&#10;    protected void onResume() {&#10;        super.onResume();&#10;        loadFavoriteCities();&#10;    }&#10;&#10;    private void loadFavoriteCities() {&#10;        List&lt;FavoriteCity&gt; cities = favoritesManager.getFavoriteCities();&#10;&#10;        if (cities.isEmpty()) {&#10;            recyclerView.setVisibility(View.GONE);&#10;            tvEmptyState.setVisibility(View.VISIBLE);&#10;        } else {&#10;            recyclerView.setVisibility(View.VISIBLE);&#10;            tvEmptyState.setVisibility(View.GONE);&#10;&#10;            adapter = new FavoriteCitiesAdapter(cities);&#10;            recyclerView.setAdapter(adapter);&#10;&#10;            // Refresh weather data for all cities&#10;            refreshAllCitiesWeather();&#10;        }&#10;    }&#10;&#10;    private void refreshAllCitiesWeather() {&#10;        List&lt;FavoriteCity&gt; cities = favoritesManager.getFavoriteCities();&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;&#10;        for (int i = 0; i &lt; cities.size(); i++) {&#10;            FavoriteCity city = cities.get(i);&#10;            final int position = i;&#10;&#10;            Call&lt;WeatherResponse&gt; call = apiService.getWeatherByCity(&#10;                    city.getCityName(), API_KEY, &quot;metric&quot;);&#10;&#10;            call.enqueue(new Callback&lt;WeatherResponse&gt;() {&#10;                @Override&#10;                public void onResponse(Call&lt;WeatherResponse&gt; call, Response&lt;WeatherResponse&gt; response) {&#10;                    if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                        WeatherResponse weather = response.body();&#10;                        city.setCurrentTemp(weather.getMain().getTemp());&#10;                        city.setWeatherCondition(weather.getWeather().get(0).getMain());&#10;                        city.setWeatherDescription(weather.getWeather().get(0).getDescription());&#10;&#10;                        favoritesManager.updateCityWeather(&#10;                                city.getCityName(),&#10;                                city.getCurrentTemp(),&#10;                                city.getWeatherCondition(),&#10;                                city.getWeatherDescription()&#10;                        );&#10;&#10;                        if (adapter != null) {&#10;                            adapter.notifyItemChanged(position);&#10;                        }&#10;                    }&#10;                }&#10;&#10;                @Override&#10;                public void onFailure(Call&lt;WeatherResponse&gt; call, Throwable t) {&#10;                    // Silently fail - keep cached data&#10;                }&#10;            });&#10;        }&#10;    }&#10;&#10;    private class FavoriteCitiesAdapter extends RecyclerView.Adapter&lt;FavoriteCitiesAdapter.ViewHolder&gt; {&#10;&#10;        private final List&lt;FavoriteCity&gt; cities;&#10;&#10;        FavoriteCitiesAdapter(List&lt;FavoriteCity&gt; cities) {&#10;            this.cities = cities;&#10;        }&#10;&#10;        @NonNull&#10;        @Override&#10;        public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {&#10;            View view = LayoutInflater.from(parent.getContext())&#10;                    .inflate(R.layout.item_favorite_city, parent, false);&#10;            return new ViewHolder(view);&#10;        }&#10;&#10;        @Override&#10;        public void onBindViewHolder(@NonNull ViewHolder holder, int position) {&#10;            FavoriteCity city = cities.get(position);&#10;            holder.bind(city);&#10;        }&#10;&#10;        @Override&#10;        public int getItemCount() {&#10;            return cities.size();&#10;        }&#10;&#10;        class ViewHolder extends RecyclerView.ViewHolder {&#10;            TextView tvCityName, tvTemperature, tvWeatherDesc;&#10;            ImageButton btnRemove;&#10;&#10;            ViewHolder(View itemView) {&#10;                super(itemView);&#10;                tvCityName = itemView.findViewById(R.id.tvCityName);&#10;                tvTemperature = itemView.findViewById(R.id.tvTemperature);&#10;                tvWeatherDesc = itemView.findViewById(R.id.tvWeatherDesc);&#10;                btnRemove = itemView.findViewById(R.id.btnRemove);&#10;            }&#10;&#10;            void bind(FavoriteCity city) {&#10;                tvCityName.setText(city.getDisplayName());&#10;&#10;                if (city.getCurrentTemp() != 0) {&#10;                    tvTemperature.setText(String.format(Locale.getDefault(),&#10;                            &quot;%.0f°C&quot;, city.getCurrentTemp()));&#10;                    tvWeatherDesc.setText(city.getWeatherDescription());&#10;                } else {&#10;                    tvTemperature.setText(&quot;--°&quot;);&#10;                    tvWeatherDesc.setText(&quot;Loading...&quot;);&#10;                }&#10;&#10;                itemView.setOnClickListener(v -&gt; {&#10;                    // Open MainActivity with this city&#10;                    Intent intent = new Intent(FavoriteCitiesActivity.this, MainActivity.class);&#10;                    intent.putExtra(&quot;CITY_NAME&quot;, city.getCityName());&#10;                    intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);&#10;                    startActivity(intent);&#10;                    finish();&#10;                });&#10;&#10;                btnRemove.setOnClickListener(v -&gt; {&#10;                    new AlertDialog.Builder(FavoriteCitiesActivity.this)&#10;                            .setTitle(&quot;Remove City&quot;)&#10;                            .setMessage(&quot;Remove &quot; + city.getCityName() + &quot; from favorites?&quot;)&#10;                            .setPositiveButton(&quot;Remove&quot;, (dialog, which) -&gt; {&#10;                                int position = getBindingAdapterPosition();&#10;                                if (position != RecyclerView.NO_POSITION) {&#10;                                    favoritesManager.removeFavoriteCity(city.getCityName());&#10;                                    cities.remove(position);&#10;                                    notifyItemRemoved(position);&#10;&#10;                                    if (cities.isEmpty()) {&#10;                                        recyclerView.setVisibility(View.GONE);&#10;                                        tvEmptyState.setVisibility(View.VISIBLE);&#10;                                    }&#10;                                }&#10;                            })&#10;                            .setNegativeButton(&quot;Cancel&quot;, null)&#10;                            .show();&#10;                });&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.weatherapp.ui.activities;&#13;&#10;&#13;&#10;import android.content.Intent;&#13;&#10;import android.os.Bundle;&#13;&#10;import android.view.LayoutInflater;&#13;&#10;import android.view.View;&#13;&#10;import android.view.ViewGroup;&#13;&#10;import android.widget.ImageButton;&#13;&#10;import android.widget.TextView;&#13;&#10;import android.widget.Toast;&#13;&#10;&#13;&#10;import androidx.annotation.NonNull;&#13;&#10;import androidx.appcompat.app.AlertDialog;&#13;&#10;import androidx.appcompat.app.AppCompatActivity;&#13;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#13;&#10;import androidx.recyclerview.widget.RecyclerView;&#13;&#10;&#13;&#10;import com.example.weatherapp.R;&#13;&#10;import com.example.weatherapp.data.api.RetrofitClient;&#13;&#10;import com.example.weatherapp.data.api.WeatherApiService;&#13;&#10;import com.example.weatherapp.data.models.FavoriteCity;&#13;&#10;import com.example.weatherapp.data.responses.WeatherResponse;&#13;&#10;import com.example.weatherapp.utils.FavoriteCitiesManager;&#13;&#10;import com.google.android.material.floatingactionbutton.FloatingActionButton;&#13;&#10;&#13;&#10;import java.util.List;&#13;&#10;import java.util.Locale;&#13;&#10;&#13;&#10;import retrofit2.Call;&#13;&#10;import retrofit2.Callback;&#13;&#10;import retrofit2.Response;&#13;&#10;&#13;&#10;public class FavoriteCitiesActivity extends AppCompatActivity {&#13;&#10;&#13;&#10;    private static final String API_KEY = &quot;bd5e378503939ddaee76f12ad7a97608&quot;;&#13;&#10;    private RecyclerView recyclerView;&#13;&#10;    private FavoriteCitiesAdapter adapter;&#13;&#10;    private FavoriteCitiesManager favoritesManager;&#13;&#10;    private View tvEmptyState; // Changed from TextView to View&#13;&#10;&#13;&#10;    @Override&#13;&#10;    protected void onCreate(Bundle savedInstanceState) {&#13;&#10;        super.onCreate(savedInstanceState);&#13;&#10;        setContentView(R.layout.activity_favorite_cities);&#13;&#10;&#13;&#10;        favoritesManager = new FavoriteCitiesManager(this);&#13;&#10;&#13;&#10;        recyclerView = findViewById(R.id.recyclerViewFavorites);&#13;&#10;        tvEmptyState = findViewById(R.id.tvEmptyState); // Now correctly typed as View (LinearLayout)&#13;&#10;        FloatingActionButton fabAddCity = findViewById(R.id.fabAddCity);&#13;&#10;        ImageButton btnBack = findViewById(R.id.btnBack);&#13;&#10;&#13;&#10;        recyclerView.setLayoutManager(new LinearLayoutManager(this));&#13;&#10;&#13;&#10;        loadFavoriteCities();&#13;&#10;&#13;&#10;        fabAddCity.setOnClickListener(v -&gt; {&#13;&#10;            if (favoritesManager.canAddMoreCities()) {&#13;&#10;                // Open search activity to add new city&#13;&#10;                Intent intent = new Intent(this, SearchActivity.class);&#13;&#10;                intent.putExtra(&quot;ADD_TO_FAVORITES&quot;, true);&#13;&#10;                startActivity(intent);&#13;&#10;            } else {&#13;&#10;                Toast.makeText(this, &quot;Maximum 10 favorite cities allowed&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;            }&#13;&#10;        });&#13;&#10;&#13;&#10;        btnBack.setOnClickListener(v -&gt; finish());&#13;&#10;    }&#13;&#10;&#13;&#10;    @Override&#13;&#10;    protected void onResume() {&#13;&#10;        super.onResume();&#13;&#10;        loadFavoriteCities();&#13;&#10;    }&#13;&#10;&#13;&#10;    private void loadFavoriteCities() {&#13;&#10;        List&lt;FavoriteCity&gt; cities = favoritesManager.getFavoriteCities();&#13;&#10;&#13;&#10;        if (cities.isEmpty()) {&#13;&#10;            recyclerView.setVisibility(View.GONE);&#13;&#10;            tvEmptyState.setVisibility(View.VISIBLE);&#13;&#10;        } else {&#13;&#10;            recyclerView.setVisibility(View.VISIBLE);&#13;&#10;            tvEmptyState.setVisibility(View.GONE);&#13;&#10;&#13;&#10;            adapter = new FavoriteCitiesAdapter(cities);&#13;&#10;            recyclerView.setAdapter(adapter);&#13;&#10;&#13;&#10;            // Refresh weather data for all cities&#13;&#10;            refreshAllCitiesWeather();&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    private void refreshAllCitiesWeather() {&#13;&#10;        List&lt;FavoriteCity&gt; cities = favoritesManager.getFavoriteCities();&#13;&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#13;&#10;&#13;&#10;        for (int i = 0; i &lt; cities.size(); i++) {&#13;&#10;            FavoriteCity city = cities.get(i);&#13;&#10;            final int position = i;&#13;&#10;&#13;&#10;            Call&lt;WeatherResponse&gt; call = apiService.getWeatherByCity(&#13;&#10;                    city.getCityName(), API_KEY, &quot;metric&quot;);&#13;&#10;&#13;&#10;            call.enqueue(new Callback&lt;WeatherResponse&gt;() {&#13;&#10;                @Override&#13;&#10;                public void onResponse(Call&lt;WeatherResponse&gt; call, Response&lt;WeatherResponse&gt; response) {&#13;&#10;                    if (response.isSuccessful() &amp;&amp; response.body() != null) {&#13;&#10;                        WeatherResponse weather = response.body();&#13;&#10;                        city.setCurrentTemp(weather.getMain().getTemp());&#13;&#10;                        city.setWeatherCondition(weather.getWeather().get(0).getMain());&#13;&#10;                        city.setWeatherDescription(weather.getWeather().get(0).getDescription());&#13;&#10;&#13;&#10;                        favoritesManager.updateCityWeather(&#13;&#10;                                city.getCityName(),&#13;&#10;                                city.getCurrentTemp(),&#13;&#10;                                city.getWeatherCondition(),&#13;&#10;                                city.getWeatherDescription()&#13;&#10;                        );&#13;&#10;&#13;&#10;                        if (adapter != null) {&#13;&#10;                            adapter.notifyItemChanged(position);&#13;&#10;                        }&#13;&#10;                    }&#13;&#10;                }&#13;&#10;&#13;&#10;                @Override&#13;&#10;                public void onFailure(Call&lt;WeatherResponse&gt; call, Throwable t) {&#13;&#10;                    // Silently fail - keep cached data&#13;&#10;                }&#13;&#10;            });&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    private class FavoriteCitiesAdapter extends RecyclerView.Adapter&lt;FavoriteCitiesAdapter.ViewHolder&gt; {&#13;&#10;&#13;&#10;        private final List&lt;FavoriteCity&gt; cities;&#13;&#10;&#13;&#10;        FavoriteCitiesAdapter(List&lt;FavoriteCity&gt; cities) {&#13;&#10;            this.cities = cities;&#13;&#10;        }&#13;&#10;&#13;&#10;        @NonNull&#13;&#10;        @Override&#13;&#10;        public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {&#13;&#10;            View view = LayoutInflater.from(parent.getContext())&#13;&#10;                    .inflate(R.layout.item_favorite_city, parent, false);&#13;&#10;            return new ViewHolder(view);&#13;&#10;        }&#13;&#10;&#13;&#10;        @Override&#13;&#10;        public void onBindViewHolder(@NonNull ViewHolder holder, int position) {&#13;&#10;            FavoriteCity city = cities.get(position);&#13;&#10;            holder.bind(city);&#13;&#10;        }&#13;&#10;&#13;&#10;        @Override&#13;&#10;        public int getItemCount() {&#13;&#10;            return cities.size();&#13;&#10;        }&#13;&#10;&#13;&#10;        class ViewHolder extends RecyclerView.ViewHolder {&#13;&#10;            TextView tvCityName, tvTemperature, tvWeatherDesc;&#13;&#10;            ImageButton btnRemove;&#13;&#10;&#13;&#10;            ViewHolder(View itemView) {&#13;&#10;                super(itemView);&#13;&#10;                tvCityName = itemView.findViewById(R.id.tvCityName);&#13;&#10;                tvTemperature = itemView.findViewById(R.id.tvTemperature);&#13;&#10;                tvWeatherDesc = itemView.findViewById(R.id.tvWeatherDesc);&#13;&#10;                btnRemove = itemView.findViewById(R.id.btnRemove);&#13;&#10;            }&#13;&#10;&#13;&#10;            void bind(FavoriteCity city) {&#13;&#10;                tvCityName.setText(city.getDisplayName());&#13;&#10;&#13;&#10;                if (city.getCurrentTemp() != 0) {&#13;&#10;                    tvTemperature.setText(String.format(Locale.getDefault(),&#13;&#10;                            &quot;%.0f°C&quot;, city.getCurrentTemp()));&#13;&#10;                    tvWeatherDesc.setText(city.getWeatherDescription());&#13;&#10;                } else {&#13;&#10;                    tvTemperature.setText(&quot;--°&quot;);&#13;&#10;                    tvWeatherDesc.setText(&quot;Loading...&quot;);&#13;&#10;                }&#13;&#10;&#13;&#10;                itemView.setOnClickListener(v -&gt; {&#13;&#10;                    // Open MainActivity with this city&#13;&#10;                    Intent intent = new Intent(FavoriteCitiesActivity.this, MainActivity.class);&#13;&#10;                    intent.putExtra(&quot;CITY_NAME&quot;, city.getCityName());&#13;&#10;                    intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);&#13;&#10;                    startActivity(intent);&#13;&#10;                    finish();&#13;&#10;                });&#13;&#10;&#13;&#10;                btnRemove.setOnClickListener(v -&gt; {&#13;&#10;                    new AlertDialog.Builder(FavoriteCitiesActivity.this)&#13;&#10;                            .setTitle(&quot;Remove City&quot;)&#13;&#10;                            .setMessage(&quot;Remove &quot; + city.getCityName() + &quot; from favorites?&quot;)&#13;&#10;                            .setPositiveButton(&quot;Remove&quot;, (dialog, which) -&gt; {&#13;&#10;                                int position = getBindingAdapterPosition();&#13;&#10;                                if (position != RecyclerView.NO_POSITION) {&#13;&#10;                                    favoritesManager.removeFavoriteCity(city.getCityName());&#13;&#10;                                    cities.remove(position);&#13;&#10;                                    notifyItemRemoved(position);&#13;&#10;&#13;&#10;                                    if (cities.isEmpty()) {&#13;&#10;                                        recyclerView.setVisibility(View.GONE);&#13;&#10;                                        tvEmptyState.setVisibility(View.VISIBLE);&#13;&#10;                                    }&#13;&#10;                                }&#13;&#10;                            })&#13;&#10;                            .setNegativeButton(&quot;Cancel&quot;, null)&#13;&#10;                            .show();&#13;&#10;                });&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/activities/MainActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/activities/MainActivity.java" />
              <option name="originalContent" value="package com.example.weatherapp.ui.activities;&#10;&#10;import android.Manifest;&#10;import android.appwidget.AppWidgetManager;&#10;import android.content.ComponentName;&#10;import android.content.Context;&#10;import android.content.Intent;&#10;import android.content.SharedPreferences;&#10;import android.content.pm.PackageManager;&#10;import android.os.Build;&#10;import android.os.Bundle;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.ImageView;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.activity.EdgeToEdge;&#10;import androidx.activity.result.ActivityResultLauncher;&#10;import androidx.activity.result.contract.ActivityResultContracts;&#10;import androidx.annotation.NonNull;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.core.content.ContextCompat;&#10;import androidx.core.graphics.Insets;&#10;import androidx.core.view.ViewCompat;&#10;import androidx.core.view.WindowInsetsCompat;&#10;import androidx.work.ExistingPeriodicWorkPolicy;&#10;import androidx.work.PeriodicWorkRequest;&#10;import androidx.work.WorkManager;&#10;&#10;import com.example.weatherapp.databinding.ActivityMainBinding;&#10;import com.google.android.gms.location.FusedLocationProviderClient;&#10;import com.google.android.gms.location.LocationServices;&#10;&#10;import java.text.SimpleDateFormat;&#10;import java.util.ArrayList;&#10;import java.util.Calendar;&#10;import java.util.List;&#10;import java.util.Locale;&#10;import java.util.concurrent.TimeUnit;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class MainActivity extends AppCompatActivity {&#10;&#10;    private ActivityMainBinding binding;&#10;    private static final String API_KEY = &quot;4f8cf691daad596ac4e465c909868d0d&quot;;&#10;    private boolean isSearchVisible = false;&#10;    private boolean isHourlyView = true;&#10;    private WeatherResponse currentWeatherData;&#10;    private HourlyForecastResponse hourlyForecastData;&#10;    private String currentCityName = &quot;Hanoi&quot;;&#10;    private double currentLat = 0;&#10;    private double currentLon = 0;&#10;    private int currentUVIndex = 0;&#10;    private AirQualityResponse.AirQualityData currentAQIData; // Add this&#10;    private SharedPreferences sharedPreferences;&#10;    private FavoriteCitiesManager favoritesManager; // Add favorite cities manager&#10;    private List&lt;WeatherAlert&gt; currentAlerts; // Add weather alerts list&#10;&#10;    // Unit settings&#10;    private String temperatureUnit = &quot;celsius&quot;;&#10;    private String windSpeedUnit = &quot;ms&quot;;&#10;    private String pressureUnit = &quot;hpa&quot;;&#10;&#10;    // Location&#10;    private FusedLocationProviderClient fusedLocationClient;&#10;&#10;    // Notification permission launcher&#10;    private final ActivityResultLauncher&lt;String&gt; requestPermissionLauncher =&#10;            registerForActivityResult(new ActivityResultContracts.RequestPermission(), isGranted -&gt; {&#10;                if (isGranted) {&#10;                    // Permission granted - schedule notifications&#10;                    scheduleWeatherNotifications();&#10;                    Toast.makeText(this, &quot;Weather notifications enabled&quot;, Toast.LENGTH_SHORT).show();&#10;                } else {&#10;                    // Permission denied&#10;                    Toast.makeText(this, &quot;Notification permission denied&quot;, Toast.LENGTH_SHORT).show();&#10;                }&#10;            });&#10;&#10;    // Activity Result API (modern way - no memory leak)&#10;    private final ActivityResultLauncher&lt;Intent&gt; searchLauncher = registerForActivityResult(&#10;            new ActivityResultContracts.StartActivityForResult(),&#10;            result -&gt; {&#10;                if (result.getResultCode() == RESULT_OK &amp;&amp; result.getData() != null) {&#10;                    // Check if using GPS location&#10;                    boolean useGPS = result.getData().getBooleanExtra(SearchActivity.EXTRA_USE_GPS, false);&#10;&#10;                    if (useGPS) {&#10;                        // Get coordinates from GPS&#10;                        double latitude = result.getData().getDoubleExtra(SearchActivity.EXTRA_LATITUDE, 0);&#10;                        double longitude = result.getData().getDoubleExtra(SearchActivity.EXTRA_LONGITUDE, 0);&#10;&#10;                        if (latitude != 0 &amp;&amp; longitude != 0) {&#10;                            // Fetch weather by coordinates&#10;                            fetchWeatherByCoordinates(latitude, longitude);&#10;                        }&#10;                    } else {&#10;                        // Get city name from search&#10;                        String cityName = result.getData().getStringExtra(SearchActivity.EXTRA_CITY_NAME);&#10;                        if (cityName != null &amp;&amp; !cityName.isEmpty()) {&#10;                            currentCityName = cityName;&#10;                            fetchAllWeatherData(cityName);&#10;                        }&#10;                    }&#10;                }&#10;            });&#10;&#10;    // Settings launcher&#10;    private final ActivityResultLauncher&lt;Intent&gt; settingsLauncher = registerForActivityResult(&#10;            new ActivityResultContracts.StartActivityForResult(),&#10;            result -&gt; {&#10;                if (result.getResultCode() == RESULT_OK) {&#10;                    // Check if language changed&#10;                    boolean languageChanged = result.getData() != null &amp;&amp;&#10;                            result.getData().getBooleanExtra(&quot;language_changed&quot;, false);&#10;&#10;                    if (languageChanged) {&#10;                        // Language changed - recreate MainActivity to apply new language&#10;                        recreate();&#10;                        return;&#10;                    }&#10;&#10;                    // Store old temperature unit to check if it changed&#10;                    String oldTempUnit = temperatureUnit;&#10;&#10;                    // Reload settings&#10;                    loadSettings();&#10;&#10;                    // If temperature unit changed, refetch data from API with correct unit&#10;                    if (!oldTempUnit.equals(temperatureUnit)) {&#10;                        // Temperature unit changed - need to fetch new data&#10;                        fetchAllWeatherData(currentCityName);&#10;                    } else {&#10;                        // Only wind/pressure unit changed - just update UI&#10;                        if (currentWeatherData != null) {&#10;                            updateUI(currentWeatherData);&#10;                        }&#10;                        if (hourlyForecastData != null) {&#10;                            updateForecastView();&#10;                        }&#10;                    }&#10;                }&#10;            });&#10;&#10;    // Location permission launcher&#10;    private final ActivityResultLauncher&lt;String&gt; requestLocationPermissionLauncher =&#10;            registerForActivityResult(new ActivityResultContracts.RequestPermission(), isGranted -&gt; {&#10;                if (isGranted) {&#10;                    // Permission granted - get location&#10;                    getCurrentLocation();&#10;                } else {&#10;                    // Permission denied&#10;                    Toast.makeText(this, R.string.permission_denied, Toast.LENGTH_SHORT).show();&#10;                }&#10;            });&#10;&#10;    @Override&#10;    protected void attachBaseContext(Context newBase) {&#10;        super.attachBaseContext(LocaleHelper.onAttach(newBase));&#10;    }&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;&#10;        // Apply saved language first&#10;        applyLanguagePreference();&#10;&#10;        EdgeToEdge.enable(this);&#10;        binding = ActivityMainBinding.inflate(getLayoutInflater());&#10;        setContentView(binding.getRoot());&#10;&#10;        sharedPreferences = getSharedPreferences(&quot;WeatherAppPrefs&quot;, MODE_PRIVATE);&#10;&#10;        // Initialize location client&#10;        fusedLocationClient = LocationServices.getFusedLocationProviderClient(this);&#10;&#10;        // Initialize favorites manager&#10;        favoritesManager = new FavoriteCitiesManager(this);&#10;&#10;        // Load settings&#10;        loadSettings();&#10;&#10;        // Request notification permission for Android 13+&#10;        checkNotificationPermission();&#10;&#10;        // Schedule weather notifications&#10;        scheduleWeatherNotifications();&#10;&#10;        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main), (v, insets) -&gt; {&#10;            Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());&#10;            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);&#10;            return insets;&#10;        });&#10;&#10;        setupListeners();&#10;&#10;        // Apply glass morphism effects to UI elements&#10;        applyGlassMorphismEffects();&#10;&#10;        // Apply blur effect to top glass bar (API 31+)&#10;        applyTopBarBlurEffect();&#10;&#10;        fetchAllWeatherData(currentCityName);&#10;    }&#10;&#10;    /**&#10;     * Apply blur effect to the glass capsule top bar using native Android blur&#10;     * Uses setBackgroundBlurRadius (Android 12+) - only blurs backdrop, content stays sharp&#10;     */&#10;    private void applyTopBarBlurEffect() {&#10;        View topGlassBar = findViewById(R.id.topGlassBar);&#10;        if (topGlassBar == null) return;&#10;&#10;        // Calculate corner radius in pixels&#10;        float density = getResources().getDisplayMetrics().density;&#10;        float cornerRadiusPx = 32f * density; // 32dp corner radius&#10;&#10;        // Set outline provider for rounded corners&#10;        topGlassBar.setOutlineProvider(new android.view.ViewOutlineProvider() {&#10;            @Override&#10;            public void getOutline(View view, android.graphics.Outline outline) {&#10;                outline.setRoundRect(0, 0, view.getWidth(), view.getHeight(), cornerRadiusPx);&#10;            }&#10;        });&#10;        topGlassBar.setClipToOutline(true);&#10;&#10;        // Create glass morphism background with higher opacity for better visibility&#10;        android.graphics.drawable.GradientDrawable background = new android.graphics.drawable.GradientDrawable();&#10;        background.setColor(android.graphics.Color.argb(40, 255, 255, 255)); // ~16% white opacity - more visible&#10;        background.setCornerRadius(cornerRadiusPx);&#10;        background.setStroke((int)(1.5f * density), android.graphics.Color.argb(80, 255, 255, 255)); // ~31% white border&#10;        topGlassBar.setBackground(background);&#10;&#10;        // Set elevation for depth&#10;        topGlassBar.setElevation(12f * density);&#10;    }&#10;&#10;    private void loadSettings() {&#10;        temperatureUnit = SettingsActivity.getTemperatureUnit(sharedPreferences);&#10;        windSpeedUnit = SettingsActivity.getWindSpeedUnit(sharedPreferences);&#10;        pressureUnit = SettingsActivity.getPressureUnit(sharedPreferences);&#10;    }&#10;&#10;    private void applyLanguagePreference() {&#10;        SharedPreferences prefs = getSharedPreferences(&quot;WeatherAppPrefs&quot;, MODE_PRIVATE);&#10;        String language = prefs.getString(&quot;language&quot;, &quot;vi&quot;); // Fixed: Changed default from &quot;en&quot; to &quot;vi&quot;&#10;        LocaleHelper.setLocale(this, language);&#10;    }&#10;&#10;    private void setupListeners() {&#10;        // Top Bar Glass Capsule - Settings Icon&#10;        binding.btnSettingsIcon.setOnClickListener(v -&gt; {&#10;            Intent intent = new Intent(MainActivity.this, SettingsActivity.class);&#10;            settingsLauncher.launch(intent);&#10;        });&#10;&#10;        // Top Bar Glass Capsule - Search Icon&#10;        binding.btnSearchIcon.setOnClickListener(v -&gt; {&#10;            Intent intent = new Intent(MainActivity.this, SearchActivity.class);&#10;            searchLauncher.launch(intent);&#10;        });&#10;&#10;        // Top Bar City Name - tap to search location&#10;        binding.tvTopBarCityName.setOnClickListener(v -&gt; {&#10;            Intent intent = new Intent(MainActivity.this, SearchActivity.class);&#10;            searchLauncher.launch(intent);&#10;        });&#10;&#10;&#10;        // Search button click&#10;        binding.btnSearch.setOnClickListener(v -&gt; {&#10;            String cityName = binding.etCityName.getText().toString().trim();&#10;            if (!cityName.isEmpty()) {&#10;                currentCityName = cityName;&#10;                fetchAllWeatherData(cityName);&#10;                toggleSearchBar();&#10;            } else {&#10;                Toast.makeText(MainActivity.this, &quot;Please enter a city name&quot;, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;&#10;        // Current Location button click - NEW&#10;        binding.btnCurrentLocation.setOnClickListener(v -&gt; {&#10;            checkLocationPermissionAndGetLocation();&#10;            toggleSearchBar();&#10;        });&#10;&#10;        // View Charts button click - NEW&#10;        binding.btnViewCharts.setOnClickListener(v -&gt; {&#10;            openChartsActivity();&#10;        });&#10;&#10;        // Outfit Suggestion button click - NEW&#10;        binding.btnOutfitSuggestion.setOnClickListener(v -&gt; {&#10;            openOutfitSuggestionActivity();&#10;        });&#10;&#10;        // Hourly/Weekly toggle buttons&#10;        binding.btnHourly.setOnClickListener(v -&gt; {&#10;            if (!isHourlyView) {&#10;                isHourlyView = true;&#10;                animateTabSelection(true);&#10;                updateForecastView();&#10;            }&#10;        });&#10;&#10;        binding.btnWeekly.setOnClickListener(v -&gt; {&#10;            if (isHourlyView) {&#10;                isHourlyView = false;&#10;                animateTabSelection(false);&#10;                updateForecastView();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void toggleSearchBar() {&#10;        isSearchVisible = !isSearchVisible;&#10;        binding.searchContainer.setVisibility(isSearchVisible ? View.VISIBLE : View.GONE);&#10;    }&#10;&#10;    /**&#10;     * Apply glass morphism effects to UI elements for a modern, translucent look&#10;     * BLUR EFFECT ĐÃ TẮT - chỉ dùng background drawable để UI rõ ràng&#10;     */&#10;    private void applyGlassMorphismEffects() {&#10;        // TẮT blur effect - gây mờ quá mức&#10;        // Chỉ dùng glass panel background (semi-transparent white)&#10;        // Background drawables already have overlay #33FFFFFF and stroke #4DFFFFFF&#10;&#10;        // KHÔNG apply blur nữa để UI rõ ràng&#10;        /* DISABLED - causes blur&#10;        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S) {&#10;            applyBlurEffect(binding.searchContainer);&#10;&#10;            // Apply blur to the main forecast card container&#10;            View forecastCard = findViewById(R.id.weatherDetailsSection);&#10;            if (forecastCard != null) {&#10;                applyBlurEffect(forecastCard);&#10;            }&#10;        }&#10;        */&#10;    }&#10;&#10;    /**&#10;     * Apply blur effect to a view (API 31+)&#10;     * DISABLED - causes too much blur&#10;     */&#10;    private void applyBlurEffect(View view) {&#10;        // KHÔNG apply blur để UI rõ ràng&#10;        /* DISABLED&#10;        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S) {&#10;            android.graphics.RenderEffect blurEffect = android.graphics.RenderEffect.createBlurEffect(&#10;                    10f, 10f, android.graphics.Shader.TileMode.CLAMP&#10;            );&#10;            view.setRenderEffect(blurEffect);&#10;        }&#10;        */&#10;    }&#10;&#10;    private void fetchAllWeatherData(String cityName) {&#10;        binding.progressBar.setVisibility(View.VISIBLE);&#10;        binding.weatherDetailsSection.setVisibility(View.GONE);&#10;        binding.tvError.setVisibility(View.GONE);&#10;&#10;        // Save current city to preferences for notifications&#10;        sharedPreferences.edit().putString(&quot;last_city&quot;, cityName).apply();&#10;&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;&#10;        // Use metric for Celsius, imperial for Fahrenheit&#10;        String units = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;metric&quot; : &quot;imperial&quot;;&#10;&#10;        // Log API call for debugging&#10;        android.util.Log.d(&quot;WeatherApp&quot;, &quot;Fetching weather for city: &quot; + cityName + &quot;, units: &quot; + units + &quot;, API_KEY: &quot; + API_KEY.substring(0, 8) + &quot;...&quot;);&#10;&#10;        // Fetch current weather&#10;        Call&lt;WeatherResponse&gt; weatherCall = apiService.getWeatherByCity(cityName, API_KEY, units);&#10;        weatherCall.enqueue(new Callback&lt;WeatherResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;WeatherResponse&gt; call, Response&lt;WeatherResponse&gt; response) {&#10;                android.util.Log.d(&quot;WeatherApp&quot;, &quot;Response code: &quot; + response.code());&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    currentWeatherData = response.body();&#10;                    android.util.Log.d(&quot;WeatherApp&quot;, &quot;Weather data received for: &quot; + currentWeatherData.getName());&#10;&#10;                    // Get coordinates for UV Index API&#10;                    if (currentWeatherData.getCoord() != null) {&#10;                        currentLat = currentWeatherData.getCoord().getLat();&#10;                        currentLon = currentWeatherData.getCoord().getLon();&#10;                    }&#10;&#10;                    updateUI(currentWeatherData);&#10;&#10;                    // After current weather, fetch hourly forecast, UV index, and Air Quality&#10;                    fetchHourlyForecast(cityName);&#10;                    fetchUVIndex(currentLat, currentLon);&#10;                    fetchAirQuality(currentLat, currentLon);&#10;                } else {&#10;                    binding.progressBar.setVisibility(View.GONE);&#10;                    String errorMsg = &quot;City not found&quot;;&#10;                    try {&#10;                        if (response.errorBody() != null) {&#10;                            errorMsg = response.errorBody().string();&#10;                            android.util.Log.e(&quot;WeatherApp&quot;, &quot;Error response: &quot; + errorMsg);&#10;                        }&#10;                    } catch (Exception e) {&#10;                        android.util.Log.e(&quot;WeatherApp&quot;, &quot;Error reading error body&quot;, e);&#10;                    }&#10;                    showError(&quot;City not found. Please check the city name and try again.&quot;);&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;WeatherResponse&gt; call, Throwable t) {&#10;                android.util.Log.e(&quot;WeatherApp&quot;, &quot;Network error&quot;, t);&#10;                binding.progressBar.setVisibility(View.GONE);&#10;                showError(getNetworkErrorMessage(t));&#10;            }&#10;        });&#10;    }&#10;&#10;    private void fetchUVIndex(double lat, double lon) {&#10;        if (lat == 0 &amp;&amp; lon == 0) return;&#10;&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;        Call&lt;UVIndexResponse&gt; uvCall = apiService.getUVIndex(lat, lon, API_KEY);&#10;&#10;        uvCall.enqueue(new Callback&lt;UVIndexResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;UVIndexResponse&gt; call, Response&lt;UVIndexResponse&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    currentUVIndex = (int) Math.round(response.body().getValue());&#10;                    updateUVIndexCard();&#10;                } else {&#10;                    // Keep default UV index if API fails&#10;                    currentUVIndex = 0;&#10;                    updateUVIndexCard();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;UVIndexResponse&gt; call, Throwable t) {&#10;                // Keep default UV index if API fails&#10;                currentUVIndex = 0;&#10;                updateUVIndexCard();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void updateUVIndexCard() {&#10;        String uvDesc;&#10;        if (currentUVIndex &lt; 3) {&#10;            uvDesc = &quot;Low&quot;;&#10;        } else if (currentUVIndex &lt; 6) {&#10;            uvDesc = &quot;Moderate&quot;;&#10;        } else if (currentUVIndex &lt; 8) {&#10;            uvDesc = &quot;High&quot;;&#10;        } else if (currentUVIndex &lt; 11) {&#10;            uvDesc = &quot;Very High&quot;;&#10;        } else {&#10;            uvDesc = &quot;Extreme&quot;;&#10;        }&#10;&#10;        updateCard(R.id.cardUvIndex, &quot;☀️&quot;, &quot;UV INDEX&quot;,&#10;                String.valueOf(currentUVIndex), uvDesc);&#10;    }&#10;&#10;    // NEW: Fetch Air Quality Index&#10;    private void fetchAirQuality(double lat, double lon) {&#10;        if (lat == 0 &amp;&amp; lon == 0) return;&#10;&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;        Call&lt;AirQualityResponse&gt; aqiCall = apiService.getAirQuality(lat, lon, API_KEY);&#10;&#10;        aqiCall.enqueue(new Callback&lt;AirQualityResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;AirQualityResponse&gt; call, Response&lt;AirQualityResponse&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null&#10;                        &amp;&amp; response.body().getList() != null &amp;&amp; !response.body().getList().isEmpty()) {&#10;                    currentAQIData = response.body().getList().get(0);&#10;                    updateAirQualityCard();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;AirQualityResponse&gt; call, Throwable t) {&#10;                // Keep default AQI if API fails&#10;            }&#10;        });&#10;    }&#10;&#10;    // NEW: Update Air Quality card&#10;    private void updateAirQualityCard() {&#10;        if (currentAQIData == null) return;&#10;&#10;        View aqiCard = findViewById(R.id.card_air_quality);&#10;        if (aqiCard == null) return;&#10;&#10;        int aqi = currentAQIData.getMain().getAqi();&#10;        String status;&#10;        String description;&#10;&#10;        switch (aqi) {&#10;            case 1:&#10;                status = &quot;Good&quot;;&#10;                description = &quot;Air quality is satisfactory&quot;;&#10;                break;&#10;            case 2:&#10;                status = &quot;Fair&quot;;&#10;                description = &quot;Air quality is acceptable&quot;;&#10;                break;&#10;            case 3:&#10;                status = &quot;Moderate&quot;;&#10;                description = &quot;Sensitive groups may be affected&quot;;&#10;                break;&#10;            case 4:&#10;                status = &quot;Poor&quot;;&#10;                description = &quot;Everyone may experience health effects&quot;;&#10;                break;&#10;            case 5:&#10;                status = &quot;Very Poor&quot;;&#10;                description = &quot;Health alert: everyone may be affected&quot;;&#10;                break;&#10;            default:&#10;                status = &quot;Unknown&quot;;&#10;                description = &quot;No data available&quot;;&#10;        }&#10;&#10;        TextView tvAqiValue = aqiCard.findViewById(R.id.tvAqiValue);&#10;        TextView tvAqiStatus = aqiCard.findViewById(R.id.tvAqiStatus);&#10;        TextView tvAqiDescription = aqiCard.findViewById(R.id.tvAqiDescription);&#10;        TextView tvPm25 = aqiCard.findViewById(R.id.tvPm25);&#10;        TextView tvPm10 = aqiCard.findViewById(R.id.tvPm10);&#10;        TextView tvO3 = aqiCard.findViewById(R.id.tvO3);&#10;&#10;        if (tvAqiValue != null) tvAqiValue.setText(String.valueOf(aqi));&#10;        if (tvAqiStatus != null) tvAqiStatus.setText(status);&#10;        if (tvAqiDescription != null) tvAqiDescription.setText(description);&#10;&#10;        if (currentAQIData.getComponents() != null) {&#10;            if (tvPm25 != null) tvPm25.setText(String.format(Locale.getDefault(), &quot;%.1f&quot;, currentAQIData.getComponents().getPm2_5()));&#10;            if (tvPm10 != null) tvPm10.setText(String.format(Locale.getDefault(), &quot;%.1f&quot;, currentAQIData.getComponents().getPm10()));&#10;            if (tvO3 != null) tvO3.setText(String.format(Locale.getDefault(), &quot;%.1f&quot;, currentAQIData.getComponents().getO3()));&#10;        }&#10;    }&#10;&#10;    private void fetchHourlyForecast(String cityName) {&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;        String units = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;metric&quot; : &quot;imperial&quot;;&#10;        Call&lt;HourlyForecastResponse&gt; hourlyCall = apiService.getHourlyForecast(cityName, API_KEY, units);&#10;&#10;        hourlyCall.enqueue(new Callback&lt;HourlyForecastResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;HourlyForecastResponse&gt; call, Response&lt;HourlyForecastResponse&gt; response) {&#10;                binding.progressBar.setVisibility(View.GONE);&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    hourlyForecastData = response.body();&#10;                    updateForecastView();&#10;                    binding.weatherDetailsSection.setVisibility(View.VISIBLE);&#10;                } else {&#10;                    // If hourly forecast fails, still show weather details&#10;                    binding.weatherDetailsSection.setVisibility(View.VISIBLE);&#10;                    Toast.makeText(MainActivity.this, &quot;Could not load hourly forecast&quot;, Toast.LENGTH_SHORT).show();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;HourlyForecastResponse&gt; call, Throwable t) {&#10;                binding.progressBar.setVisibility(View.GONE);&#10;                binding.weatherDetailsSection.setVisibility(View.VISIBLE);&#10;                Toast.makeText(MainActivity.this, &quot;Could not load hourly forecast&quot;, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;    }&#10;&#10;    // NEW: Fetch hourly forecast by GPS coordinates&#10;    private void fetchHourlyForecastByCoordinates(double lat, double lon) {&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;        String units = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;metric&quot; : &quot;imperial&quot;;&#10;        Call&lt;HourlyForecastResponse&gt; hourlyCall = apiService.getHourlyForecastByCoordinates(lat, lon, API_KEY, units);&#10;&#10;        hourlyCall.enqueue(new Callback&lt;HourlyForecastResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;HourlyForecastResponse&gt; call, Response&lt;HourlyForecastResponse&gt; response) {&#10;                binding.progressBar.setVisibility(View.GONE);&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    hourlyForecastData = response.body();&#10;                    updateForecastView();&#10;                    binding.weatherDetailsSection.setVisibility(View.VISIBLE);&#10;                } else {&#10;                    // If hourly forecast fails, still show weather details&#10;                    binding.weatherDetailsSection.setVisibility(View.VISIBLE);&#10;                    Toast.makeText(MainActivity.this, &quot;Could not load hourly forecast&quot;, Toast.LENGTH_SHORT).show();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;HourlyForecastResponse&gt; call, Throwable t) {&#10;                binding.progressBar.setVisibility(View.GONE);&#10;                binding.weatherDetailsSection.setVisibility(View.VISIBLE);&#10;                Toast.makeText(MainActivity.this, &quot;Could not load hourly forecast&quot;, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;    }&#10;&#10;    // NEW: Open Charts Activity&#10;    private void openChartsActivity() {&#10;        if (hourlyForecastData == null || currentWeatherData == null) {&#10;            Toast.makeText(this, &quot;Weather data not available yet&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        Intent intent = new Intent(this, ChartsActivity.class);&#10;        intent.putExtra(&quot;hourly_data&quot;, hourlyForecastData);&#10;        intent.putExtra(&quot;current_data&quot;, currentWeatherData);&#10;        intent.putExtra(&quot;uv_index&quot;, currentUVIndex);&#10;        startActivity(intent);&#10;    }&#10;&#10;    // NEW: Open Outfit Suggestion Activity&#10;    private void openOutfitSuggestionActivity() {&#10;        if (currentWeatherData == null) {&#10;            Toast.makeText(this, &quot;Weather data not available yet&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        Intent intent = new Intent(this, OutfitSuggestionActivity.class);&#10;        intent.putExtra(&quot;weather_data&quot;, currentWeatherData);&#10;        startActivity(intent);&#10;    }&#10;&#10;    private void updateForecastView() {&#10;        if (currentWeatherData == null) return;&#10;&#10;        if (isHourlyView) {&#10;            if (hourlyForecastData != null) {&#10;                createHourlyForecastFromAPI(hourlyForecastData);&#10;            } else {&#10;                // Show message that forecast data is not available&#10;                showForecastUnavailable();&#10;            }&#10;        } else {&#10;            if (hourlyForecastData != null) {&#10;                createWeeklyForecastFromAPI(hourlyForecastData);&#10;            } else {&#10;                // Show message that forecast data is not available&#10;                showForecastUnavailable();&#10;            }&#10;        }&#10;    }&#10;&#10;    private void showForecastUnavailable() {&#10;        binding.hourlyForecastContainer.removeAllViews();&#10;        // Could add a TextView here to show &quot;Forecast data unavailable&quot;&#10;        Toast.makeText(this, &quot;Forecast data is currently unavailable&quot;, Toast.LENGTH_SHORT).show();&#10;    }&#10;&#10;    private void createHourlyForecastFromAPI(HourlyForecastResponse forecastData) {&#10;        binding.hourlyForecastContainer.removeAllViews();&#10;&#10;        List&lt;HourlyForecastResponse.HourlyItem&gt; hourlyItems = forecastData.getList();&#10;        if (hourlyItems == null || hourlyItems.isEmpty()) {&#10;            return;&#10;        }&#10;&#10;        boolean isFirst = true;&#10;&#10;        // Show next 8 items (24 hours, since API returns 3-hour intervals)&#10;        int itemsToShow = Math.min(8, hourlyItems.size());&#10;&#10;        for (int i = 0; i &lt; itemsToShow; i++) {&#10;            HourlyForecastResponse.HourlyItem item = hourlyItems.get(i);&#10;&#10;            View itemView;&#10;            if (isFirst) {&#10;                itemView = LayoutInflater.from(this).inflate(R.layout.item_hourly_forecast_now, binding.hourlyForecastContainer, false);&#10;                isFirst = false;&#10;            } else {&#10;                itemView = LayoutInflater.from(this).inflate(R.layout.item_hourly_forecast, binding.hourlyForecastContainer, false);&#10;            }&#10;&#10;            TextView txtHour = itemView.findViewById(R.id.tvHour);&#10;            ImageView ivHourlyIcon = itemView.findViewById(R.id.ivHourlyIcon);&#10;            TextView tvHourlyTemp = itemView.findViewById(R.id.tvHourlyTemp);&#10;            TextView tvRainProbability = itemView.findViewById(R.id.tvRainProbability);&#10;&#10;            // Format time&#10;            Calendar itemTime = Calendar.getInstance();&#10;            itemTime.setTimeInMillis(item.getDt() * 1000);&#10;&#10;            if (i == 0) {&#10;                txtHour.setText(&quot;Now&quot;);&#10;            } else {&#10;                int hour = itemTime.get(Calendar.HOUR);&#10;                if (hour == 0) hour = 12;&#10;                String amPm = itemTime.get(Calendar.AM_PM) == Calendar.AM ? &quot;AM&quot; : &quot;PM&quot;;&#10;                txtHour.setText(hour + amPm); // Removed space between hour and AM/PM&#10;            }&#10;&#10;            // Set weather icon&#10;            String weatherCondition = item.getWeather().get(0).getMain().toLowerCase();&#10;            ivHourlyIcon.setImageResource(getWeatherIconResource(weatherCondition));&#10;&#10;            // Set temperature with unit symbol&#10;            int temp = (int) Math.round(item.getMain().getTemp());&#10;            String tempSymbol = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;°&quot; : &quot;°F&quot;;&#10;            tvHourlyTemp.setText(String.format(Locale.getDefault(), &quot;%d%s&quot;, temp, tempSymbol));&#10;&#10;            // Set rain probability&#10;            if (tvRainProbability != null) {&#10;                int rainProb = (int) (item.getPop() * 100);&#10;                if (rainProb &gt; 0 &amp;&amp; i &gt; 0) { // Don't show for &quot;Now&quot;&#10;                    tvRainProbability.setText(String.format(Locale.getDefault(), &quot;%d%%&quot;, rainProb));&#10;                    tvRainProbability.setVisibility(View.VISIBLE);&#10;                } else {&#10;                    tvRainProbability.setVisibility(View.INVISIBLE);&#10;                }&#10;            }&#10;&#10;            binding.hourlyForecastContainer.addView(itemView);&#10;        }&#10;    }&#10;&#10;    private void createWeeklyForecastFromAPI(HourlyForecastResponse forecastData) {&#10;        binding.hourlyForecastContainer.removeAllViews();&#10;&#10;        List&lt;HourlyForecastResponse.HourlyItem&gt; hourlyItems = forecastData.getList();&#10;        if (hourlyItems == null || hourlyItems.isEmpty()) {&#10;            return;&#10;        }&#10;&#10;        String[] days = {&quot;SUN&quot;, &quot;MON&quot;, &quot;TUE&quot;, &quot;WED&quot;, &quot;THU&quot;, &quot;FRI&quot;, &quot;SAT&quot;};&#10;        Calendar calendar = Calendar.getInstance();&#10;&#10;        // Group by day and get max temp for each day&#10;        List&lt;DailyData&gt; dailyDataList = new ArrayList&lt;&gt;();&#10;        String currentDay = &quot;&quot;;&#10;        DailyData currentDailyData = null;&#10;&#10;        for (HourlyForecastResponse.HourlyItem item : hourlyItems) {&#10;            calendar.setTimeInMillis(item.getDt() * 1000);&#10;            String dayKey = days[calendar.get(Calendar.DAY_OF_WEEK) - 1];&#10;&#10;            if (!dayKey.equals(currentDay)) {&#10;                if (currentDailyData != null) {&#10;                    dailyDataList.add(currentDailyData);&#10;                }&#10;                currentDailyData = new DailyData(dayKey);&#10;                currentDay = dayKey;&#10;            }&#10;&#10;            currentDailyData.addItem(item);&#10;&#10;            if (dailyDataList.size() &gt;= 7) break;&#10;        }&#10;&#10;        if (currentDailyData != null &amp;&amp; dailyDataList.size() &lt; 7) {&#10;            dailyDataList.add(currentDailyData);&#10;        }&#10;&#10;        // Display daily forecasts&#10;        boolean isFirst = true;&#10;        String tempSymbol = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;°&quot; : &quot;°F&quot;;&#10;&#10;        for (DailyData dailyData : dailyDataList) {&#10;            View itemView;&#10;&#10;            if (isFirst) {&#10;                itemView = LayoutInflater.from(this).inflate(R.layout.item_weekly_forecast_today, binding.hourlyForecastContainer, false);&#10;                isFirst = false;&#10;            } else {&#10;                itemView = LayoutInflater.from(this).inflate(R.layout.item_weekly_forecast, binding.hourlyForecastContainer, false);&#10;            }&#10;&#10;            TextView tvDay = itemView.findViewById(R.id.tvDay);&#10;            ImageView ivWeeklyIcon = itemView.findViewById(R.id.ivWeeklyIcon);&#10;            TextView tvWeeklyTemp = itemView.findViewById(R.id.tvWeeklyTemp);&#10;            TextView tvWeeklyRainProbability = itemView.findViewById(R.id.tvWeeklyRainProbability);&#10;&#10;            tvDay.setText(dailyData.dayName);&#10;            ivWeeklyIcon.setImageResource(getWeatherIconResource(dailyData.mainWeatherCondition));&#10;            tvWeeklyTemp.setText(String.format(Locale.getDefault(), &quot;%d%s&quot;, dailyData.maxTemp, tempSymbol));&#10;&#10;            if (tvWeeklyRainProbability != null) {&#10;                if (dailyData.maxRainProbability &gt; 0) {&#10;                    tvWeeklyRainProbability.setText(String.format(Locale.getDefault(), &quot;%d%%&quot;, dailyData.maxRainProbability));&#10;                    tvWeeklyRainProbability.setVisibility(View.VISIBLE);&#10;                } else {&#10;                    tvWeeklyRainProbability.setVisibility(View.INVISIBLE);&#10;                }&#10;            }&#10;&#10;            binding.hourlyForecastContainer.addView(itemView);&#10;        }&#10;    }&#10;&#10;    // Helper class to group hourly data by day&#10;    private static class DailyData {&#10;        String dayName;&#10;        int maxTemp = Integer.MIN_VALUE;&#10;        int maxRainProbability = 0;&#10;        String mainWeatherCondition = &quot;clear&quot;;&#10;&#10;        DailyData(String dayName) {&#10;            this.dayName = dayName;&#10;        }&#10;&#10;        void addItem(HourlyForecastResponse.HourlyItem item) {&#10;            int temp = (int) Math.round(item.getMain().getTemp());&#10;            if (temp &gt; maxTemp) {&#10;                maxTemp = temp;&#10;                mainWeatherCondition = item.getWeather().get(0).getMain().toLowerCase();&#10;            }&#10;&#10;            int rainProb = (int) (item.getPop() * 100);&#10;            if (rainProb &gt; maxRainProbability) {&#10;                maxRainProbability = rainProb;&#10;            }&#10;        }&#10;    }&#10;&#10;&#10;    private void updateUI(WeatherResponse weatherData) {&#10;        // Update city name&#10;        binding.tvCityName.setText(weatherData.getName());&#10;&#10;        // Update top bar city name (the visible one)&#10;        binding.tvTopBarCityName.setText(weatherData.getName());&#10;&#10;        // Update weather description&#10;        if (weatherData.getWeather() != null &amp;&amp; !weatherData.getWeather().isEmpty()) {&#10;            String description = weatherData.getWeather().get(0).getDescription();&#10;            binding.tvWeatherDescription.setText(capitalizeWords(description));&#10;        }&#10;&#10;        // Update main temperature with correct unit&#10;        double temp = weatherData.getMain().getTemp();&#10;        String tempSymbol = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;°&quot; : &quot;°F&quot;;&#10;        binding.tvTemperature.setText(String.format(Locale.getDefault(), &quot;%.0f%s&quot;, temp, tempSymbol));&#10;&#10;        // Update temperature range&#10;        double tempMax = weatherData.getMain().getTempMax();&#10;        double tempMin = weatherData.getMain().getTempMin();&#10;        binding.tvTempRange.setText(String.format(Locale.getDefault(),&#10;                &quot;H:%.0f%s   L:%.0f%s&quot;, tempMax, tempSymbol, tempMin, tempSymbol));&#10;&#10;        // Update 10-Day Forecast Summary&#10;        TextView tvForecastSummary = binding.getRoot().findViewById(R.id.tvForecastSummary);&#10;        if (tvForecastSummary != null) {&#10;            String weatherCondition = weatherData.getWeather().get(0).getMain().toLowerCase();&#10;            String summary = generateForecastSummary(weatherCondition);&#10;            tvForecastSummary.setText(summary);&#10;        }&#10;&#10;        // Update Weather Details Cards&#10;        updateWeatherDetailsCards(weatherData);&#10;&#10;        // Update widget&#10;        updateWeatherWidget(weatherData);&#10;    }&#10;&#10;    private String generateForecastSummary(String weatherCondition) {&#10;        // Use actual forecast data if available&#10;        if (hourlyForecastData != null &amp;&amp; hourlyForecastData.getList() != null) {&#10;            // Group by day to count properly&#10;            java.util.Map&lt;Integer, Integer&gt; rainyItemsPerDay = new java.util.HashMap&lt;&gt;();&#10;            java.util.Map&lt;String, Integer&gt; conditionCounts = new java.util.HashMap&lt;&gt;();&#10;&#10;            Calendar calendar = Calendar.getInstance();&#10;&#10;            for (HourlyForecastResponse.HourlyItem item : hourlyForecastData.getList()) {&#10;                if (item.getWeather() != null &amp;&amp; !item.getWeather().isEmpty()) {&#10;                    calendar.setTimeInMillis(item.getDt() * 1000);&#10;                    int dayOfYear = calendar.get(Calendar.DAY_OF_YEAR);&#10;&#10;                    String condition = item.getWeather().get(0).getMain().toLowerCase();&#10;&#10;                    // Count rain/snow items per day&#10;                    if (condition.contains(&quot;rain&quot;) || condition.contains(&quot;drizzle&quot;) ||&#10;                            condition.contains(&quot;thunderstorm&quot;)) {&#10;                        rainyItemsPerDay.put(dayOfYear, rainyItemsPerDay.getOrDefault(dayOfYear, 0) + 1);&#10;                    }&#10;&#10;                    // Count condition occurrences&#10;                    conditionCounts.put(condition, conditionCounts.getOrDefault(condition, 0) + 1);&#10;                }&#10;            }&#10;&#10;            // Count how many days have significant rain (at least 2 items = 6 hours)&#10;            int rainyDays = 0;&#10;            for (int count : rainyItemsPerDay.values()) {&#10;                if (count &gt;= 2) { // At least 6 hours of rain&#10;                    rainyDays++;&#10;                }&#10;            }&#10;&#10;            // Find dominant condition&#10;            String dominantCondition = &quot;clear&quot;;&#10;            int dominantCount = 0;&#10;            for (java.util.Map.Entry&lt;String, Integer&gt; entry : conditionCounts.entrySet()) {&#10;                if (entry.getValue() &gt; dominantCount) {&#10;                    dominantCount = entry.getValue();&#10;                    dominantCondition = entry.getKey();&#10;                }&#10;            }&#10;&#10;            int totalDays = hourlyForecastData.getList().size() / 8; // 8 items per day (3-hour intervals)&#10;            int forecastDays = Math.min(totalDays, 5); // Show max 5 days&#10;&#10;            // Generate summary based on actual data&#10;            if (rainyDays &gt;= 3) {&#10;                return String.format(Locale.getDefault(),&#10;                        &quot;Rain expected %d out of %d days ahead&quot;,&#10;                        rainyDays, forecastDays);&#10;            } else if (rainyDays &gt;= 1) {&#10;                return String.format(Locale.getDefault(),&#10;                        &quot;Scattered rain in the next %d days&quot;,&#10;                        forecastDays);&#10;            } else if (dominantCondition.contains(&quot;snow&quot;)) {&#10;                return &quot;Possible snow in the coming days&quot;;&#10;            } else if (dominantCondition.contains(&quot;clear&quot;)) {&#10;                return &quot;Clear skies this week&quot;;&#10;            } else if (dominantCondition.contains(&quot;cloud&quot;)) {&#10;                return &quot;Mostly cloudy this week&quot;;&#10;            } else {&#10;                return &quot;Changing weather in the coming days&quot;;&#10;            }&#10;        }&#10;&#10;        // Fallback to simple summary (only if no API data)&#10;        if (weatherCondition.contains(&quot;rain&quot;) || weatherCondition.contains(&quot;drizzle&quot;)) {&#10;            return &quot;Rain in the coming days&quot;;&#10;        } else if (weatherCondition.contains(&quot;snow&quot;)) {&#10;            return &quot;Possible snow in the coming days&quot;;&#10;        } else if (weatherCondition.contains(&quot;clear&quot;)) {&#10;            return &quot;Clear skies this week&quot;;&#10;        } else if (weatherCondition.contains(&quot;cloud&quot;)) {&#10;            return &quot;Mostly cloudy this week&quot;;&#10;        } else {&#10;            return &quot;Changing weather in the coming days&quot;;&#10;        }&#10;    }&#10;&#10;    private void updateWeatherDetailsCards(WeatherResponse weatherData) {&#10;        // Update Feels Like Card with correct unit&#10;        String tempSymbol = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;°&quot; : &quot;°F&quot;;&#10;        updateCard(R.id.cardFeelsLike, &quot;️&quot;, &quot;FEELS LIKE&quot;,&#10;                String.format(Locale.getDefault(), &quot;%.0f%s&quot;, weatherData.getMain().getFeelsLike(), tempSymbol),&#10;                &quot;Similar to actual temp&quot;);&#10;&#10;        // Update Humidity Card&#10;        int humidity = weatherData.getMain().getHumidity();&#10;        String humidityDesc = humidity &gt; 70 ? &quot;High level&quot; : humidity &gt; 40 ? &quot;Comfortable&quot; : &quot;Low level&quot;;&#10;        updateCard(R.id.cardHumidity, &quot;&quot;, &quot;HUMIDITY&quot;,&#10;                String.format(Locale.getDefault(), &quot;%d%%&quot;, humidity), humidityDesc);&#10;&#10;        // Update Wind Card with unit conversion&#10;        double windSpeed = weatherData.getWind().getSpeed();&#10;        String windValue, windUnit;&#10;&#10;        if (windSpeedUnit.equals(&quot;kmh&quot;)) {&#10;            // Convert m/s to km/h (multiply by 3.6)&#10;            if (temperatureUnit.equals(&quot;imperial&quot;)) {&#10;                // API returns mph for imperial, convert to km/h&#10;                windSpeed = windSpeed * 1.60934;&#10;            } else {&#10;                // API returns m/s for metric, convert to km/h&#10;                windSpeed = windSpeed * 3.6;&#10;            }&#10;            windValue = String.format(Locale.getDefault(), &quot;%.1f&quot;, windSpeed);&#10;            windUnit = &quot;km/h&quot;;&#10;        } else {&#10;            // Use m/s&#10;            if (temperatureUnit.equals(&quot;imperial&quot;)) {&#10;                // API returns mph for imperial, convert to m/s&#10;                windSpeed = windSpeed * 0.44704;&#10;            }&#10;            windValue = String.format(Locale.getDefault(), &quot;%.1f&quot;, windSpeed);&#10;            windUnit = &quot;m/s&quot;;&#10;        }&#10;&#10;        updateCard(R.id.cardWind, &quot;&quot;, &quot;WIND&quot;, windValue, windUnit);&#10;&#10;        // Update Pressure Card with unit&#10;        int pressure = weatherData.getMain().getPressure();&#10;        String pressureUnitText = pressureUnit.equals(&quot;mbar&quot;) ? &quot;mbar&quot; : &quot;hPa&quot;;&#10;        updateCard(R.id.cardPressure, &quot;&quot;, &quot;PRESSURE&quot;,&#10;                String.format(Locale.getDefault(), &quot;%d&quot;, pressure), pressureUnitText);&#10;&#10;        // UV Index will be updated by fetchUVIndex() callback&#10;        updateUVIndexCard();&#10;&#10;        // Update Sunrise/Sunset Card (using real data if available)&#10;        long sunrise = weatherData.getSys() != null ? weatherData.getSys().getSunrise() : 0;&#10;        long sunset = weatherData.getSys() != null ? weatherData.getSys().getSunset() : 0;&#10;        String sunriseTime = formatTime(sunrise);&#10;        String sunsetTime = formatTime(sunset);&#10;        updateCard(R.id.cardSunrise, &quot;&quot;, &quot;SUNRISE&quot;, sunriseTime, &quot;Sunset: &quot; + sunsetTime);&#10;&#10;        // Update Visibility Card (using real data)&#10;        int visibility = weatherData.getVisibility() != null ? weatherData.getVisibility() / 1000 : 10;&#10;        updateCard(R.id.cardVisibility, &quot;️&quot;, &quot;VISIBILITY&quot;, String.valueOf(visibility), &quot;km&quot;);&#10;&#10;        // Update Rainfall Card (using real data if available)&#10;        double rainfall = 0;&#10;        if (weatherData.getRain() != null &amp;&amp; weatherData.getRain().get1h() != null) {&#10;            rainfall = weatherData.getRain().get1h();&#10;        }&#10;        updateCard(R.id.cardRainfall, &quot;️&quot;, &quot;RAINFALL&quot;,&#10;                String.format(Locale.getDefault(), &quot;%.1f&quot;, rainfall), &quot;mm last hour&quot;);&#10;    }&#10;&#10;    // Helper method to reduce code duplication&#10;    private void updateCard(int cardId, String icon, String title, String value, String description) {&#10;        View card = binding.getRoot().findViewById(cardId);&#10;        if (card != null) {&#10;            // For CardView with included layout, need to find the included layout first&#10;            View contentView = card;&#10;            if (card instanceof ViewGroup &amp;&amp; ((ViewGroup) card).getChildCount() &gt; 0) {&#10;                contentView = ((ViewGroup) card).getChildAt(0);&#10;            }&#10;&#10;            TextView tvIcon = contentView.findViewById(R.id.tvDetailIcon);&#10;            TextView tvTitle = contentView.findViewById(R.id.tvDetailTitle);&#10;            TextView tvValue = contentView.findViewById(R.id.tvDetailValue);&#10;            TextView tvDesc = contentView.findViewById(R.id.tvDetailDescription);&#10;&#10;            if (tvIcon != null) tvIcon.setText(icon);&#10;            if (tvTitle != null) tvTitle.setText(title);&#10;            if (tvValue != null) tvValue.setText(value);&#10;            if (tvDesc != null) {&#10;                tvDesc.setText(description);&#10;                tvDesc.setVisibility(View.VISIBLE);&#10;            }&#10;        }&#10;    }&#10;&#10;    private String formatTime(long timestamp) {&#10;        if (timestamp == 0) return &quot;N/A&quot;;&#10;        SimpleDateFormat sdf = new SimpleDateFormat(&quot;HH:mm&quot;, Locale.getDefault());&#10;        return sdf.format(timestamp * 1000);&#10;    }&#10;&#10;    private void animateTabSelection(boolean isHourly) {&#10;        View indicator = binding.getRoot().findViewById(R.id.tabIndicator);&#10;&#10;        if (indicator == null) return;&#10;&#10;        indicator.animate().cancel();&#10;&#10;        if (isHourly) {&#10;            binding.btnHourly.setTextColor(getResources().getColor(R.color.text_primary, null));&#10;            binding.btnWeekly.setTextColor(getResources().getColor(R.color.text_secondary, null));&#10;        } else {&#10;            binding.btnHourly.setTextColor(getResources().getColor(R.color.text_secondary, null));&#10;            binding.btnWeekly.setTextColor(getResources().getColor(R.color.text_primary, null));&#10;        }&#10;&#10;        indicator.post(() -&gt; {&#10;            float targetX = isHourly ? 0 : ((View) indicator.getParent()).getWidth() - indicator.getWidth();&#10;            indicator.animate()&#10;                    .translationX(targetX)&#10;                    .setDuration(250)&#10;                    .start();&#10;        });&#10;    }&#10;&#10;    private int getWeatherIconResource(String weatherCondition) {&#10;        switch (weatherCondition) {&#10;            case &quot;clear&quot;:&#10;                return R.drawable.sun_cloud_little_rain;&#10;            case &quot;clouds&quot;:&#10;                return R.drawable.moon_cloud_mid_rain;&#10;            case &quot;rain&quot;:&#10;                return R.drawable.big_rain_drops;&#10;            case &quot;drizzle&quot;:&#10;                return R.drawable.sun_cloud_mid_rain;&#10;            case &quot;thunderstorm&quot;:&#10;                return R.drawable.cloud_3_zap;&#10;            case &quot;snow&quot;:&#10;                return R.drawable.big_snow;&#10;            case &quot;mist&quot;:&#10;            case &quot;fog&quot;:&#10;            case &quot;haze&quot;:&#10;                return R.drawable.moon_cloud_fast_wind;&#10;            case &quot;tornado&quot;:&#10;                return R.drawable.moon_fast_wind;&#10;            default:&#10;                return R.drawable.sun_cloud_angled_rain;&#10;        }&#10;    }&#10;&#10;    private void showError(String message) {&#10;        binding.tvError.setText(message);&#10;        binding.tvError.setVisibility(View.VISIBLE);&#10;        binding.weatherDetailsSection.setVisibility(View.GONE);&#10;        Toast.makeText(this, message, Toast.LENGTH_LONG).show();&#10;    }&#10;&#10;    // Helper method để xử lý lỗi network chi tiết&#10;    private String getNetworkErrorMessage(Throwable t) {&#10;        if (t instanceof java.net.SocketTimeoutException) {&#10;            return &quot;Kết nối bị timeout. Vui lòng kiểm tra:\n&quot; +&#10;                   &quot;• Tốc độ mạng của bạn\n&quot; +&#10;                   &quot;• Thử lại sau vài giây&quot;;&#10;        } else if (t instanceof java.net.UnknownHostException) {&#10;            return &quot;Không thể kết nối đến server. Vui lòng kiểm tra kết nối internet.&quot;;&#10;        } else if (t instanceof java.net.ConnectException) {&#10;            return &quot;Không thể kết nối. Vui lòng kiểm tra:\n&quot; +&#10;                   &quot;• Bạn đã bật internet chưa\n&quot; +&#10;                   &quot;• Thử chuyển đổi giữa WiFi/4G&quot;;&#10;        } else if (t instanceof java.io.IOException) {&#10;            return &quot;Lỗi kết nối mạng. Vui lòng thử lại.&quot;;&#10;        } else {&#10;            return &quot;Lỗi: &quot; + t.getMessage() + &quot;\nVui lòng thử lại sau.&quot;;&#10;        }&#10;    }&#10;&#10;    private String capitalizeWords(String str) {&#10;        String[] words = str.split(&quot;\\s&quot;);&#10;        StringBuilder capitalizedWords = new StringBuilder();&#10;&#10;        for (String word : words) {&#10;            if (!word.isEmpty()) {&#10;                capitalizedWords.append(Character.toUpperCase(word.charAt(0)))&#10;                        .append(word.substring(1))&#10;                        .append(&quot; &quot;);&#10;            }&#10;        }&#10;&#10;        return capitalizedWords.toString().trim();&#10;    }&#10;&#10;    private void checkNotificationPermission() {&#10;        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.TIRAMISU) {&#10;            if (ContextCompat.checkSelfPermission(this, Manifest.permission.POST_NOTIFICATIONS)&#10;                    != PackageManager.PERMISSION_GRANTED) {&#10;                // Request permission&#10;                requestPermissionLauncher.launch(Manifest.permission.POST_NOTIFICATIONS);&#10;            }&#10;        }&#10;    }&#10;&#10;    private void scheduleWeatherNotifications() {&#10;        // Check if notifications are enabled in settings&#10;        boolean notificationsEnabled = sharedPreferences.getBoolean(&quot;notifications&quot;, true);&#10;&#10;        if (notificationsEnabled) {&#10;            // For testing: Use OneTimeWorkRequest with 2 minute delay (PeriodicWork minimum is 15 minutes)&#10;            // This will trigger once after 2 minutes&#10;            androidx.work.OneTimeWorkRequest weatherWorkRequest = new androidx.work.OneTimeWorkRequest.Builder(&#10;                    WeatherNotificationWorker.class)&#10;                    .setInitialDelay(2, TimeUnit.MINUTES)&#10;                    .build();&#10;&#10;            WorkManager.getInstance(this).enqueueUniqueWork(&#10;                    &quot;WeatherNotification&quot;,&#10;                    androidx.work.ExistingWorkPolicy.REPLACE,&#10;                    weatherWorkRequest&#10;            );&#10;&#10;            android.util.Log.d(&quot;MainActivity&quot;, &quot;Weather notification scheduled for 2 minutes from now&quot;);&#10;        } else {&#10;            // Cancel all scheduled notifications&#10;            WorkManager.getInstance(this).cancelUniqueWork(&quot;WeatherNotification&quot;);&#10;        }&#10;    }&#10;&#10;    // NEW: Check location permission and get current location&#10;    private void checkLocationPermissionAndGetLocation() {&#10;        if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION)&#10;                == PackageManager.PERMISSION_GRANTED) {&#10;            // Permission already granted&#10;            getCurrentLocation();&#10;        } else {&#10;            // Request permission&#10;            requestLocationPermissionLauncher.launch(Manifest.permission.ACCESS_FINE_LOCATION);&#10;        }&#10;    }&#10;&#10;    // NEW: Get current location using GPS&#10;    private void getCurrentLocation() {&#10;        if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION)&#10;                != PackageManager.PERMISSION_GRANTED) {&#10;            return;&#10;        }&#10;&#10;        Toast.makeText(this, R.string.getting_location, Toast.LENGTH_SHORT).show();&#10;&#10;        fusedLocationClient.getLastLocation()&#10;                .addOnSuccessListener(this, location -&gt; {&#10;                    if (location != null) {&#10;                        // Check location accuracy&#10;                        float accuracy = location.getAccuracy();&#10;&#10;                        // If location is too inaccurate (&gt;1000m), request fresh location&#10;                        if (accuracy &gt; 1000) {&#10;                            Toast.makeText(this, &quot;Location not accurate, requesting fresh location...&quot;, Toast.LENGTH_SHORT).show();&#10;                            requestFreshLocation();&#10;                            return;&#10;                        }&#10;&#10;                        // Got location - fetch weather by coordinates&#10;                        currentLat = location.getLatitude();&#10;                        currentLon = location.getLongitude();&#10;&#10;                        // Debug: Show coordinates to user&#10;                        String coordsMsg = String.format(Locale.getDefault(),&#10;                                &quot;Location: %.4f, %.4f (±%.0fm)&quot;,&#10;                                currentLat, currentLon, accuracy);&#10;                        Toast.makeText(this, coordsMsg, Toast.LENGTH_LONG).show();&#10;&#10;                        fetchWeatherByCoordinates(currentLat, currentLon);&#10;                    } else {&#10;                        // Last location not available, request fresh location&#10;                        requestFreshLocation();&#10;                    }&#10;                })&#10;                .addOnFailureListener(this, e -&gt; {&#10;                    Toast.makeText(this, R.string.location_not_available, Toast.LENGTH_SHORT).show();&#10;                });&#10;    }&#10;&#10;    // Request fresh location when last location is not available&#10;    private void requestFreshLocation() {&#10;        if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION)&#10;                != PackageManager.PERMISSION_GRANTED) {&#10;            return;&#10;        }&#10;&#10;        Toast.makeText(this, &quot;Requesting fresh location...&quot;, Toast.LENGTH_SHORT).show();&#10;&#10;        com.google.android.gms.location.LocationRequest locationRequest =&#10;                new com.google.android.gms.location.LocationRequest.Builder(&#10;                        com.google.android.gms.location.Priority.PRIORITY_HIGH_ACCURACY, 10000)&#10;                        .setMinUpdateIntervalMillis(5000)&#10;                        .setMaxUpdates(1)&#10;                        .build();&#10;&#10;        fusedLocationClient.requestLocationUpdates(locationRequest,&#10;                new com.google.android.gms.location.LocationCallback() {&#10;                    @Override&#10;                    public void onLocationResult(@NonNull com.google.android.gms.location.LocationResult locationResult) {&#10;                        super.onLocationResult(locationResult);&#10;                        if (locationResult != null &amp;&amp; locationResult.getLastLocation() != null) {&#10;                            android.location.Location location = locationResult.getLastLocation();&#10;                            currentLat = location.getLatitude();&#10;                            currentLon = location.getLongitude();&#10;                            float accuracy = location.getAccuracy();&#10;&#10;                            // Debug: Show coordinates to user&#10;                            String coordsMsg = String.format(Locale.getDefault(),&#10;                                    &quot;Fresh location: %.4f, %.4f (±%.0fm)&quot;,&#10;                                    currentLat, currentLon, accuracy);&#10;                            Toast.makeText(MainActivity.this, coordsMsg, Toast.LENGTH_LONG).show();&#10;&#10;                            fetchWeatherByCoordinates(currentLat, currentLon);&#10;                            // Stop location updates after getting location&#10;                            fusedLocationClient.removeLocationUpdates(this);&#10;                        } else {&#10;                            Toast.makeText(MainActivity.this,&#10;                                    &quot;Unable to get your location. Please enable location services.&quot;,&#10;                                    Toast.LENGTH_LONG).show();&#10;                        }&#10;                    }&#10;                }, getMainLooper());&#10;    }&#10;&#10;    // NEW: Fetch weather by GPS coordinates&#10;    private void fetchWeatherByCoordinates(double lat, double lon) {&#10;        binding.progressBar.setVisibility(View.VISIBLE);&#10;        binding.weatherDetailsSection.setVisibility(View.GONE);&#10;        binding.tvError.setVisibility(View.GONE);&#10;&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;        String units = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;metric&quot; : &quot;imperial&quot;;&#10;&#10;        // Debug log&#10;        String apiUrl = String.format(Locale.getDefault(),&#10;                &quot;Fetching weather for: lat=%.4f, lon=%.4f&quot;, lat, lon);&#10;        Toast.makeText(this, apiUrl, Toast.LENGTH_SHORT).show();&#10;&#10;        Call&lt;WeatherResponse&gt; weatherCall = apiService.getWeatherByCoordinates(lat, lon, API_KEY, units);&#10;        weatherCall.enqueue(new Callback&lt;WeatherResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;WeatherResponse&gt; call, Response&lt;WeatherResponse&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    currentWeatherData = response.body();&#10;                    currentCityName = currentWeatherData.getName();&#10;&#10;                    // Update coordinates&#10;                    currentLat = lat;&#10;                    currentLon = lon;&#10;&#10;                    // Debug: Show what API returned&#10;                    String debugMsg = String.format(Locale.getDefault(),&#10;                            &quot;API returned: %s (%.4f, %.4f) - %.0f°&quot;,&#10;                            currentCityName,&#10;                            currentWeatherData.getCoord() != null ? currentWeatherData.getCoord().getLat() : 0,&#10;                            currentWeatherData.getCoord() != null ? currentWeatherData.getCoord().getLon() : 0,&#10;                            currentWeatherData.getMain().getTemp());&#10;                    Toast.makeText(MainActivity.this, debugMsg, Toast.LENGTH_LONG).show();&#10;&#10;                    // Save city name for notifications&#10;                    sharedPreferences.edit().putString(&quot;last_city&quot;, currentCityName).apply();&#10;&#10;                    updateUI(currentWeatherData);&#10;                    // Use coordinates for hourly forecast to get accurate data&#10;                    fetchHourlyForecastByCoordinates(lat, lon);&#10;                    fetchUVIndex(lat, lon);&#10;                    fetchAirQuality(lat, lon);&#10;                } else {&#10;                    binding.progressBar.setVisibility(View.GONE);&#10;                    showError(getString(R.string.error_city_not_found));&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;WeatherResponse&gt; call, Throwable t) {&#10;                binding.progressBar.setVisibility(View.GONE);&#10;                showError(getString(R.string.error_network));&#10;            }&#10;        });&#10;    }&#10;&#10;    // NEW: Update weather widget&#10;    private void updateWeatherWidget(WeatherResponse weatherData) {&#10;        AppWidgetManager appWidgetManager = AppWidgetManager.getInstance(this);&#10;        ComponentName thisWidget = new ComponentName(this, WeatherWidget.class);&#10;        int[] appWidgetIds = appWidgetManager.getAppWidgetIds(thisWidget);&#10;&#10;        for (int appWidgetId : appWidgetIds) {&#10;            // Update each widget instance&#10;            WeatherWidget.updateWidget(this, appWidgetManager, appWidgetId, weatherData);&#10;        }&#10;    }&#10;&#10;&#10;    // NEW: Add current city to favorites&#10;    @SuppressWarnings(&quot;unused&quot;)&#10;    private void addCurrentCityToFavorites() {&#10;        if (currentWeatherData == null) {&#10;            Toast.makeText(this, &quot;No city data available&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        String country = currentWeatherData.getSys() != null ?&#10;                currentWeatherData.getSys().getCountry() : &quot;Unknown&quot;;&#10;&#10;        FavoriteCity favoriteCity = new FavoriteCity(&#10;                currentCityName,&#10;                country,&#10;                currentLat,&#10;                currentLon&#10;        );&#10;&#10;        favoriteCity.setCurrentTemp(currentWeatherData.getMain().getTemp());&#10;        favoriteCity.setWeatherCondition(&#10;                currentWeatherData.getWeather() != null &amp;&amp; !currentWeatherData.getWeather().isEmpty() ?&#10;                        currentWeatherData.getWeather().get(0).getMain() : &quot;Unknown&quot;&#10;        );&#10;        favoriteCity.setWeatherDescription(&#10;                currentWeatherData.getWeather() != null &amp;&amp; !currentWeatherData.getWeather().isEmpty() ?&#10;                        currentWeatherData.getWeather().get(0).getDescription() : &quot;Unknown&quot;&#10;        );&#10;&#10;        if (favoritesManager.addFavoriteCity(favoriteCity)) {&#10;            Toast.makeText(this, currentCityName + &quot; added to favorites&quot;, Toast.LENGTH_SHORT).show();&#10;        } else {&#10;            if (favoritesManager.isFavorite(currentCityName)) {&#10;                Toast.makeText(this, currentCityName + &quot; is already in favorites&quot;, Toast.LENGTH_SHORT).show();&#10;            } else {&#10;                Toast.makeText(this, &quot;Maximum 10 favorite cities allowed&quot;, Toast.LENGTH_SHORT).show();&#10;            }&#10;        }&#10;    }&#10;&#10;    // NEW: Open Favorite Cities Activity&#10;    @SuppressWarnings(&quot;unused&quot;)&#10;    private void openFavoriteCitiesActivity() {&#10;        Intent intent = new Intent(this, FavoriteCitiesActivity.class);&#10;        startActivity(intent);&#10;    }&#10;&#10;    // NEW: Fetch Weather Alerts&#10;    @SuppressWarnings(&quot;unused&quot;)&#10;    private void fetchWeatherAlerts(double lat, double lon) {&#10;        if (lat == 0 &amp;&amp; lon == 0) return;&#10;&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;        Call&lt;WeatherAlertsResponse&gt; alertsCall = apiService.getWeatherAlerts(&#10;                lat, lon, API_KEY, &quot;current,minutely,hourly,daily&quot;&#10;        );&#10;&#10;        alertsCall.enqueue(new Callback&lt;WeatherAlertsResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;WeatherAlertsResponse&gt; call, Response&lt;WeatherAlertsResponse&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null &amp;&amp; response.body().hasAlerts()) {&#10;                    currentAlerts = response.body().getAlerts();&#10;                    updateWeatherAlertsCard();&#10;                } else {&#10;                    // No alerts - hide the card&#10;                    hideWeatherAlertsCard();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;WeatherAlertsResponse&gt; call, Throwable t) {&#10;                // Failed to fetch alerts - hide the card&#10;                hideWeatherAlertsCard();&#10;            }&#10;        });&#10;    }&#10;&#10;    // NEW: Update Weather Alerts Card&#10;    private void updateWeatherAlertsCard() {&#10;        if (currentAlerts == null || currentAlerts.isEmpty()) {&#10;            hideWeatherAlertsCard();&#10;            return;&#10;        }&#10;&#10;        View alertCard = findViewById(R.id.card_weather_alerts);&#10;        if (alertCard == null) return;&#10;&#10;        alertCard.setVisibility(View.VISIBLE);&#10;&#10;        // Get the most severe alert&#10;        WeatherAlert mainAlert = currentAlerts.get(0);&#10;        for (WeatherAlert alert : currentAlerts) {&#10;            if (getSeverityPriority(alert.getSeverity()) &gt; getSeverityPriority(mainAlert.getSeverity())) {&#10;                mainAlert = alert;&#10;            }&#10;        }&#10;&#10;        // Update severity badge&#10;        TextView tvAlertSeverity = alertCard.findViewById(R.id.tvAlertSeverity);&#10;        if (tvAlertSeverity != null) {&#10;            tvAlertSeverity.setText(mainAlert.getSeverity());&#10;            tvAlertSeverity.setBackgroundColor(mainAlert.getSeverityColor());&#10;        }&#10;&#10;        // Update alert details&#10;        TextView tvAlertEvent = alertCard.findViewById(R.id.tvAlertEvent);&#10;        TextView tvAlertDescription = alertCard.findViewById(R.id.tvAlertDescription);&#10;        TextView tvAlertTime = alertCard.findViewById(R.id.tvAlertTime);&#10;&#10;        if (tvAlertEvent != null) {&#10;            tvAlertEvent.setText(mainAlert.getEvent());&#10;        }&#10;&#10;        if (tvAlertDescription != null) {&#10;            String description = mainAlert.getDescription();&#10;            if (description != null &amp;&amp; description.length() &gt; 100) {&#10;                description = description.substring(0, 100) + &quot;...&quot;;&#10;            }&#10;            tvAlertDescription.setText(description);&#10;        }&#10;&#10;        if (tvAlertTime != null) {&#10;            SimpleDateFormat sdf = new SimpleDateFormat(&quot;MMM dd, HH:mm&quot;, Locale.getDefault());&#10;            String timeStr = &quot;Valid until &quot; + sdf.format(mainAlert.getEnd() * 1000);&#10;            tvAlertTime.setText(timeStr);&#10;        }&#10;&#10;        // Setup click listener for &quot;View More&quot;&#10;        TextView btnViewMore = alertCard.findViewById(R.id.btnViewMoreAlerts);&#10;        if (btnViewMore != null &amp;&amp; currentAlerts.size() &gt; 1) {&#10;            btnViewMore.setVisibility(View.VISIBLE);&#10;            btnViewMore.setText(String.format(Locale.getDefault(),&#10;                    &quot;View All Alerts (%d) ›&quot;, currentAlerts.size()));&#10;            btnViewMore.setOnClickListener(v -&gt; showAllAlertsDialog());&#10;        } else if (btnViewMore != null) {&#10;            btnViewMore.setVisibility(View.GONE);&#10;        }&#10;    }&#10;&#10;    private void hideWeatherAlertsCard() {&#10;        View alertCard = findViewById(R.id.card_weather_alerts);&#10;        if (alertCard != null) {&#10;            alertCard.setVisibility(View.GONE);&#10;        }&#10;    }&#10;&#10;    private int getSeverityPriority(String severity) {&#10;        switch (severity) {&#10;            case &quot;EXTREME&quot;: return 4;&#10;            case &quot;HIGH&quot;: return 3;&#10;            case &quot;MODERATE&quot;: return 2;&#10;            case &quot;LOW&quot;: return 1;&#10;            default: return 0;&#10;        }&#10;    }&#10;&#10;    private void showAllAlertsDialog() {&#10;        if (currentAlerts == null || currentAlerts.isEmpty()) return;&#10;&#10;        StringBuilder message = new StringBuilder();&#10;        for (int i = 0; i &lt; currentAlerts.size(); i++) {&#10;            WeatherAlert alert = currentAlerts.get(i);&#10;            message.append((i + 1)).append(&quot;. &quot;).append(alert.getEvent()).append(&quot;\n&quot;);&#10;            message.append(alert.getDescription()).append(&quot;\n\n&quot;);&#10;        }&#10;&#10;        new android.app.AlertDialog.Builder(this)&#10;                .setTitle(&quot;Weather Alerts&quot;)&#10;                .setMessage(message.toString())&#10;                .setPositiveButton(&quot;OK&quot;, null)&#10;                .show();&#10;    }&#10;&#10;    @Override&#10;    protected void onDestroy() {&#10;        super.onDestroy();&#10;        binding = null;&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.weatherapp.ui.activities;&#10;&#10;import android.Manifest;&#10;import android.appwidget.AppWidgetManager;&#10;import android.content.ComponentName;&#10;import android.content.Context;&#10;import android.content.Intent;&#10;import android.content.SharedPreferences;&#10;import android.content.pm.PackageManager;&#10;import android.os.Build;&#10;import android.os.Bundle;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.ImageView;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.activity.EdgeToEdge;&#10;import androidx.activity.result.ActivityResultLauncher;&#10;import androidx.activity.result.contract.ActivityResultContracts;&#10;import androidx.annotation.NonNull;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.core.content.ContextCompat;&#10;import androidx.core.graphics.Insets;&#10;import androidx.core.view.ViewCompat;&#10;import androidx.core.view.WindowInsetsCompat;&#10;import androidx.work.ExistingPeriodicWorkPolicy;&#10;import androidx.work.PeriodicWorkRequest;&#10;import androidx.work.WorkManager;&#10;&#10;import com.example.weatherapp.R;&#10;import com.example.weatherapp.data.api.RetrofitClient;&#10;import com.example.weatherapp.data.api.WeatherApiService;&#10;import com.example.weatherapp.data.models.FavoriteCity;&#10;import com.example.weatherapp.data.models.HourlyForecast;&#10;import com.example.weatherapp.data.models.WeatherAlert;&#10;import com.example.weatherapp.data.models.WeeklyForecast;&#10;import com.example.weatherapp.data.responses.AirQualityResponse;&#10;import com.example.weatherapp.data.responses.HourlyForecastResponse;&#10;import com.example.weatherapp.data.responses.UVIndexResponse;&#10;import com.example.weatherapp.data.responses.WeatherAlertsResponse;&#10;import com.example.weatherapp.data.responses.WeatherResponse;&#10;import com.example.weatherapp.databinding.ActivityMainBinding;&#10;import com.example.weatherapp.notification.WeatherNotificationWorker;&#10;import com.example.weatherapp.utils.BlurHelper;&#10;import com.example.weatherapp.utils.FavoriteCitiesManager;&#10;import com.example.weatherapp.utils.LocaleHelper;&#10;import com.example.weatherapp.widget.WeatherWidget;&#10;import com.google.android.gms.location.FusedLocationProviderClient;&#10;import com.google.android.gms.location.LocationServices;&#10;&#10;import java.text.SimpleDateFormat;&#10;import java.util.ArrayList;&#10;import java.util.Calendar;&#10;import java.util.List;&#10;import java.util.Locale;&#10;import java.util.concurrent.TimeUnit;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class MainActivity extends AppCompatActivity {&#10;&#10;    private ActivityMainBinding binding;&#10;    private static final String API_KEY = &quot;4f8cf691daad596ac4e465c909868d0d&quot;;&#10;    private boolean isSearchVisible = false;&#10;    private boolean isHourlyView = true;&#10;    private WeatherResponse currentWeatherData;&#10;    private HourlyForecastResponse hourlyForecastData;&#10;    private String currentCityName = &quot;Hanoi&quot;;&#10;    private double currentLat = 0;&#10;    private double currentLon = 0;&#10;    private int currentUVIndex = 0;&#10;    private AirQualityResponse.AirQualityData currentAQIData; // Add this&#10;    private SharedPreferences sharedPreferences;&#10;    private FavoriteCitiesManager favoritesManager; // Add favorite cities manager&#10;    private List&lt;WeatherAlert&gt; currentAlerts; // Add weather alerts list&#10;&#10;    // Unit settings&#10;    private String temperatureUnit = &quot;celsius&quot;;&#10;    private String windSpeedUnit = &quot;ms&quot;;&#10;    private String pressureUnit = &quot;hpa&quot;;&#10;&#10;    // Location&#10;    private FusedLocationProviderClient fusedLocationClient;&#10;&#10;    // Notification permission launcher&#10;    private final ActivityResultLauncher&lt;String&gt; requestPermissionLauncher =&#10;            registerForActivityResult(new ActivityResultContracts.RequestPermission(), isGranted -&gt; {&#10;                if (isGranted) {&#10;                    // Permission granted - schedule notifications&#10;                    scheduleWeatherNotifications();&#10;                    Toast.makeText(this, &quot;Weather notifications enabled&quot;, Toast.LENGTH_SHORT).show();&#10;                } else {&#10;                    // Permission denied&#10;                    Toast.makeText(this, &quot;Notification permission denied&quot;, Toast.LENGTH_SHORT).show();&#10;                }&#10;            });&#10;&#10;    // Activity Result API (modern way - no memory leak)&#10;    private final ActivityResultLauncher&lt;Intent&gt; searchLauncher = registerForActivityResult(&#10;            new ActivityResultContracts.StartActivityForResult(),&#10;            result -&gt; {&#10;                if (result.getResultCode() == RESULT_OK &amp;&amp; result.getData() != null) {&#10;                    // Check if using GPS location&#10;                    boolean useGPS = result.getData().getBooleanExtra(SearchActivity.EXTRA_USE_GPS, false);&#10;&#10;                    if (useGPS) {&#10;                        // Get coordinates from GPS&#10;                        double latitude = result.getData().getDoubleExtra(SearchActivity.EXTRA_LATITUDE, 0);&#10;                        double longitude = result.getData().getDoubleExtra(SearchActivity.EXTRA_LONGITUDE, 0);&#10;&#10;                        if (latitude != 0 &amp;&amp; longitude != 0) {&#10;                            // Fetch weather by coordinates&#10;                            fetchWeatherByCoordinates(latitude, longitude);&#10;                        }&#10;                    } else {&#10;                        // Get city name from search&#10;                        String cityName = result.getData().getStringExtra(SearchActivity.EXTRA_CITY_NAME);&#10;                        if (cityName != null &amp;&amp; !cityName.isEmpty()) {&#10;                            currentCityName = cityName;&#10;                            fetchAllWeatherData(cityName);&#10;                        }&#10;                    }&#10;                }&#10;            });&#10;&#10;    // Settings launcher&#10;    private final ActivityResultLauncher&lt;Intent&gt; settingsLauncher = registerForActivityResult(&#10;            new ActivityResultContracts.StartActivityForResult(),&#10;            result -&gt; {&#10;                if (result.getResultCode() == RESULT_OK) {&#10;                    // Check if language changed&#10;                    boolean languageChanged = result.getData() != null &amp;&amp;&#10;                            result.getData().getBooleanExtra(&quot;language_changed&quot;, false);&#10;&#10;                    if (languageChanged) {&#10;                        // Language changed - recreate MainActivity to apply new language&#10;                        recreate();&#10;                        return;&#10;                    }&#10;&#10;                    // Store old temperature unit to check if it changed&#10;                    String oldTempUnit = temperatureUnit;&#10;&#10;                    // Reload settings&#10;                    loadSettings();&#10;&#10;                    // If temperature unit changed, refetch data from API with correct unit&#10;                    if (!oldTempUnit.equals(temperatureUnit)) {&#10;                        // Temperature unit changed - need to fetch new data&#10;                        fetchAllWeatherData(currentCityName);&#10;                    } else {&#10;                        // Only wind/pressure unit changed - just update UI&#10;                        if (currentWeatherData != null) {&#10;                            updateUI(currentWeatherData);&#10;                        }&#10;                        if (hourlyForecastData != null) {&#10;                            updateForecastView();&#10;                        }&#10;                    }&#10;                }&#10;            });&#10;&#10;    // Location permission launcher&#10;    private final ActivityResultLauncher&lt;String&gt; requestLocationPermissionLauncher =&#10;            registerForActivityResult(new ActivityResultContracts.RequestPermission(), isGranted -&gt; {&#10;                if (isGranted) {&#10;                    // Permission granted - get location&#10;                    getCurrentLocation();&#10;                } else {&#10;                    // Permission denied&#10;                    Toast.makeText(this, R.string.permission_denied, Toast.LENGTH_SHORT).show();&#10;                }&#10;            });&#10;&#10;    @Override&#10;    protected void attachBaseContext(Context newBase) {&#10;        super.attachBaseContext(LocaleHelper.onAttach(newBase));&#10;    }&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;&#10;        // Apply saved language first&#10;        applyLanguagePreference();&#10;&#10;        EdgeToEdge.enable(this);&#10;        binding = ActivityMainBinding.inflate(getLayoutInflater());&#10;        setContentView(binding.getRoot());&#10;&#10;        sharedPreferences = getSharedPreferences(&quot;WeatherAppPrefs&quot;, MODE_PRIVATE);&#10;&#10;        // Initialize location client&#10;        fusedLocationClient = LocationServices.getFusedLocationProviderClient(this);&#10;&#10;        // Initialize favorites manager&#10;        favoritesManager = new FavoriteCitiesManager(this);&#10;&#10;        // Load settings&#10;        loadSettings();&#10;&#10;        // Request notification permission for Android 13+&#10;        checkNotificationPermission();&#10;&#10;        // Schedule weather notifications&#10;        scheduleWeatherNotifications();&#10;&#10;        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main), (v, insets) -&gt; {&#10;            Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());&#10;            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);&#10;            return insets;&#10;        });&#10;&#10;        setupListeners();&#10;&#10;        // Apply glass morphism effects to UI elements&#10;        applyGlassMorphismEffects();&#10;&#10;        // Apply blur effect to top glass bar (API 31+)&#10;        applyTopBarBlurEffect();&#10;&#10;        fetchAllWeatherData(currentCityName);&#10;    }&#10;&#10;    /**&#10;     * Apply blur effect to the glass capsule top bar using native Android blur&#10;     * Uses setBackgroundBlurRadius (Android 12+) - only blurs backdrop, content stays sharp&#10;     */&#10;    private void applyTopBarBlurEffect() {&#10;        View topGlassBar = findViewById(R.id.topGlassBar);&#10;        if (topGlassBar == null) return;&#10;&#10;        // Calculate corner radius in pixels&#10;        float density = getResources().getDisplayMetrics().density;&#10;        float cornerRadiusPx = 32f * density; // 32dp corner radius&#10;&#10;        // Set outline provider for rounded corners&#10;        topGlassBar.setOutlineProvider(new android.view.ViewOutlineProvider() {&#10;            @Override&#10;            public void getOutline(View view, android.graphics.Outline outline) {&#10;                outline.setRoundRect(0, 0, view.getWidth(), view.getHeight(), cornerRadiusPx);&#10;            }&#10;        });&#10;        topGlassBar.setClipToOutline(true);&#10;&#10;        // Create glass morphism background with higher opacity for better visibility&#10;        android.graphics.drawable.GradientDrawable background = new android.graphics.drawable.GradientDrawable();&#10;        background.setColor(android.graphics.Color.argb(40, 255, 255, 255)); // ~16% white opacity - more visible&#10;        background.setCornerRadius(cornerRadiusPx);&#10;        background.setStroke((int)(1.5f * density), android.graphics.Color.argb(80, 255, 255, 255)); // ~31% white border&#10;        topGlassBar.setBackground(background);&#10;&#10;        // Set elevation for depth&#10;        topGlassBar.setElevation(12f * density);&#10;    }&#10;&#10;    private void loadSettings() {&#10;        temperatureUnit = SettingsActivity.getTemperatureUnit(sharedPreferences);&#10;        windSpeedUnit = SettingsActivity.getWindSpeedUnit(sharedPreferences);&#10;        pressureUnit = SettingsActivity.getPressureUnit(sharedPreferences);&#10;    }&#10;&#10;    private void applyLanguagePreference() {&#10;        SharedPreferences prefs = getSharedPreferences(&quot;WeatherAppPrefs&quot;, MODE_PRIVATE);&#10;        String language = prefs.getString(&quot;language&quot;, &quot;vi&quot;); // Fixed: Changed default from &quot;en&quot; to &quot;vi&quot;&#10;        LocaleHelper.setLocale(this, language);&#10;    }&#10;&#10;    private void setupListeners() {&#10;        // Top Bar Glass Capsule - Settings Icon&#10;        binding.btnSettingsIcon.setOnClickListener(v -&gt; {&#10;            Intent intent = new Intent(MainActivity.this, SettingsActivity.class);&#10;            settingsLauncher.launch(intent);&#10;        });&#10;&#10;        // Top Bar Glass Capsule - Search Icon&#10;        binding.btnSearchIcon.setOnClickListener(v -&gt; {&#10;            Intent intent = new Intent(MainActivity.this, SearchActivity.class);&#10;            searchLauncher.launch(intent);&#10;        });&#10;&#10;        // Top Bar City Name - tap to search location&#10;        binding.tvTopBarCityName.setOnClickListener(v -&gt; {&#10;            Intent intent = new Intent(MainActivity.this, SearchActivity.class);&#10;            searchLauncher.launch(intent);&#10;        });&#10;&#10;&#10;        // Search button click&#10;        binding.btnSearch.setOnClickListener(v -&gt; {&#10;            String cityName = binding.etCityName.getText().toString().trim();&#10;            if (!cityName.isEmpty()) {&#10;                currentCityName = cityName;&#10;                fetchAllWeatherData(cityName);&#10;                toggleSearchBar();&#10;            } else {&#10;                Toast.makeText(MainActivity.this, &quot;Please enter a city name&quot;, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;&#10;        // Current Location button click - NEW&#10;        binding.btnCurrentLocation.setOnClickListener(v -&gt; {&#10;            checkLocationPermissionAndGetLocation();&#10;            toggleSearchBar();&#10;        });&#10;&#10;        // View Charts button click - NEW&#10;        binding.btnViewCharts.setOnClickListener(v -&gt; {&#10;            openChartsActivity();&#10;        });&#10;&#10;        // Outfit Suggestion button click - NEW&#10;        binding.btnOutfitSuggestion.setOnClickListener(v -&gt; {&#10;            openOutfitSuggestionActivity();&#10;        });&#10;&#10;        // Hourly/Weekly toggle buttons&#10;        binding.btnHourly.setOnClickListener(v -&gt; {&#10;            if (!isHourlyView) {&#10;                isHourlyView = true;&#10;                animateTabSelection(true);&#10;                updateForecastView();&#10;            }&#10;        });&#10;&#10;        binding.btnWeekly.setOnClickListener(v -&gt; {&#10;            if (isHourlyView) {&#10;                isHourlyView = false;&#10;                animateTabSelection(false);&#10;                updateForecastView();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void toggleSearchBar() {&#10;        isSearchVisible = !isSearchVisible;&#10;        binding.searchContainer.setVisibility(isSearchVisible ? View.VISIBLE : View.GONE);&#10;    }&#10;&#10;    /**&#10;     * Apply glass morphism effects to UI elements for a modern, translucent look&#10;     * BLUR EFFECT ĐÃ TẮT - chỉ dùng background drawable để UI rõ ràng&#10;     */&#10;    private void applyGlassMorphismEffects() {&#10;        // TẮT blur effect - gây mờ quá mức&#10;        // Chỉ dùng glass panel background (semi-transparent white)&#10;        // Background drawables already have overlay #33FFFFFF and stroke #4DFFFFFF&#10;&#10;        // KHÔNG apply blur nữa để UI rõ ràng&#10;        /* DISABLED - causes blur&#10;        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S) {&#10;            applyBlurEffect(binding.searchContainer);&#10;&#10;            // Apply blur to the main forecast card container&#10;            View forecastCard = findViewById(R.id.weatherDetailsSection);&#10;            if (forecastCard != null) {&#10;                applyBlurEffect(forecastCard);&#10;            }&#10;        }&#10;        */&#10;    }&#10;&#10;    /**&#10;     * Apply blur effect to a view (API 31+)&#10;     * DISABLED - causes too much blur&#10;     */&#10;    private void applyBlurEffect(View view) {&#10;        // KHÔNG apply blur để UI rõ ràng&#10;        /* DISABLED&#10;        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S) {&#10;            android.graphics.RenderEffect blurEffect = android.graphics.RenderEffect.createBlurEffect(&#10;                    10f, 10f, android.graphics.Shader.TileMode.CLAMP&#10;            );&#10;            view.setRenderEffect(blurEffect);&#10;        }&#10;        */&#10;    }&#10;&#10;    private void fetchAllWeatherData(String cityName) {&#10;        binding.progressBar.setVisibility(View.VISIBLE);&#10;        binding.weatherDetailsSection.setVisibility(View.GONE);&#10;        binding.tvError.setVisibility(View.GONE);&#10;&#10;        // Save current city to preferences for notifications&#10;        sharedPreferences.edit().putString(&quot;last_city&quot;, cityName).apply();&#10;&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;&#10;        // Use metric for Celsius, imperial for Fahrenheit&#10;        String units = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;metric&quot; : &quot;imperial&quot;;&#10;&#10;        // Log API call for debugging&#10;        android.util.Log.d(&quot;WeatherApp&quot;, &quot;Fetching weather for city: &quot; + cityName + &quot;, units: &quot; + units + &quot;, API_KEY: &quot; + API_KEY.substring(0, 8) + &quot;...&quot;);&#10;&#10;        // Fetch current weather&#10;        Call&lt;WeatherResponse&gt; weatherCall = apiService.getWeatherByCity(cityName, API_KEY, units);&#10;        weatherCall.enqueue(new Callback&lt;WeatherResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;WeatherResponse&gt; call, Response&lt;WeatherResponse&gt; response) {&#10;                android.util.Log.d(&quot;WeatherApp&quot;, &quot;Response code: &quot; + response.code());&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    currentWeatherData = response.body();&#10;                    android.util.Log.d(&quot;WeatherApp&quot;, &quot;Weather data received for: &quot; + currentWeatherData.getName());&#10;&#10;                    // Get coordinates for UV Index API&#10;                    if (currentWeatherData.getCoord() != null) {&#10;                        currentLat = currentWeatherData.getCoord().getLat();&#10;                        currentLon = currentWeatherData.getCoord().getLon();&#10;                    }&#10;&#10;                    updateUI(currentWeatherData);&#10;&#10;                    // After current weather, fetch hourly forecast, UV index, and Air Quality&#10;                    fetchHourlyForecast(cityName);&#10;                    fetchUVIndex(currentLat, currentLon);&#10;                    fetchAirQuality(currentLat, currentLon);&#10;                } else {&#10;                    binding.progressBar.setVisibility(View.GONE);&#10;                    String errorMsg = &quot;City not found&quot;;&#10;                    try {&#10;                        if (response.errorBody() != null) {&#10;                            errorMsg = response.errorBody().string();&#10;                            android.util.Log.e(&quot;WeatherApp&quot;, &quot;Error response: &quot; + errorMsg);&#10;                        }&#10;                    } catch (Exception e) {&#10;                        android.util.Log.e(&quot;WeatherApp&quot;, &quot;Error reading error body&quot;, e);&#10;                    }&#10;                    showError(&quot;City not found. Please check the city name and try again.&quot;);&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;WeatherResponse&gt; call, Throwable t) {&#10;                android.util.Log.e(&quot;WeatherApp&quot;, &quot;Network error&quot;, t);&#10;                binding.progressBar.setVisibility(View.GONE);&#10;                showError(getNetworkErrorMessage(t));&#10;            }&#10;        });&#10;    }&#10;&#10;    private void fetchUVIndex(double lat, double lon) {&#10;        if (lat == 0 &amp;&amp; lon == 0) return;&#10;&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;        Call&lt;UVIndexResponse&gt; uvCall = apiService.getUVIndex(lat, lon, API_KEY);&#10;&#10;        uvCall.enqueue(new Callback&lt;UVIndexResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;UVIndexResponse&gt; call, Response&lt;UVIndexResponse&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    currentUVIndex = (int) Math.round(response.body().getValue());&#10;                    updateUVIndexCard();&#10;                } else {&#10;                    // Keep default UV index if API fails&#10;                    currentUVIndex = 0;&#10;                    updateUVIndexCard();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;UVIndexResponse&gt; call, Throwable t) {&#10;                // Keep default UV index if API fails&#10;                currentUVIndex = 0;&#10;                updateUVIndexCard();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void updateUVIndexCard() {&#10;        String uvDesc;&#10;        if (currentUVIndex &lt; 3) {&#10;            uvDesc = &quot;Low&quot;;&#10;        } else if (currentUVIndex &lt; 6) {&#10;            uvDesc = &quot;Moderate&quot;;&#10;        } else if (currentUVIndex &lt; 8) {&#10;            uvDesc = &quot;High&quot;;&#10;        } else if (currentUVIndex &lt; 11) {&#10;            uvDesc = &quot;Very High&quot;;&#10;        } else {&#10;            uvDesc = &quot;Extreme&quot;;&#10;        }&#10;&#10;        updateCard(R.id.cardUvIndex, &quot;☀️&quot;, &quot;UV INDEX&quot;,&#10;                String.valueOf(currentUVIndex), uvDesc);&#10;    }&#10;&#10;    // NEW: Fetch Air Quality Index&#10;    private void fetchAirQuality(double lat, double lon) {&#10;        if (lat == 0 &amp;&amp; lon == 0) return;&#10;&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;        Call&lt;AirQualityResponse&gt; aqiCall = apiService.getAirQuality(lat, lon, API_KEY);&#10;&#10;        aqiCall.enqueue(new Callback&lt;AirQualityResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;AirQualityResponse&gt; call, Response&lt;AirQualityResponse&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null&#10;                        &amp;&amp; response.body().getList() != null &amp;&amp; !response.body().getList().isEmpty()) {&#10;                    currentAQIData = response.body().getList().get(0);&#10;                    updateAirQualityCard();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;AirQualityResponse&gt; call, Throwable t) {&#10;                // Keep default AQI if API fails&#10;            }&#10;        });&#10;    }&#10;&#10;    // NEW: Update Air Quality card&#10;    private void updateAirQualityCard() {&#10;        if (currentAQIData == null) return;&#10;&#10;        View aqiCard = findViewById(R.id.card_air_quality);&#10;        if (aqiCard == null) return;&#10;&#10;        int aqi = currentAQIData.getMain().getAqi();&#10;        String status;&#10;        String description;&#10;&#10;        switch (aqi) {&#10;            case 1:&#10;                status = &quot;Good&quot;;&#10;                description = &quot;Air quality is satisfactory&quot;;&#10;                break;&#10;            case 2:&#10;                status = &quot;Fair&quot;;&#10;                description = &quot;Air quality is acceptable&quot;;&#10;                break;&#10;            case 3:&#10;                status = &quot;Moderate&quot;;&#10;                description = &quot;Sensitive groups may be affected&quot;;&#10;                break;&#10;            case 4:&#10;                status = &quot;Poor&quot;;&#10;                description = &quot;Everyone may experience health effects&quot;;&#10;                break;&#10;            case 5:&#10;                status = &quot;Very Poor&quot;;&#10;                description = &quot;Health alert: everyone may be affected&quot;;&#10;                break;&#10;            default:&#10;                status = &quot;Unknown&quot;;&#10;                description = &quot;No data available&quot;;&#10;        }&#10;&#10;        TextView tvAqiValue = aqiCard.findViewById(R.id.tvAqiValue);&#10;        TextView tvAqiStatus = aqiCard.findViewById(R.id.tvAqiStatus);&#10;        TextView tvAqiDescription = aqiCard.findViewById(R.id.tvAqiDescription);&#10;        TextView tvPm25 = aqiCard.findViewById(R.id.tvPm25);&#10;        TextView tvPm10 = aqiCard.findViewById(R.id.tvPm10);&#10;        TextView tvO3 = aqiCard.findViewById(R.id.tvO3);&#10;&#10;        if (tvAqiValue != null) tvAqiValue.setText(String.valueOf(aqi));&#10;        if (tvAqiStatus != null) tvAqiStatus.setText(status);&#10;        if (tvAqiDescription != null) tvAqiDescription.setText(description);&#10;&#10;        if (currentAQIData.getComponents() != null) {&#10;            if (tvPm25 != null) tvPm25.setText(String.format(Locale.getDefault(), &quot;%.1f&quot;, currentAQIData.getComponents().getPm2_5()));&#10;            if (tvPm10 != null) tvPm10.setText(String.format(Locale.getDefault(), &quot;%.1f&quot;, currentAQIData.getComponents().getPm10()));&#10;            if (tvO3 != null) tvO3.setText(String.format(Locale.getDefault(), &quot;%.1f&quot;, currentAQIData.getComponents().getO3()));&#10;        }&#10;    }&#10;&#10;    private void fetchHourlyForecast(String cityName) {&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;        String units = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;metric&quot; : &quot;imperial&quot;;&#10;        Call&lt;HourlyForecastResponse&gt; hourlyCall = apiService.getHourlyForecast(cityName, API_KEY, units);&#10;&#10;        hourlyCall.enqueue(new Callback&lt;HourlyForecastResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;HourlyForecastResponse&gt; call, Response&lt;HourlyForecastResponse&gt; response) {&#10;                binding.progressBar.setVisibility(View.GONE);&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    hourlyForecastData = response.body();&#10;                    updateForecastView();&#10;                    binding.weatherDetailsSection.setVisibility(View.VISIBLE);&#10;                } else {&#10;                    // If hourly forecast fails, still show weather details&#10;                    binding.weatherDetailsSection.setVisibility(View.VISIBLE);&#10;                    Toast.makeText(MainActivity.this, &quot;Could not load hourly forecast&quot;, Toast.LENGTH_SHORT).show();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;HourlyForecastResponse&gt; call, Throwable t) {&#10;                binding.progressBar.setVisibility(View.GONE);&#10;                binding.weatherDetailsSection.setVisibility(View.VISIBLE);&#10;                Toast.makeText(MainActivity.this, &quot;Could not load hourly forecast&quot;, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;    }&#10;&#10;    // NEW: Fetch hourly forecast by GPS coordinates&#10;    private void fetchHourlyForecastByCoordinates(double lat, double lon) {&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;        String units = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;metric&quot; : &quot;imperial&quot;;&#10;        Call&lt;HourlyForecastResponse&gt; hourlyCall = apiService.getHourlyForecastByCoordinates(lat, lon, API_KEY, units);&#10;&#10;        hourlyCall.enqueue(new Callback&lt;HourlyForecastResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;HourlyForecastResponse&gt; call, Response&lt;HourlyForecastResponse&gt; response) {&#10;                binding.progressBar.setVisibility(View.GONE);&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    hourlyForecastData = response.body();&#10;                    updateForecastView();&#10;                    binding.weatherDetailsSection.setVisibility(View.VISIBLE);&#10;                } else {&#10;                    // If hourly forecast fails, still show weather details&#10;                    binding.weatherDetailsSection.setVisibility(View.VISIBLE);&#10;                    Toast.makeText(MainActivity.this, &quot;Could not load hourly forecast&quot;, Toast.LENGTH_SHORT).show();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;HourlyForecastResponse&gt; call, Throwable t) {&#10;                binding.progressBar.setVisibility(View.GONE);&#10;                binding.weatherDetailsSection.setVisibility(View.VISIBLE);&#10;                Toast.makeText(MainActivity.this, &quot;Could not load hourly forecast&quot;, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;    }&#10;&#10;    // NEW: Open Charts Activity&#10;    private void openChartsActivity() {&#10;        if (hourlyForecastData == null || currentWeatherData == null) {&#10;            Toast.makeText(this, &quot;Weather data not available yet&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        Intent intent = new Intent(this, ChartsActivity.class);&#10;        intent.putExtra(&quot;hourly_data&quot;, hourlyForecastData);&#10;        intent.putExtra(&quot;current_data&quot;, currentWeatherData);&#10;        intent.putExtra(&quot;uv_index&quot;, currentUVIndex);&#10;        startActivity(intent);&#10;    }&#10;&#10;    // NEW: Open Outfit Suggestion Activity&#10;    private void openOutfitSuggestionActivity() {&#10;        if (currentWeatherData == null) {&#10;            Toast.makeText(this, &quot;Weather data not available yet&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        Intent intent = new Intent(this, OutfitSuggestionActivity.class);&#10;        intent.putExtra(&quot;weather_data&quot;, currentWeatherData);&#10;        startActivity(intent);&#10;    }&#10;&#10;    private void updateForecastView() {&#10;        if (currentWeatherData == null) return;&#10;&#10;        if (isHourlyView) {&#10;            if (hourlyForecastData != null) {&#10;                createHourlyForecastFromAPI(hourlyForecastData);&#10;            } else {&#10;                // Show message that forecast data is not available&#10;                showForecastUnavailable();&#10;            }&#10;        } else {&#10;            if (hourlyForecastData != null) {&#10;                createWeeklyForecastFromAPI(hourlyForecastData);&#10;            } else {&#10;                // Show message that forecast data is not available&#10;                showForecastUnavailable();&#10;            }&#10;        }&#10;    }&#10;&#10;    private void showForecastUnavailable() {&#10;        binding.hourlyForecastContainer.removeAllViews();&#10;        // Could add a TextView here to show &quot;Forecast data unavailable&quot;&#10;        Toast.makeText(this, &quot;Forecast data is currently unavailable&quot;, Toast.LENGTH_SHORT).show();&#10;    }&#10;&#10;    private void createHourlyForecastFromAPI(HourlyForecastResponse forecastData) {&#10;        binding.hourlyForecastContainer.removeAllViews();&#10;&#10;        List&lt;HourlyForecastResponse.HourlyItem&gt; hourlyItems = forecastData.getList();&#10;        if (hourlyItems == null || hourlyItems.isEmpty()) {&#10;            return;&#10;        }&#10;&#10;        boolean isFirst = true;&#10;&#10;        // Show next 8 items (24 hours, since API returns 3-hour intervals)&#10;        int itemsToShow = Math.min(8, hourlyItems.size());&#10;&#10;        for (int i = 0; i &lt; itemsToShow; i++) {&#10;            HourlyForecastResponse.HourlyItem item = hourlyItems.get(i);&#10;&#10;            View itemView;&#10;            if (isFirst) {&#10;                itemView = LayoutInflater.from(this).inflate(R.layout.item_hourly_forecast_now, binding.hourlyForecastContainer, false);&#10;                isFirst = false;&#10;            } else {&#10;                itemView = LayoutInflater.from(this).inflate(R.layout.item_hourly_forecast, binding.hourlyForecastContainer, false);&#10;            }&#10;&#10;            TextView txtHour = itemView.findViewById(R.id.tvHour);&#10;            ImageView ivHourlyIcon = itemView.findViewById(R.id.ivHourlyIcon);&#10;            TextView tvHourlyTemp = itemView.findViewById(R.id.tvHourlyTemp);&#10;            TextView tvRainProbability = itemView.findViewById(R.id.tvRainProbability);&#10;&#10;            // Format time&#10;            Calendar itemTime = Calendar.getInstance();&#10;            itemTime.setTimeInMillis(item.getDt() * 1000);&#10;&#10;            if (i == 0) {&#10;                txtHour.setText(&quot;Now&quot;);&#10;            } else {&#10;                int hour = itemTime.get(Calendar.HOUR);&#10;                if (hour == 0) hour = 12;&#10;                String amPm = itemTime.get(Calendar.AM_PM) == Calendar.AM ? &quot;AM&quot; : &quot;PM&quot;;&#10;                txtHour.setText(hour + amPm); // Removed space between hour and AM/PM&#10;            }&#10;&#10;            // Set weather icon&#10;            String weatherCondition = item.getWeather().get(0).getMain().toLowerCase();&#10;            ivHourlyIcon.setImageResource(getWeatherIconResource(weatherCondition));&#10;&#10;            // Set temperature with unit symbol&#10;            int temp = (int) Math.round(item.getMain().getTemp());&#10;            String tempSymbol = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;°&quot; : &quot;°F&quot;;&#10;            tvHourlyTemp.setText(String.format(Locale.getDefault(), &quot;%d%s&quot;, temp, tempSymbol));&#10;&#10;            // Set rain probability&#10;            if (tvRainProbability != null) {&#10;                int rainProb = (int) (item.getPop() * 100);&#10;                if (rainProb &gt; 0 &amp;&amp; i &gt; 0) { // Don't show for &quot;Now&quot;&#10;                    tvRainProbability.setText(String.format(Locale.getDefault(), &quot;%d%%&quot;, rainProb));&#10;                    tvRainProbability.setVisibility(View.VISIBLE);&#10;                } else {&#10;                    tvRainProbability.setVisibility(View.INVISIBLE);&#10;                }&#10;            }&#10;&#10;            binding.hourlyForecastContainer.addView(itemView);&#10;        }&#10;    }&#10;&#10;    private void createWeeklyForecastFromAPI(HourlyForecastResponse forecastData) {&#10;        binding.hourlyForecastContainer.removeAllViews();&#10;&#10;        List&lt;HourlyForecastResponse.HourlyItem&gt; hourlyItems = forecastData.getList();&#10;        if (hourlyItems == null || hourlyItems.isEmpty()) {&#10;            return;&#10;        }&#10;&#10;        String[] days = {&quot;SUN&quot;, &quot;MON&quot;, &quot;TUE&quot;, &quot;WED&quot;, &quot;THU&quot;, &quot;FRI&quot;, &quot;SAT&quot;};&#10;        Calendar calendar = Calendar.getInstance();&#10;&#10;        // Group by day and get max temp for each day&#10;        List&lt;DailyData&gt; dailyDataList = new ArrayList&lt;&gt;();&#10;        String currentDay = &quot;&quot;;&#10;        DailyData currentDailyData = null;&#10;&#10;        for (HourlyForecastResponse.HourlyItem item : hourlyItems) {&#10;            calendar.setTimeInMillis(item.getDt() * 1000);&#10;            String dayKey = days[calendar.get(Calendar.DAY_OF_WEEK) - 1];&#10;&#10;            if (!dayKey.equals(currentDay)) {&#10;                if (currentDailyData != null) {&#10;                    dailyDataList.add(currentDailyData);&#10;                }&#10;                currentDailyData = new DailyData(dayKey);&#10;                currentDay = dayKey;&#10;            }&#10;&#10;            currentDailyData.addItem(item);&#10;&#10;            if (dailyDataList.size() &gt;= 7) break;&#10;        }&#10;&#10;        if (currentDailyData != null &amp;&amp; dailyDataList.size() &lt; 7) {&#10;            dailyDataList.add(currentDailyData);&#10;        }&#10;&#10;        // Display daily forecasts&#10;        boolean isFirst = true;&#10;        String tempSymbol = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;°&quot; : &quot;°F&quot;;&#10;&#10;        for (DailyData dailyData : dailyDataList) {&#10;            View itemView;&#10;&#10;            if (isFirst) {&#10;                itemView = LayoutInflater.from(this).inflate(R.layout.item_weekly_forecast_today, binding.hourlyForecastContainer, false);&#10;                isFirst = false;&#10;            } else {&#10;                itemView = LayoutInflater.from(this).inflate(R.layout.item_weekly_forecast, binding.hourlyForecastContainer, false);&#10;            }&#10;&#10;            TextView tvDay = itemView.findViewById(R.id.tvDay);&#10;            ImageView ivWeeklyIcon = itemView.findViewById(R.id.ivWeeklyIcon);&#10;            TextView tvWeeklyTemp = itemView.findViewById(R.id.tvWeeklyTemp);&#10;            TextView tvWeeklyRainProbability = itemView.findViewById(R.id.tvWeeklyRainProbability);&#10;&#10;            tvDay.setText(dailyData.dayName);&#10;            ivWeeklyIcon.setImageResource(getWeatherIconResource(dailyData.mainWeatherCondition));&#10;            tvWeeklyTemp.setText(String.format(Locale.getDefault(), &quot;%d%s&quot;, dailyData.maxTemp, tempSymbol));&#10;&#10;            if (tvWeeklyRainProbability != null) {&#10;                if (dailyData.maxRainProbability &gt; 0) {&#10;                    tvWeeklyRainProbability.setText(String.format(Locale.getDefault(), &quot;%d%%&quot;, dailyData.maxRainProbability));&#10;                    tvWeeklyRainProbability.setVisibility(View.VISIBLE);&#10;                } else {&#10;                    tvWeeklyRainProbability.setVisibility(View.INVISIBLE);&#10;                }&#10;            }&#10;&#10;            binding.hourlyForecastContainer.addView(itemView);&#10;        }&#10;    }&#10;&#10;    // Helper class to group hourly data by day&#10;    private static class DailyData {&#10;        String dayName;&#10;        int maxTemp = Integer.MIN_VALUE;&#10;        int maxRainProbability = 0;&#10;        String mainWeatherCondition = &quot;clear&quot;;&#10;&#10;        DailyData(String dayName) {&#10;            this.dayName = dayName;&#10;        }&#10;&#10;        void addItem(HourlyForecastResponse.HourlyItem item) {&#10;            int temp = (int) Math.round(item.getMain().getTemp());&#10;            if (temp &gt; maxTemp) {&#10;                maxTemp = temp;&#10;                mainWeatherCondition = item.getWeather().get(0).getMain().toLowerCase();&#10;            }&#10;&#10;            int rainProb = (int) (item.getPop() * 100);&#10;            if (rainProb &gt; maxRainProbability) {&#10;                maxRainProbability = rainProb;&#10;            }&#10;        }&#10;    }&#10;&#10;&#10;    private void updateUI(WeatherResponse weatherData) {&#10;        // Update city name&#10;        binding.tvCityName.setText(weatherData.getName());&#10;&#10;        // Update top bar city name (the visible one)&#10;        binding.tvTopBarCityName.setText(weatherData.getName());&#10;&#10;        // Update weather description&#10;        if (weatherData.getWeather() != null &amp;&amp; !weatherData.getWeather().isEmpty()) {&#10;            String description = weatherData.getWeather().get(0).getDescription();&#10;            binding.tvWeatherDescription.setText(capitalizeWords(description));&#10;        }&#10;&#10;        // Update main temperature with correct unit&#10;        double temp = weatherData.getMain().getTemp();&#10;        String tempSymbol = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;°&quot; : &quot;°F&quot;;&#10;        binding.tvTemperature.setText(String.format(Locale.getDefault(), &quot;%.0f%s&quot;, temp, tempSymbol));&#10;&#10;        // Update temperature range&#10;        double tempMax = weatherData.getMain().getTempMax();&#10;        double tempMin = weatherData.getMain().getTempMin();&#10;        binding.tvTempRange.setText(String.format(Locale.getDefault(),&#10;                &quot;H:%.0f%s   L:%.0f%s&quot;, tempMax, tempSymbol, tempMin, tempSymbol));&#10;&#10;        // Update 10-Day Forecast Summary&#10;        TextView tvForecastSummary = binding.getRoot().findViewById(R.id.tvForecastSummary);&#10;        if (tvForecastSummary != null) {&#10;            String weatherCondition = weatherData.getWeather().get(0).getMain().toLowerCase();&#10;            String summary = generateForecastSummary(weatherCondition);&#10;            tvForecastSummary.setText(summary);&#10;        }&#10;&#10;        // Update Weather Details Cards&#10;        updateWeatherDetailsCards(weatherData);&#10;&#10;        // Update widget&#10;        updateWeatherWidget(weatherData);&#10;    }&#10;&#10;    private String generateForecastSummary(String weatherCondition) {&#10;        // Use actual forecast data if available&#10;        if (hourlyForecastData != null &amp;&amp; hourlyForecastData.getList() != null) {&#10;            // Group by day to count properly&#10;            java.util.Map&lt;Integer, Integer&gt; rainyItemsPerDay = new java.util.HashMap&lt;&gt;();&#10;            java.util.Map&lt;String, Integer&gt; conditionCounts = new java.util.HashMap&lt;&gt;();&#10;&#10;            Calendar calendar = Calendar.getInstance();&#10;&#10;            for (HourlyForecastResponse.HourlyItem item : hourlyForecastData.getList()) {&#10;                if (item.getWeather() != null &amp;&amp; !item.getWeather().isEmpty()) {&#10;                    calendar.setTimeInMillis(item.getDt() * 1000);&#10;                    int dayOfYear = calendar.get(Calendar.DAY_OF_YEAR);&#10;&#10;                    String condition = item.getWeather().get(0).getMain().toLowerCase();&#10;&#10;                    // Count rain/snow items per day&#10;                    if (condition.contains(&quot;rain&quot;) || condition.contains(&quot;drizzle&quot;) ||&#10;                            condition.contains(&quot;thunderstorm&quot;)) {&#10;                        rainyItemsPerDay.put(dayOfYear, rainyItemsPerDay.getOrDefault(dayOfYear, 0) + 1);&#10;                    }&#10;&#10;                    // Count condition occurrences&#10;                    conditionCounts.put(condition, conditionCounts.getOrDefault(condition, 0) + 1);&#10;                }&#10;            }&#10;&#10;            // Count how many days have significant rain (at least 2 items = 6 hours)&#10;            int rainyDays = 0;&#10;            for (int count : rainyItemsPerDay.values()) {&#10;                if (count &gt;= 2) { // At least 6 hours of rain&#10;                    rainyDays++;&#10;                }&#10;            }&#10;&#10;            // Find dominant condition&#10;            String dominantCondition = &quot;clear&quot;;&#10;            int dominantCount = 0;&#10;            for (java.util.Map.Entry&lt;String, Integer&gt; entry : conditionCounts.entrySet()) {&#10;                if (entry.getValue() &gt; dominantCount) {&#10;                    dominantCount = entry.getValue();&#10;                    dominantCondition = entry.getKey();&#10;                }&#10;            }&#10;&#10;            int totalDays = hourlyForecastData.getList().size() / 8; // 8 items per day (3-hour intervals)&#10;            int forecastDays = Math.min(totalDays, 5); // Show max 5 days&#10;&#10;            // Generate summary based on actual data&#10;            if (rainyDays &gt;= 3) {&#10;                return String.format(Locale.getDefault(),&#10;                        &quot;Rain expected %d out of %d days ahead&quot;,&#10;                        rainyDays, forecastDays);&#10;            } else if (rainyDays &gt;= 1) {&#10;                return String.format(Locale.getDefault(),&#10;                        &quot;Scattered rain in the next %d days&quot;,&#10;                        forecastDays);&#10;            } else if (dominantCondition.contains(&quot;snow&quot;)) {&#10;                return &quot;Possible snow in the coming days&quot;;&#10;            } else if (dominantCondition.contains(&quot;clear&quot;)) {&#10;                return &quot;Clear skies this week&quot;;&#10;            } else if (dominantCondition.contains(&quot;cloud&quot;)) {&#10;                return &quot;Mostly cloudy this week&quot;;&#10;            } else {&#10;                return &quot;Changing weather in the coming days&quot;;&#10;            }&#10;        }&#10;&#10;        // Fallback to simple summary (only if no API data)&#10;        if (weatherCondition.contains(&quot;rain&quot;) || weatherCondition.contains(&quot;drizzle&quot;)) {&#10;            return &quot;Rain in the coming days&quot;;&#10;        } else if (weatherCondition.contains(&quot;snow&quot;)) {&#10;            return &quot;Possible snow in the coming days&quot;;&#10;        } else if (weatherCondition.contains(&quot;clear&quot;)) {&#10;            return &quot;Clear skies this week&quot;;&#10;        } else if (weatherCondition.contains(&quot;cloud&quot;)) {&#10;            return &quot;Mostly cloudy this week&quot;;&#10;        } else {&#10;            return &quot;Changing weather in the coming days&quot;;&#10;        }&#10;    }&#10;&#10;    private void updateWeatherDetailsCards(WeatherResponse weatherData) {&#10;        // Update Feels Like Card with correct unit&#10;        String tempSymbol = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;°&quot; : &quot;°F&quot;;&#10;        updateCard(R.id.cardFeelsLike, &quot;️&quot;, &quot;FEELS LIKE&quot;,&#10;                String.format(Locale.getDefault(), &quot;%.0f%s&quot;, weatherData.getMain().getFeelsLike(), tempSymbol),&#10;                &quot;Similar to actual temp&quot;);&#10;&#10;        // Update Humidity Card&#10;        int humidity = weatherData.getMain().getHumidity();&#10;        String humidityDesc = humidity &gt; 70 ? &quot;High level&quot; : humidity &gt; 40 ? &quot;Comfortable&quot; : &quot;Low level&quot;;&#10;        updateCard(R.id.cardHumidity, &quot;&quot;, &quot;HUMIDITY&quot;,&#10;                String.format(Locale.getDefault(), &quot;%d%%&quot;, humidity), humidityDesc);&#10;&#10;        // Update Wind Card with unit conversion&#10;        double windSpeed = weatherData.getWind().getSpeed();&#10;        String windValue, windUnit;&#10;&#10;        if (windSpeedUnit.equals(&quot;kmh&quot;)) {&#10;            // Convert m/s to km/h (multiply by 3.6)&#10;            if (temperatureUnit.equals(&quot;imperial&quot;)) {&#10;                // API returns mph for imperial, convert to km/h&#10;                windSpeed = windSpeed * 1.60934;&#10;            } else {&#10;                // API returns m/s for metric, convert to km/h&#10;                windSpeed = windSpeed * 3.6;&#10;            }&#10;            windValue = String.format(Locale.getDefault(), &quot;%.1f&quot;, windSpeed);&#10;            windUnit = &quot;km/h&quot;;&#10;        } else {&#10;            // Use m/s&#10;            if (temperatureUnit.equals(&quot;imperial&quot;)) {&#10;                // API returns mph for imperial, convert to m/s&#10;                windSpeed = windSpeed * 0.44704;&#10;            }&#10;            windValue = String.format(Locale.getDefault(), &quot;%.1f&quot;, windSpeed);&#10;            windUnit = &quot;m/s&quot;;&#10;        }&#10;&#10;        updateCard(R.id.cardWind, &quot;&quot;, &quot;WIND&quot;, windValue, windUnit);&#10;&#10;        // Update Pressure Card with unit&#10;        int pressure = weatherData.getMain().getPressure();&#10;        String pressureUnitText = pressureUnit.equals(&quot;mbar&quot;) ? &quot;mbar&quot; : &quot;hPa&quot;;&#10;        updateCard(R.id.cardPressure, &quot;&quot;, &quot;PRESSURE&quot;,&#10;                String.format(Locale.getDefault(), &quot;%d&quot;, pressure), pressureUnitText);&#10;&#10;        // UV Index will be updated by fetchUVIndex() callback&#10;        updateUVIndexCard();&#10;&#10;        // Update Sunrise/Sunset Card (using real data if available)&#10;        long sunrise = weatherData.getSys() != null ? weatherData.getSys().getSunrise() : 0;&#10;        long sunset = weatherData.getSys() != null ? weatherData.getSys().getSunset() : 0;&#10;        String sunriseTime = formatTime(sunrise);&#10;        String sunsetTime = formatTime(sunset);&#10;        updateCard(R.id.cardSunrise, &quot;&quot;, &quot;SUNRISE&quot;, sunriseTime, &quot;Sunset: &quot; + sunsetTime);&#10;&#10;        // Update Visibility Card (using real data)&#10;        int visibility = weatherData.getVisibility() != null ? weatherData.getVisibility() / 1000 : 10;&#10;        updateCard(R.id.cardVisibility, &quot;️&quot;, &quot;VISIBILITY&quot;, String.valueOf(visibility), &quot;km&quot;);&#10;&#10;        // Update Rainfall Card (using real data if available)&#10;        double rainfall = 0;&#10;        if (weatherData.getRain() != null &amp;&amp; weatherData.getRain().get1h() != null) {&#10;            rainfall = weatherData.getRain().get1h();&#10;        }&#10;        updateCard(R.id.cardRainfall, &quot;️&quot;, &quot;RAINFALL&quot;,&#10;                String.format(Locale.getDefault(), &quot;%.1f&quot;, rainfall), &quot;mm last hour&quot;);&#10;    }&#10;&#10;    // Helper method to reduce code duplication&#10;    private void updateCard(int cardId, String icon, String title, String value, String description) {&#10;        View card = binding.getRoot().findViewById(cardId);&#10;        if (card != null) {&#10;            // For CardView with included layout, need to find the included layout first&#10;            View contentView = card;&#10;            if (card instanceof ViewGroup &amp;&amp; ((ViewGroup) card).getChildCount() &gt; 0) {&#10;                contentView = ((ViewGroup) card).getChildAt(0);&#10;            }&#10;&#10;            TextView tvIcon = contentView.findViewById(R.id.tvDetailIcon);&#10;            TextView tvTitle = contentView.findViewById(R.id.tvDetailTitle);&#10;            TextView tvValue = contentView.findViewById(R.id.tvDetailValue);&#10;            TextView tvDesc = contentView.findViewById(R.id.tvDetailDescription);&#10;&#10;            if (tvIcon != null) tvIcon.setText(icon);&#10;            if (tvTitle != null) tvTitle.setText(title);&#10;            if (tvValue != null) tvValue.setText(value);&#10;            if (tvDesc != null) {&#10;                tvDesc.setText(description);&#10;                tvDesc.setVisibility(View.VISIBLE);&#10;            }&#10;        }&#10;    }&#10;&#10;    private String formatTime(long timestamp) {&#10;        if (timestamp == 0) return &quot;N/A&quot;;&#10;        SimpleDateFormat sdf = new SimpleDateFormat(&quot;HH:mm&quot;, Locale.getDefault());&#10;        return sdf.format(timestamp * 1000);&#10;    }&#10;&#10;    private void animateTabSelection(boolean isHourly) {&#10;        View indicator = binding.getRoot().findViewById(R.id.tabIndicator);&#10;&#10;        if (indicator == null) return;&#10;&#10;        indicator.animate().cancel();&#10;&#10;        if (isHourly) {&#10;            binding.btnHourly.setTextColor(getResources().getColor(R.color.text_primary, null));&#10;            binding.btnWeekly.setTextColor(getResources().getColor(R.color.text_secondary, null));&#10;        } else {&#10;            binding.btnHourly.setTextColor(getResources().getColor(R.color.text_secondary, null));&#10;            binding.btnWeekly.setTextColor(getResources().getColor(R.color.text_primary, null));&#10;        }&#10;&#10;        indicator.post(() -&gt; {&#10;            float targetX = isHourly ? 0 : ((View) indicator.getParent()).getWidth() - indicator.getWidth();&#10;            indicator.animate()&#10;                    .translationX(targetX)&#10;                    .setDuration(250)&#10;                    .start();&#10;        });&#10;    }&#10;&#10;    private int getWeatherIconResource(String weatherCondition) {&#10;        switch (weatherCondition) {&#10;            case &quot;clear&quot;:&#10;                return R.drawable.sun_cloud_little_rain;&#10;            case &quot;clouds&quot;:&#10;                return R.drawable.moon_cloud_mid_rain;&#10;            case &quot;rain&quot;:&#10;                return R.drawable.big_rain_drops;&#10;            case &quot;drizzle&quot;:&#10;                return R.drawable.sun_cloud_mid_rain;&#10;            case &quot;thunderstorm&quot;:&#10;                return R.drawable.cloud_3_zap;&#10;            case &quot;snow&quot;:&#10;                return R.drawable.big_snow;&#10;            case &quot;mist&quot;:&#10;            case &quot;fog&quot;:&#10;            case &quot;haze&quot;:&#10;                return R.drawable.moon_cloud_fast_wind;&#10;            case &quot;tornado&quot;:&#10;                return R.drawable.moon_fast_wind;&#10;            default:&#10;                return R.drawable.sun_cloud_angled_rain;&#10;        }&#10;    }&#10;&#10;    private void showError(String message) {&#10;        binding.tvError.setText(message);&#10;        binding.tvError.setVisibility(View.VISIBLE);&#10;        binding.weatherDetailsSection.setVisibility(View.GONE);&#10;        Toast.makeText(this, message, Toast.LENGTH_LONG).show();&#10;    }&#10;&#10;    // Helper method để xử lý lỗi network chi tiết&#10;    private String getNetworkErrorMessage(Throwable t) {&#10;        if (t instanceof java.net.SocketTimeoutException) {&#10;            return &quot;Kết nối bị timeout. Vui lòng kiểm tra:\n&quot; +&#10;                   &quot;• Tốc độ mạng của bạn\n&quot; +&#10;                   &quot;• Thử lại sau vài giây&quot;;&#10;        } else if (t instanceof java.net.UnknownHostException) {&#10;            return &quot;Không thể kết nối đến server. Vui lòng kiểm tra kết nối internet.&quot;;&#10;        } else if (t instanceof java.net.ConnectException) {&#10;            return &quot;Không thể kết nối. Vui lòng kiểm tra:\n&quot; +&#10;                   &quot;• Bạn đã bật internet chưa\n&quot; +&#10;                   &quot;• Thử chuyển đổi giữa WiFi/4G&quot;;&#10;        } else if (t instanceof java.io.IOException) {&#10;            return &quot;Lỗi kết nối mạng. Vui lòng thử lại.&quot;;&#10;        } else {&#10;            return &quot;Lỗi: &quot; + t.getMessage() + &quot;\nVui lòng thử lại sau.&quot;;&#10;        }&#10;    }&#10;&#10;    private String capitalizeWords(String str) {&#10;        String[] words = str.split(&quot;\\s&quot;);&#10;        StringBuilder capitalizedWords = new StringBuilder();&#10;&#10;        for (String word : words) {&#10;            if (!word.isEmpty()) {&#10;                capitalizedWords.append(Character.toUpperCase(word.charAt(0)))&#10;                        .append(word.substring(1))&#10;                        .append(&quot; &quot;);&#10;            }&#10;        }&#10;&#10;        return capitalizedWords.toString().trim();&#10;    }&#10;&#10;    private void checkNotificationPermission() {&#10;        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.TIRAMISU) {&#10;            if (ContextCompat.checkSelfPermission(this, Manifest.permission.POST_NOTIFICATIONS)&#10;                    != PackageManager.PERMISSION_GRANTED) {&#10;                // Request permission&#10;                requestPermissionLauncher.launch(Manifest.permission.POST_NOTIFICATIONS);&#10;            }&#10;        }&#10;    }&#10;&#10;    private void scheduleWeatherNotifications() {&#10;        // Check if notifications are enabled in settings&#10;        boolean notificationsEnabled = sharedPreferences.getBoolean(&quot;notifications&quot;, true);&#10;&#10;        if (notificationsEnabled) {&#10;            // For testing: Use OneTimeWorkRequest with 2 minute delay (PeriodicWork minimum is 15 minutes)&#10;            // This will trigger once after 2 minutes&#10;            androidx.work.OneTimeWorkRequest weatherWorkRequest = new androidx.work.OneTimeWorkRequest.Builder(&#10;                    WeatherNotificationWorker.class)&#10;                    .setInitialDelay(2, TimeUnit.MINUTES)&#10;                    .build();&#10;&#10;            WorkManager.getInstance(this).enqueueUniqueWork(&#10;                    &quot;WeatherNotification&quot;,&#10;                    androidx.work.ExistingWorkPolicy.REPLACE,&#10;                    weatherWorkRequest&#10;            );&#10;&#10;            android.util.Log.d(&quot;MainActivity&quot;, &quot;Weather notification scheduled for 2 minutes from now&quot;);&#10;        } else {&#10;            // Cancel all scheduled notifications&#10;            WorkManager.getInstance(this).cancelUniqueWork(&quot;WeatherNotification&quot;);&#10;        }&#10;    }&#10;&#10;    // NEW: Check location permission and get current location&#10;    private void checkLocationPermissionAndGetLocation() {&#10;        if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION)&#10;                == PackageManager.PERMISSION_GRANTED) {&#10;            // Permission already granted&#10;            getCurrentLocation();&#10;        } else {&#10;            // Request permission&#10;            requestLocationPermissionLauncher.launch(Manifest.permission.ACCESS_FINE_LOCATION);&#10;        }&#10;    }&#10;&#10;    // NEW: Get current location using GPS&#10;    private void getCurrentLocation() {&#10;        if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION)&#10;                != PackageManager.PERMISSION_GRANTED) {&#10;            return;&#10;        }&#10;&#10;        Toast.makeText(this, R.string.getting_location, Toast.LENGTH_SHORT).show();&#10;&#10;        fusedLocationClient.getLastLocation()&#10;                .addOnSuccessListener(this, location -&gt; {&#10;                    if (location != null) {&#10;                        // Check location accuracy&#10;                        float accuracy = location.getAccuracy();&#10;&#10;                        // If location is too inaccurate (&gt;1000m), request fresh location&#10;                        if (accuracy &gt; 1000) {&#10;                            Toast.makeText(this, &quot;Location not accurate, requesting fresh location...&quot;, Toast.LENGTH_SHORT).show();&#10;                            requestFreshLocation();&#10;                            return;&#10;                        }&#10;&#10;                        // Got location - fetch weather by coordinates&#10;                        currentLat = location.getLatitude();&#10;                        currentLon = location.getLongitude();&#10;&#10;                        // Debug: Show coordinates to user&#10;                        String coordsMsg = String.format(Locale.getDefault(),&#10;                                &quot;Location: %.4f, %.4f (±%.0fm)&quot;,&#10;                                currentLat, currentLon, accuracy);&#10;                        Toast.makeText(this, coordsMsg, Toast.LENGTH_LONG).show();&#10;&#10;                        fetchWeatherByCoordinates(currentLat, currentLon);&#10;                    } else {&#10;                        // Last location not available, request fresh location&#10;                        requestFreshLocation();&#10;                    }&#10;                })&#10;                .addOnFailureListener(this, e -&gt; {&#10;                    Toast.makeText(this, R.string.location_not_available, Toast.LENGTH_SHORT).show();&#10;                });&#10;    }&#10;&#10;    // Request fresh location when last location is not available&#10;    private void requestFreshLocation() {&#10;        if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION)&#10;                != PackageManager.PERMISSION_GRANTED) {&#10;            return;&#10;        }&#10;&#10;        Toast.makeText(this, &quot;Requesting fresh location...&quot;, Toast.LENGTH_SHORT).show();&#10;&#10;        com.google.android.gms.location.LocationRequest locationRequest =&#10;                new com.google.android.gms.location.LocationRequest.Builder(&#10;                        com.google.android.gms.location.Priority.PRIORITY_HIGH_ACCURACY, 10000)&#10;                        .setMinUpdateIntervalMillis(5000)&#10;                        .setMaxUpdates(1)&#10;                        .build();&#10;&#10;        fusedLocationClient.requestLocationUpdates(locationRequest,&#10;                new com.google.android.gms.location.LocationCallback() {&#10;                    @Override&#10;                    public void onLocationResult(@NonNull com.google.android.gms.location.LocationResult locationResult) {&#10;                        super.onLocationResult(locationResult);&#10;                        if (locationResult != null &amp;&amp; locationResult.getLastLocation() != null) {&#10;                            android.location.Location location = locationResult.getLastLocation();&#10;                            currentLat = location.getLatitude();&#10;                            currentLon = location.getLongitude();&#10;                            float accuracy = location.getAccuracy();&#10;&#10;                            // Debug: Show coordinates to user&#10;                            String coordsMsg = String.format(Locale.getDefault(),&#10;                                    &quot;Fresh location: %.4f, %.4f (±%.0fm)&quot;,&#10;                                    currentLat, currentLon, accuracy);&#10;                            Toast.makeText(MainActivity.this, coordsMsg, Toast.LENGTH_LONG).show();&#10;&#10;                            fetchWeatherByCoordinates(currentLat, currentLon);&#10;                            // Stop location updates after getting location&#10;                            fusedLocationClient.removeLocationUpdates(this);&#10;                        } else {&#10;                            Toast.makeText(MainActivity.this,&#10;                                    &quot;Unable to get your location. Please enable location services.&quot;,&#10;                                    Toast.LENGTH_LONG).show();&#10;                        }&#10;                    }&#10;                }, getMainLooper());&#10;    }&#10;&#10;    // NEW: Fetch weather by GPS coordinates&#10;    private void fetchWeatherByCoordinates(double lat, double lon) {&#10;        binding.progressBar.setVisibility(View.VISIBLE);&#10;        binding.weatherDetailsSection.setVisibility(View.GONE);&#10;        binding.tvError.setVisibility(View.GONE);&#10;&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;        String units = temperatureUnit.equals(&quot;celsius&quot;) ? &quot;metric&quot; : &quot;imperial&quot;;&#10;&#10;        // Debug log&#10;        String apiUrl = String.format(Locale.getDefault(),&#10;                &quot;Fetching weather for: lat=%.4f, lon=%.4f&quot;, lat, lon);&#10;        Toast.makeText(this, apiUrl, Toast.LENGTH_SHORT).show();&#10;&#10;        Call&lt;WeatherResponse&gt; weatherCall = apiService.getWeatherByCoordinates(lat, lon, API_KEY, units);&#10;        weatherCall.enqueue(new Callback&lt;WeatherResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;WeatherResponse&gt; call, Response&lt;WeatherResponse&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    currentWeatherData = response.body();&#10;                    currentCityName = currentWeatherData.getName();&#10;&#10;                    // Update coordinates&#10;                    currentLat = lat;&#10;                    currentLon = lon;&#10;&#10;                    // Debug: Show what API returned&#10;                    String debugMsg = String.format(Locale.getDefault(),&#10;                            &quot;API returned: %s (%.4f, %.4f) - %.0f°&quot;,&#10;                            currentCityName,&#10;                            currentWeatherData.getCoord() != null ? currentWeatherData.getCoord().getLat() : 0,&#10;                            currentWeatherData.getCoord() != null ? currentWeatherData.getCoord().getLon() : 0,&#10;                            currentWeatherData.getMain().getTemp());&#10;                    Toast.makeText(MainActivity.this, debugMsg, Toast.LENGTH_LONG).show();&#10;&#10;                    // Save city name for notifications&#10;                    sharedPreferences.edit().putString(&quot;last_city&quot;, currentCityName).apply();&#10;&#10;                    updateUI(currentWeatherData);&#10;                    // Use coordinates for hourly forecast to get accurate data&#10;                    fetchHourlyForecastByCoordinates(lat, lon);&#10;                    fetchUVIndex(lat, lon);&#10;                    fetchAirQuality(lat, lon);&#10;                } else {&#10;                    binding.progressBar.setVisibility(View.GONE);&#10;                    showError(getString(R.string.error_city_not_found));&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;WeatherResponse&gt; call, Throwable t) {&#10;                binding.progressBar.setVisibility(View.GONE);&#10;                showError(getString(R.string.error_network));&#10;            }&#10;        });&#10;    }&#10;&#10;    // NEW: Update weather widget&#10;    private void updateWeatherWidget(WeatherResponse weatherData) {&#10;        AppWidgetManager appWidgetManager = AppWidgetManager.getInstance(this);&#10;        ComponentName thisWidget = new ComponentName(this, WeatherWidget.class);&#10;        int[] appWidgetIds = appWidgetManager.getAppWidgetIds(thisWidget);&#10;&#10;        for (int appWidgetId : appWidgetIds) {&#10;            // Update each widget instance&#10;            WeatherWidget.updateWidget(this, appWidgetManager, appWidgetId, weatherData);&#10;        }&#10;    }&#10;&#10;&#10;    // NEW: Add current city to favorites&#10;    @SuppressWarnings(&quot;unused&quot;)&#10;    private void addCurrentCityToFavorites() {&#10;        if (currentWeatherData == null) {&#10;            Toast.makeText(this, &quot;No city data available&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        String country = currentWeatherData.getSys() != null ?&#10;                currentWeatherData.getSys().getCountry() : &quot;Unknown&quot;;&#10;&#10;        FavoriteCity favoriteCity = new FavoriteCity(&#10;                currentCityName,&#10;                country,&#10;                currentLat,&#10;                currentLon&#10;        );&#10;&#10;        favoriteCity.setCurrentTemp(currentWeatherData.getMain().getTemp());&#10;        favoriteCity.setWeatherCondition(&#10;                currentWeatherData.getWeather() != null &amp;&amp; !currentWeatherData.getWeather().isEmpty() ?&#10;                        currentWeatherData.getWeather().get(0).getMain() : &quot;Unknown&quot;&#10;        );&#10;        favoriteCity.setWeatherDescription(&#10;                currentWeatherData.getWeather() != null &amp;&amp; !currentWeatherData.getWeather().isEmpty() ?&#10;                        currentWeatherData.getWeather().get(0).getDescription() : &quot;Unknown&quot;&#10;        );&#10;&#10;        if (favoritesManager.addFavoriteCity(favoriteCity)) {&#10;            Toast.makeText(this, currentCityName + &quot; added to favorites&quot;, Toast.LENGTH_SHORT).show();&#10;        } else {&#10;            if (favoritesManager.isFavorite(currentCityName)) {&#10;                Toast.makeText(this, currentCityName + &quot; is already in favorites&quot;, Toast.LENGTH_SHORT).show();&#10;            } else {&#10;                Toast.makeText(this, &quot;Maximum 10 favorite cities allowed&quot;, Toast.LENGTH_SHORT).show();&#10;            }&#10;        }&#10;    }&#10;&#10;    // NEW: Open Favorite Cities Activity&#10;    @SuppressWarnings(&quot;unused&quot;)&#10;    private void openFavoriteCitiesActivity() {&#10;        Intent intent = new Intent(this, FavoriteCitiesActivity.class);&#10;        startActivity(intent);&#10;    }&#10;&#10;    // NEW: Fetch Weather Alerts&#10;    @SuppressWarnings(&quot;unused&quot;)&#10;    private void fetchWeatherAlerts(double lat, double lon) {&#10;        if (lat == 0 &amp;&amp; lon == 0) return;&#10;&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;        Call&lt;WeatherAlertsResponse&gt; alertsCall = apiService.getWeatherAlerts(&#10;                lat, lon, API_KEY, &quot;current,minutely,hourly,daily&quot;&#10;        );&#10;&#10;        alertsCall.enqueue(new Callback&lt;WeatherAlertsResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;WeatherAlertsResponse&gt; call, Response&lt;WeatherAlertsResponse&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null &amp;&amp; response.body().hasAlerts()) {&#10;                    currentAlerts = response.body().getAlerts();&#10;                    updateWeatherAlertsCard();&#10;                } else {&#10;                    // No alerts - hide the card&#10;                    hideWeatherAlertsCard();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;WeatherAlertsResponse&gt; call, Throwable t) {&#10;                // Failed to fetch alerts - hide the card&#10;                hideWeatherAlertsCard();&#10;            }&#10;        });&#10;    }&#10;&#10;    // NEW: Update Weather Alerts Card&#10;    private void updateWeatherAlertsCard() {&#10;        if (currentAlerts == null || currentAlerts.isEmpty()) {&#10;            hideWeatherAlertsCard();&#10;            return;&#10;        }&#10;&#10;        View alertCard = findViewById(R.id.card_weather_alerts);&#10;        if (alertCard == null) return;&#10;&#10;        alertCard.setVisibility(View.VISIBLE);&#10;&#10;        // Get the most severe alert&#10;        WeatherAlert mainAlert = currentAlerts.get(0);&#10;        for (WeatherAlert alert : currentAlerts) {&#10;            if (getSeverityPriority(alert.getSeverity()) &gt; getSeverityPriority(mainAlert.getSeverity())) {&#10;                mainAlert = alert;&#10;            }&#10;        }&#10;&#10;        // Update severity badge&#10;        TextView tvAlertSeverity = alertCard.findViewById(R.id.tvAlertSeverity);&#10;        if (tvAlertSeverity != null) {&#10;            tvAlertSeverity.setText(mainAlert.getSeverity());&#10;            tvAlertSeverity.setBackgroundColor(mainAlert.getSeverityColor());&#10;        }&#10;&#10;        // Update alert details&#10;        TextView tvAlertEvent = alertCard.findViewById(R.id.tvAlertEvent);&#10;        TextView tvAlertDescription = alertCard.findViewById(R.id.tvAlertDescription);&#10;        TextView tvAlertTime = alertCard.findViewById(R.id.tvAlertTime);&#10;&#10;        if (tvAlertEvent != null) {&#10;            tvAlertEvent.setText(mainAlert.getEvent());&#10;        }&#10;&#10;        if (tvAlertDescription != null) {&#10;            String description = mainAlert.getDescription();&#10;            if (description != null &amp;&amp; description.length() &gt; 100) {&#10;                description = description.substring(0, 100) + &quot;...&quot;;&#10;            }&#10;            tvAlertDescription.setText(description);&#10;        }&#10;&#10;        if (tvAlertTime != null) {&#10;            SimpleDateFormat sdf = new SimpleDateFormat(&quot;MMM dd, HH:mm&quot;, Locale.getDefault());&#10;            String timeStr = &quot;Valid until &quot; + sdf.format(mainAlert.getEnd() * 1000);&#10;            tvAlertTime.setText(timeStr);&#10;        }&#10;&#10;        // Setup click listener for &quot;View More&quot;&#10;        TextView btnViewMore = alertCard.findViewById(R.id.btnViewMoreAlerts);&#10;        if (btnViewMore != null &amp;&amp; currentAlerts.size() &gt; 1) {&#10;            btnViewMore.setVisibility(View.VISIBLE);&#10;            btnViewMore.setText(String.format(Locale.getDefault(),&#10;                    &quot;View All Alerts (%d) ›&quot;, currentAlerts.size()));&#10;            btnViewMore.setOnClickListener(v -&gt; showAllAlertsDialog());&#10;        } else if (btnViewMore != null) {&#10;            btnViewMore.setVisibility(View.GONE);&#10;        }&#10;    }&#10;&#10;    private void hideWeatherAlertsCard() {&#10;        View alertCard = findViewById(R.id.card_weather_alerts);&#10;        if (alertCard != null) {&#10;            alertCard.setVisibility(View.GONE);&#10;        }&#10;    }&#10;&#10;    private int getSeverityPriority(String severity) {&#10;        switch (severity) {&#10;            case &quot;EXTREME&quot;: return 4;&#10;            case &quot;HIGH&quot;: return 3;&#10;            case &quot;MODERATE&quot;: return 2;&#10;            case &quot;LOW&quot;: return 1;&#10;            default: return 0;&#10;        }&#10;    }&#10;&#10;    private void showAllAlertsDialog() {&#10;        if (currentAlerts == null || currentAlerts.isEmpty()) return;&#10;&#10;        StringBuilder message = new StringBuilder();&#10;        for (int i = 0; i &lt; currentAlerts.size(); i++) {&#10;            WeatherAlert alert = currentAlerts.get(i);&#10;            message.append((i + 1)).append(&quot;. &quot;).append(alert.getEvent()).append(&quot;\n&quot;);&#10;            message.append(alert.getDescription()).append(&quot;\n\n&quot;);&#10;        }&#10;&#10;        new android.app.AlertDialog.Builder(this)&#10;                .setTitle(&quot;Weather Alerts&quot;)&#10;                .setMessage(message.toString())&#10;                .setPositiveButton(&quot;OK&quot;, null)&#10;                .show();&#10;    }&#10;&#10;    @Override&#10;    protected void onDestroy() {&#10;        super.onDestroy();&#10;        binding = null;&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/activities/OutfitSuggestionActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/activities/OutfitSuggestionActivity.java" />
              <option name="originalContent" value="package com.example.weatherapp.ui.activities;&#10;&#10;import android.os.Bundle;&#10;import android.view.View;&#10;import android.widget.ImageView;&#10;import android.widget.ProgressBar;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Locale;&#10;&#10;public class OutfitSuggestionActivity extends AppCompatActivity {&#10;&#10;    private ProgressBar progressBar;&#10;    private TextView tvWeatherInfo;&#10;    private ImageView ivWeatherIcon;&#10;    private View layoutContent;&#10;&#10;    private WeatherResponse weatherData;&#10;    private OutfitSuggestionService outfitService;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_outfit_suggestion);&#10;&#10;        // Initialize views&#10;        RecyclerView rvOutfitSuggestions = findViewById(R.id.rvOutfitSuggestions);&#10;        progressBar = findViewById(R.id.progressBar);&#10;        tvWeatherInfo = findViewById(R.id.tvWeatherInfo);&#10;        ImageView btnBack = findViewById(R.id.btnBack);&#10;        layoutContent = findViewById(R.id.layoutContent);&#10;        ivWeatherIcon = findViewById(R.id.ivWeatherIcon);&#10;&#10;        // Setup RecyclerView&#10;        rvOutfitSuggestions.setLayoutManager(new LinearLayoutManager(this));&#10;        OutfitSuggestionAdapter adapter = new OutfitSuggestionAdapter(new ArrayList&lt;&gt;());&#10;        rvOutfitSuggestions.setAdapter(adapter);&#10;&#10;        // Get weather data from intent&#10;        weatherData = (WeatherResponse) getIntent().getSerializableExtra(&quot;weather_data&quot;);&#10;&#10;        if (weatherData == null) {&#10;            Toast.makeText(this, &quot;No weather data available&quot;, Toast.LENGTH_SHORT).show();&#10;            finish();&#10;            return;&#10;        }&#10;&#10;        // Setup back button&#10;        btnBack.setOnClickListener(v -&gt; finish());&#10;&#10;        // Display weather info&#10;        displayWeatherInfo();&#10;&#10;        // Initialize service and fetch suggestions&#10;        outfitService = new OutfitSuggestionService(this);&#10;        fetchOutfitSuggestions(adapter);&#10;    }&#10;&#10;    private void displayWeatherInfo() {&#10;        double temp = weatherData.getMain().getTemp();&#10;        String condition = weatherData.getWeather().get(0).getDescription();&#10;        String cityName = weatherData.getName();&#10;&#10;        tvWeatherInfo.setText(String.format(Locale.getDefault(), &quot;%s - %.0f°C, %s&quot;, cityName, temp, condition));&#10;&#10;        // Set weather icon - use existing drawable resources&#10;        String weatherCondition = weatherData.getWeather().get(0).getMain().toLowerCase();&#10;        ivWeatherIcon.setImageResource(getWeatherIconResource(weatherCondition));&#10;    }&#10;&#10;    private void fetchOutfitSuggestions(OutfitSuggestionAdapter adapter) {&#10;        progressBar.setVisibility(View.VISIBLE);&#10;        layoutContent.setVisibility(View.GONE);&#10;&#10;        outfitService.getOutfitSuggestions(weatherData, new OutfitSuggestionService.OutfitSuggestionCallback() {&#10;            @Override&#10;            public void onSuccess(List&lt;OutfitSuggestion&gt; suggestions) {&#10;                runOnUiThread(() -&gt; {&#10;                    progressBar.setVisibility(View.GONE);&#10;                    layoutContent.setVisibility(View.VISIBLE);&#10;                    adapter.updateSuggestions(suggestions);&#10;                });&#10;            }&#10;&#10;            @Override&#10;            public void onError(String error) {&#10;                runOnUiThread(() -&gt; {&#10;                    progressBar.setVisibility(View.GONE);&#10;                    layoutContent.setVisibility(View.VISIBLE);&#10;                    Toast.makeText(OutfitSuggestionActivity.this,&#10;                            &quot;Error: &quot; + error, Toast.LENGTH_SHORT).show();&#10;                });&#10;            }&#10;        });&#10;    }&#10;&#10;    private int getWeatherIconResource(String weatherCondition) {&#10;        // Map weather conditions to existing drawable resources&#10;        switch (weatherCondition) {&#10;            case &quot;clear&quot;:&#10;                return R.drawable.sun_cloud_little_rain;&#10;            case &quot;clouds&quot;:&#10;                return R.drawable.moon_cloud_mid_rain;&#10;            case &quot;rain&quot;:&#10;                return R.drawable.big_rain_drops;&#10;            case &quot;drizzle&quot;:&#10;                return R.drawable.sun_cloud_mid_rain;&#10;            case &quot;thunderstorm&quot;:&#10;                return R.drawable.cloud_3_zap;&#10;            case &quot;snow&quot;:&#10;                return R.drawable.big_snow;&#10;            case &quot;mist&quot;:&#10;            case &quot;fog&quot;:&#10;            case &quot;haze&quot;:&#10;                return R.drawable.moon_cloud_fast_wind;&#10;            case &quot;tornado&quot;:&#10;                return R.drawable.moon_fast_wind;&#10;            default:&#10;                return R.drawable.sun_cloud_angled_rain;&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.weatherapp.ui.activities;&#13;&#10;&#13;&#10;import android.os.Bundle;&#13;&#10;import android.view.View;&#13;&#10;import android.widget.ImageView;&#13;&#10;import android.widget.ProgressBar;&#13;&#10;import android.widget.TextView;&#13;&#10;import android.widget.Toast;&#13;&#10;&#13;&#10;import androidx.appcompat.app.AppCompatActivity;&#13;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#13;&#10;import androidx.recyclerview.widget.RecyclerView;&#13;&#10;&#13;&#10;import com.example.weatherapp.R;&#13;&#10;import com.example.weatherapp.data.models.OutfitSuggestion;&#13;&#10;import com.example.weatherapp.data.responses.WeatherResponse;&#13;&#10;import com.example.weatherapp.ui.adapters.OutfitSuggestionAdapter;&#13;&#10;import com.example.weatherapp.utils.OutfitSuggestionService;&#13;&#10;&#13;&#10;import java.util.ArrayList;&#13;&#10;import java.util.List;&#13;&#10;import java.util.Locale;&#13;&#10;&#13;&#10;public class OutfitSuggestionActivity extends AppCompatActivity {&#13;&#10;&#13;&#10;    private ProgressBar progressBar;&#13;&#10;    private TextView tvWeatherInfo;&#13;&#10;    private ImageView ivWeatherIcon;&#13;&#10;    private View layoutContent;&#13;&#10;&#13;&#10;    private WeatherResponse weatherData;&#13;&#10;    private OutfitSuggestionService outfitService;&#13;&#10;&#13;&#10;    @Override&#13;&#10;    protected void onCreate(Bundle savedInstanceState) {&#13;&#10;        super.onCreate(savedInstanceState);&#13;&#10;        setContentView(R.layout.activity_outfit_suggestion);&#13;&#10;&#13;&#10;        // Initialize views&#13;&#10;        RecyclerView rvOutfitSuggestions = findViewById(R.id.rvOutfitSuggestions);&#13;&#10;        progressBar = findViewById(R.id.progressBar);&#13;&#10;        tvWeatherInfo = findViewById(R.id.tvWeatherInfo);&#13;&#10;        ImageView btnBack = findViewById(R.id.btnBack);&#13;&#10;        layoutContent = findViewById(R.id.layoutContent);&#13;&#10;        ivWeatherIcon = findViewById(R.id.ivWeatherIcon);&#13;&#10;&#13;&#10;        // Setup RecyclerView&#13;&#10;        rvOutfitSuggestions.setLayoutManager(new LinearLayoutManager(this));&#13;&#10;        OutfitSuggestionAdapter adapter = new OutfitSuggestionAdapter(new ArrayList&lt;&gt;());&#13;&#10;        rvOutfitSuggestions.setAdapter(adapter);&#13;&#10;&#13;&#10;        // Get weather data from intent&#13;&#10;        weatherData = (WeatherResponse) getIntent().getSerializableExtra(&quot;weather_data&quot;);&#13;&#10;&#13;&#10;        if (weatherData == null) {&#13;&#10;            Toast.makeText(this, &quot;No weather data available&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;            finish();&#13;&#10;            return;&#13;&#10;        }&#13;&#10;&#13;&#10;        // Setup back button&#13;&#10;        btnBack.setOnClickListener(v -&gt; finish());&#13;&#10;&#13;&#10;        // Display weather info&#13;&#10;        displayWeatherInfo();&#13;&#10;&#13;&#10;        // Initialize service and fetch suggestions&#13;&#10;        outfitService = new OutfitSuggestionService(this);&#13;&#10;        fetchOutfitSuggestions(adapter);&#13;&#10;    }&#13;&#10;&#13;&#10;    private void displayWeatherInfo() {&#13;&#10;        double temp = weatherData.getMain().getTemp();&#13;&#10;        String condition = weatherData.getWeather().get(0).getDescription();&#13;&#10;        String cityName = weatherData.getName();&#13;&#10;&#13;&#10;        tvWeatherInfo.setText(String.format(Locale.getDefault(), &quot;%s - %.0f°C, %s&quot;, cityName, temp, condition));&#13;&#10;&#13;&#10;        // Set weather icon - use existing drawable resources&#13;&#10;        String weatherCondition = weatherData.getWeather().get(0).getMain().toLowerCase();&#13;&#10;        ivWeatherIcon.setImageResource(getWeatherIconResource(weatherCondition));&#13;&#10;    }&#13;&#10;&#13;&#10;    private void fetchOutfitSuggestions(OutfitSuggestionAdapter adapter) {&#13;&#10;        progressBar.setVisibility(View.VISIBLE);&#13;&#10;        layoutContent.setVisibility(View.GONE);&#13;&#10;&#13;&#10;        outfitService.getOutfitSuggestions(weatherData, new OutfitSuggestionService.OutfitSuggestionCallback() {&#13;&#10;            @Override&#13;&#10;            public void onSuccess(List&lt;OutfitSuggestion&gt; suggestions) {&#13;&#10;                runOnUiThread(() -&gt; {&#13;&#10;                    progressBar.setVisibility(View.GONE);&#13;&#10;                    layoutContent.setVisibility(View.VISIBLE);&#13;&#10;                    adapter.updateSuggestions(suggestions);&#13;&#10;                });&#13;&#10;            }&#13;&#10;&#13;&#10;            @Override&#13;&#10;            public void onError(String error) {&#13;&#10;                runOnUiThread(() -&gt; {&#13;&#10;                    progressBar.setVisibility(View.GONE);&#13;&#10;                    layoutContent.setVisibility(View.VISIBLE);&#13;&#10;                    Toast.makeText(OutfitSuggestionActivity.this,&#13;&#10;                            &quot;Error: &quot; + error, Toast.LENGTH_SHORT).show();&#13;&#10;                });&#13;&#10;            }&#13;&#10;        });&#13;&#10;    }&#13;&#10;&#13;&#10;    private int getWeatherIconResource(String weatherCondition) {&#13;&#10;        // Map weather conditions to existing drawable resources&#13;&#10;        switch (weatherCondition) {&#13;&#10;            case &quot;clear&quot;:&#13;&#10;                return R.drawable.sun_cloud_little_rain;&#13;&#10;            case &quot;clouds&quot;:&#13;&#10;                return R.drawable.moon_cloud_mid_rain;&#13;&#10;            case &quot;rain&quot;:&#13;&#10;                return R.drawable.big_rain_drops;&#13;&#10;            case &quot;drizzle&quot;:&#13;&#10;                return R.drawable.sun_cloud_mid_rain;&#13;&#10;            case &quot;thunderstorm&quot;:&#13;&#10;                return R.drawable.cloud_3_zap;&#13;&#10;            case &quot;snow&quot;:&#13;&#10;                return R.drawable.big_snow;&#13;&#10;            case &quot;mist&quot;:&#13;&#10;            case &quot;fog&quot;:&#13;&#10;            case &quot;haze&quot;:&#13;&#10;                return R.drawable.moon_cloud_fast_wind;&#13;&#10;            case &quot;tornado&quot;:&#13;&#10;                return R.drawable.moon_fast_wind;&#13;&#10;            default:&#13;&#10;                return R.drawable.sun_cloud_angled_rain;&#13;&#10;        }&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/activities/SearchActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/activities/SearchActivity.java" />
              <option name="originalContent" value="package com.example.weatherapp.ui.activities;&#10;&#10;import android.Manifest;&#10;import android.content.Intent;&#10;import android.content.pm.PackageManager;&#10;import android.os.Bundle;&#10;import android.view.KeyEvent;&#10;import android.view.View;&#10;import android.view.inputmethod.EditorInfo;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.core.app.ActivityCompat;&#10;import androidx.core.content.ContextCompat;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.example.weatherapp.databinding.ActivitySearchBinding;&#10;import com.google.android.gms.location.FusedLocationProviderClient;&#10;import com.google.android.gms.location.LocationServices;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;public class SearchActivity extends AppCompatActivity {&#10;&#10;    private ActivitySearchBinding binding;&#10;    private List&lt;CityWeather&gt; cityList;&#10;    public static final String EXTRA_CITY_NAME = &quot;city_name&quot;;&#10;    public static final String EXTRA_USE_GPS = &quot;use_gps&quot;;&#10;    public static final String EXTRA_LATITUDE = &quot;latitude&quot;;&#10;    public static final String EXTRA_LONGITUDE = &quot;longitude&quot;;&#10;&#10;    private static final int LOCATION_PERMISSION_REQUEST_CODE = 1001;&#10;    private FusedLocationProviderClient fusedLocationClient;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        binding = ActivitySearchBinding.inflate(getLayoutInflater());&#10;        setContentView(binding.getRoot());&#10;&#10;        fusedLocationClient = LocationServices.getFusedLocationProviderClient(this);&#10;&#10;        setupListeners();&#10;        setupCityList();&#10;    }&#10;&#10;    private void setupListeners() {&#10;        // Back button click&#10;        binding.btnBack.setOnClickListener(v -&gt; finish());&#10;&#10;        // Search button click&#10;        binding.btnSearchIcon.setOnClickListener(v -&gt; {&#10;            String query = binding.etSearch.getText().toString().trim();&#10;            if (!query.isEmpty()) {&#10;                searchCity(query);&#10;            } else {&#10;                Toast.makeText(this, &quot;Please enter a city name&quot;, Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;&#10;        // Use Current Location button click&#10;        binding.btnUseCurrentLocation.setOnClickListener(v -&gt; {&#10;            requestCurrentLocation();&#10;        });&#10;&#10;        // Search when user presses Enter on keyboard&#10;        binding.etSearch.setOnEditorActionListener((v, actionId, event) -&gt; {&#10;            if (actionId == EditorInfo.IME_ACTION_SEARCH ||&#10;                    actionId == EditorInfo.IME_ACTION_DONE ||&#10;                    (event != null &amp;&amp; event.getKeyCode() == KeyEvent.KEYCODE_ENTER &amp;&amp; event.getAction() == KeyEvent.ACTION_DOWN)) {&#10;                String query = binding.etSearch.getText().toString().trim();&#10;                if (!query.isEmpty()) {&#10;                    searchCity(query);&#10;                    return true;&#10;                } else {&#10;                    Toast.makeText(this, &quot;Please enter a city name&quot;, Toast.LENGTH_SHORT).show();&#10;                }&#10;            }&#10;            return false;&#10;        });&#10;    }&#10;&#10;    private void requestCurrentLocation() {&#10;        // Check if location permission is granted&#10;        if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION)&#10;                != PackageManager.PERMISSION_GRANTED) {&#10;            // Request permission&#10;            ActivityCompat.requestPermissions(this,&#10;                    new String[]{Manifest.permission.ACCESS_FINE_LOCATION},&#10;                    LOCATION_PERMISSION_REQUEST_CODE);&#10;        } else {&#10;            // Permission already granted, get location&#10;            getCurrentLocation();&#10;        }&#10;    }&#10;&#10;    private void getCurrentLocation() {&#10;        if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION)&#10;                != PackageManager.PERMISSION_GRANTED) {&#10;            return;&#10;        }&#10;&#10;        Toast.makeText(this, &quot;Getting your location...&quot;, Toast.LENGTH_SHORT).show();&#10;&#10;        fusedLocationClient.getLastLocation()&#10;                .addOnSuccessListener(this, location -&gt; {&#10;                    if (location != null) {&#10;                        // Got location, return to MainActivity with coordinates&#10;                        returnLocationToMain(location.getLatitude(), location.getLongitude());&#10;                    } else {&#10;                        // Last location not available, request fresh location&#10;                        requestFreshLocation();&#10;                    }&#10;                })&#10;                .addOnFailureListener(this, e -&gt; {&#10;                    Toast.makeText(this, &quot;Failed to get location: &quot; + e.getMessage(),&#10;                            Toast.LENGTH_SHORT).show();&#10;                });&#10;    }&#10;&#10;    // Request fresh location when last location is not available&#10;    private void requestFreshLocation() {&#10;        if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION)&#10;                != PackageManager.PERMISSION_GRANTED) {&#10;            return;&#10;        }&#10;&#10;        Toast.makeText(this, &quot;Requesting fresh location...&quot;, Toast.LENGTH_SHORT).show();&#10;&#10;        com.google.android.gms.location.LocationRequest locationRequest =&#10;                new com.google.android.gms.location.LocationRequest.Builder(&#10;                        com.google.android.gms.location.Priority.PRIORITY_HIGH_ACCURACY, 10000)&#10;                        .setMinUpdateIntervalMillis(5000)&#10;                        .setMaxUpdates(1)&#10;                        .build();&#10;&#10;        fusedLocationClient.requestLocationUpdates(locationRequest,&#10;                new com.google.android.gms.location.LocationCallback() {&#10;                    @Override&#10;                    public void onLocationResult(@NonNull com.google.android.gms.location.LocationResult locationResult) {&#10;                        super.onLocationResult(locationResult);&#10;                        if (locationResult != null &amp;&amp; locationResult.getLastLocation() != null) {&#10;                            android.location.Location location = locationResult.getLastLocation();&#10;                            returnLocationToMain(location.getLatitude(), location.getLongitude());&#10;                            // Stop location updates after getting location&#10;                            fusedLocationClient.removeLocationUpdates(this);&#10;                        } else {&#10;                            Toast.makeText(SearchActivity.this,&#10;                                    &quot;Unable to get your location. Please enable location services and try again.&quot;,&#10;                                    Toast.LENGTH_LONG).show();&#10;                        }&#10;                    }&#10;                }, getMainLooper());&#10;    }&#10;&#10;    @Override&#10;    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions,&#10;                                           @NonNull int[] grantResults) {&#10;        super.onRequestPermissionsResult(requestCode, permissions, grantResults);&#10;&#10;        if (requestCode == LOCATION_PERMISSION_REQUEST_CODE) {&#10;            if (grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {&#10;                // Permission granted, get location&#10;                getCurrentLocation();&#10;            } else {&#10;                Toast.makeText(this, &quot;Location permission denied&quot;, Toast.LENGTH_SHORT).show();&#10;            }&#10;        }&#10;    }&#10;&#10;    private void setupCityList() {&#10;        // Popular cities with consistent gradient matching Figma design&#10;        cityList = new ArrayList&lt;&gt;();&#10;&#10;        // All cities use the same radial gradient for consistency&#10;        cityList.add(new CityWeather(&quot;Montreal&quot;, &quot;Canada&quot;, &quot;Mid Rain&quot;,&#10;                19, 24, 18,&#10;                R.drawable.moon_cloud_mid_rain,&#10;                R.drawable.weather_detail_card_background));&#10;&#10;        cityList.add(new CityWeather(&quot;Toronto&quot;, &quot;Canada&quot;, &quot;Fast Wind&quot;,&#10;                20, 21, 15,&#10;                R.drawable.moon_cloud_fast_wind,&#10;                R.drawable.weather_detail_card_background));&#10;&#10;        cityList.add(new CityWeather(&quot;Tokyo&quot;, &quot;Japan&quot;, &quot;Showers&quot;,&#10;                13, 16, 8,&#10;                R.drawable.sun_cloud_angled_rain,&#10;                R.drawable.weather_detail_card_background));&#10;&#10;        cityList.add(new CityWeather(&quot;Singapore&quot;, &quot;Singapore&quot;, &quot;Partly Cloudy&quot;,&#10;                31, 36, 26,&#10;                R.drawable.sun_cloud_mid_rain,&#10;                R.drawable.weather_detail_card_background));&#10;&#10;        cityList.add(new CityWeather(&quot;Paris&quot;, &quot;France&quot;, &quot;Clear Sky&quot;,&#10;                18, 22, 14,&#10;                R.drawable.sun_cloud_little_rain,&#10;                R.drawable.weather_detail_card_background));&#10;&#10;        cityList.add(new CityWeather(&quot;New York&quot;, &quot;United States&quot;, &quot;Cloudy&quot;,&#10;                16, 19, 12,&#10;                R.drawable.moon_cloud_mid_rain,&#10;                R.drawable.weather_detail_card_background));&#10;&#10;        cityList.add(new CityWeather(&quot;London&quot;, &quot;United Kingdom&quot;, &quot;Rainy&quot;,&#10;                12, 15, 9,&#10;                R.drawable.big_rain_drops,&#10;                R.drawable.weather_detail_card_background));&#10;&#10;        cityList.add(new CityWeather(&quot;Hanoi&quot;, &quot;Vietnam&quot;, &quot;Hot &amp; Sunny&quot;,&#10;                32, 35, 28,&#10;                R.drawable.sun_cloud_little_rain,&#10;                R.drawable.weather_detail_card_background));&#10;&#10;        // Setup RecyclerView&#10;        CityWeatherAdapter adapter = new CityWeatherAdapter(cityList, this::onCityClick);&#10;        binding.recyclerViewCities.setLayoutManager(new LinearLayoutManager(this));&#10;        binding.recyclerViewCities.setAdapter(adapter);&#10;    }&#10;&#10;    private void onCityClick(CityWeather city) {&#10;        // Return selected city to MainActivity&#10;        returnCityToMain(city.getCityName());&#10;    }&#10;&#10;    private void searchCity(String cityName) {&#10;        // Return searched city to MainActivity&#10;        returnCityToMain(cityName);&#10;    }&#10;&#10;    private void returnCityToMain(String cityName) {&#10;        Intent resultIntent = new Intent();&#10;        resultIntent.putExtra(EXTRA_CITY_NAME, cityName);&#10;        setResult(RESULT_OK, resultIntent);&#10;        finish();&#10;    }&#10;&#10;    private void returnLocationToMain(double latitude, double longitude) {&#10;        Intent resultIntent = new Intent();&#10;        resultIntent.putExtra(EXTRA_USE_GPS, true);&#10;        resultIntent.putExtra(EXTRA_LATITUDE, latitude);&#10;        resultIntent.putExtra(EXTRA_LONGITUDE, longitude);&#10;        setResult(RESULT_OK, resultIntent);&#10;        finish();&#10;    }&#10;&#10;    @Override&#10;    protected void onDestroy() {&#10;        super.onDestroy();&#10;        binding = null;&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.weatherapp.ui.activities;&#13;&#10;&#13;&#10;import android.Manifest;&#13;&#10;import android.content.Intent;&#13;&#10;import android.content.pm.PackageManager;&#13;&#10;import android.os.Bundle;&#13;&#10;import android.view.KeyEvent;&#13;&#10;import android.view.View;&#13;&#10;import android.view.inputmethod.EditorInfo;&#13;&#10;import android.widget.Toast;&#13;&#10;&#13;&#10;import androidx.annotation.NonNull;&#13;&#10;import androidx.appcompat.app.AppCompatActivity;&#13;&#10;import androidx.core.app.ActivityCompat;&#13;&#10;import androidx.core.content.ContextCompat;&#13;&#10;import androidx.recyclerview.widget.LinearLayoutManager;&#13;&#10;import androidx.recyclerview.widget.RecyclerView;&#13;&#10;&#13;&#10;import com.example.weatherapp.R;&#13;&#10;import com.example.weatherapp.data.models.CityWeather;&#13;&#10;import com.example.weatherapp.databinding.ActivitySearchBinding;&#13;&#10;import com.example.weatherapp.ui.adapters.CityWeatherAdapter;&#13;&#10;import com.google.android.gms.location.FusedLocationProviderClient;&#13;&#10;import com.google.android.gms.location.LocationServices;&#13;&#10;&#13;&#10;import java.util.ArrayList;&#13;&#10;import java.util.List;&#13;&#10;&#13;&#10;public class SearchActivity extends AppCompatActivity {&#13;&#10;&#13;&#10;    private ActivitySearchBinding binding;&#13;&#10;    private List&lt;CityWeather&gt; cityList;&#13;&#10;    public static final String EXTRA_CITY_NAME = &quot;city_name&quot;;&#13;&#10;    public static final String EXTRA_USE_GPS = &quot;use_gps&quot;;&#13;&#10;    public static final String EXTRA_LATITUDE = &quot;latitude&quot;;&#13;&#10;    public static final String EXTRA_LONGITUDE = &quot;longitude&quot;;&#13;&#10;&#13;&#10;    private static final int LOCATION_PERMISSION_REQUEST_CODE = 1001;&#13;&#10;    private FusedLocationProviderClient fusedLocationClient;&#13;&#10;&#13;&#10;    @Override&#13;&#10;    protected void onCreate(Bundle savedInstanceState) {&#13;&#10;        super.onCreate(savedInstanceState);&#13;&#10;        binding = ActivitySearchBinding.inflate(getLayoutInflater());&#13;&#10;        setContentView(binding.getRoot());&#13;&#10;&#13;&#10;        fusedLocationClient = LocationServices.getFusedLocationProviderClient(this);&#13;&#10;&#13;&#10;        setupListeners();&#13;&#10;        setupCityList();&#13;&#10;    }&#13;&#10;&#13;&#10;    private void setupListeners() {&#13;&#10;        // Back button click&#13;&#10;        binding.btnBack.setOnClickListener(v -&gt; finish());&#13;&#10;&#13;&#10;        // Search button click&#13;&#10;        binding.btnSearchIcon.setOnClickListener(v -&gt; {&#13;&#10;            String query = binding.etSearch.getText().toString().trim();&#13;&#10;            if (!query.isEmpty()) {&#13;&#10;                searchCity(query);&#13;&#10;            } else {&#13;&#10;                Toast.makeText(this, &quot;Please enter a city name&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;            }&#13;&#10;        });&#13;&#10;&#13;&#10;        // Use Current Location button click&#13;&#10;        binding.btnUseCurrentLocation.setOnClickListener(v -&gt; {&#13;&#10;            requestCurrentLocation();&#13;&#10;        });&#13;&#10;&#13;&#10;        // Search when user presses Enter on keyboard&#13;&#10;        binding.etSearch.setOnEditorActionListener((v, actionId, event) -&gt; {&#13;&#10;            if (actionId == EditorInfo.IME_ACTION_SEARCH ||&#13;&#10;                    actionId == EditorInfo.IME_ACTION_DONE ||&#13;&#10;                    (event != null &amp;&amp; event.getKeyCode() == KeyEvent.KEYCODE_ENTER &amp;&amp; event.getAction() == KeyEvent.ACTION_DOWN)) {&#13;&#10;                String query = binding.etSearch.getText().toString().trim();&#13;&#10;                if (!query.isEmpty()) {&#13;&#10;                    searchCity(query);&#13;&#10;                    return true;&#13;&#10;                } else {&#13;&#10;                    Toast.makeText(this, &quot;Please enter a city name&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;                }&#13;&#10;            }&#13;&#10;            return false;&#13;&#10;        });&#13;&#10;    }&#13;&#10;&#13;&#10;    private void requestCurrentLocation() {&#13;&#10;        // Check if location permission is granted&#13;&#10;        if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION)&#13;&#10;                != PackageManager.PERMISSION_GRANTED) {&#13;&#10;            // Request permission&#13;&#10;            ActivityCompat.requestPermissions(this,&#13;&#10;                    new String[]{Manifest.permission.ACCESS_FINE_LOCATION},&#13;&#10;                    LOCATION_PERMISSION_REQUEST_CODE);&#13;&#10;        } else {&#13;&#10;            // Permission already granted, get location&#13;&#10;            getCurrentLocation();&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    private void getCurrentLocation() {&#13;&#10;        if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION)&#13;&#10;                != PackageManager.PERMISSION_GRANTED) {&#13;&#10;            return;&#13;&#10;        }&#13;&#10;&#13;&#10;        Toast.makeText(this, &quot;Getting your location...&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;&#13;&#10;        fusedLocationClient.getLastLocation()&#13;&#10;                .addOnSuccessListener(this, location -&gt; {&#13;&#10;                    if (location != null) {&#13;&#10;                        // Got location, return to MainActivity with coordinates&#13;&#10;                        returnLocationToMain(location.getLatitude(), location.getLongitude());&#13;&#10;                    } else {&#13;&#10;                        // Last location not available, request fresh location&#13;&#10;                        requestFreshLocation();&#13;&#10;                    }&#13;&#10;                })&#13;&#10;                .addOnFailureListener(this, e -&gt; {&#13;&#10;                    Toast.makeText(this, &quot;Failed to get location: &quot; + e.getMessage(),&#13;&#10;                            Toast.LENGTH_SHORT).show();&#13;&#10;                });&#13;&#10;    }&#13;&#10;&#13;&#10;    // Request fresh location when last location is not available&#13;&#10;    private void requestFreshLocation() {&#13;&#10;        if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION)&#13;&#10;                != PackageManager.PERMISSION_GRANTED) {&#13;&#10;            return;&#13;&#10;        }&#13;&#10;&#13;&#10;        Toast.makeText(this, &quot;Requesting fresh location...&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;&#13;&#10;        com.google.android.gms.location.LocationRequest locationRequest =&#13;&#10;                new com.google.android.gms.location.LocationRequest.Builder(&#13;&#10;                        com.google.android.gms.location.Priority.PRIORITY_HIGH_ACCURACY, 10000)&#13;&#10;                        .setMinUpdateIntervalMillis(5000)&#13;&#10;                        .setMaxUpdates(1)&#13;&#10;                        .build();&#13;&#10;&#13;&#10;        fusedLocationClient.requestLocationUpdates(locationRequest,&#13;&#10;                new com.google.android.gms.location.LocationCallback() {&#13;&#10;                    @Override&#13;&#10;                    public void onLocationResult(@NonNull com.google.android.gms.location.LocationResult locationResult) {&#13;&#10;                        super.onLocationResult(locationResult);&#13;&#10;                        if (locationResult != null &amp;&amp; locationResult.getLastLocation() != null) {&#13;&#10;                            android.location.Location location = locationResult.getLastLocation();&#13;&#10;                            returnLocationToMain(location.getLatitude(), location.getLongitude());&#13;&#10;                            // Stop location updates after getting location&#13;&#10;                            fusedLocationClient.removeLocationUpdates(this);&#13;&#10;                        } else {&#13;&#10;                            Toast.makeText(SearchActivity.this,&#13;&#10;                                    &quot;Unable to get your location. Please enable location services and try again.&quot;,&#13;&#10;                                    Toast.LENGTH_LONG).show();&#13;&#10;                        }&#13;&#10;                    }&#13;&#10;                }, getMainLooper());&#13;&#10;    }&#13;&#10;&#13;&#10;    @Override&#13;&#10;    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions,&#13;&#10;                                           @NonNull int[] grantResults) {&#13;&#10;        super.onRequestPermissionsResult(requestCode, permissions, grantResults);&#13;&#10;&#13;&#10;        if (requestCode == LOCATION_PERMISSION_REQUEST_CODE) {&#13;&#10;            if (grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {&#13;&#10;                // Permission granted, get location&#13;&#10;                getCurrentLocation();&#13;&#10;            } else {&#13;&#10;                Toast.makeText(this, &quot;Location permission denied&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    private void setupCityList() {&#13;&#10;        // Popular cities with consistent gradient matching Figma design&#13;&#10;        cityList = new ArrayList&lt;&gt;();&#13;&#10;&#13;&#10;        // All cities use the same radial gradient for consistency&#13;&#10;        cityList.add(new CityWeather(&quot;Montreal&quot;, &quot;Canada&quot;, &quot;Mid Rain&quot;,&#13;&#10;                19, 24, 18,&#13;&#10;                R.drawable.moon_cloud_mid_rain,&#13;&#10;                R.drawable.weather_detail_card_background));&#13;&#10;&#13;&#10;        cityList.add(new CityWeather(&quot;Toronto&quot;, &quot;Canada&quot;, &quot;Fast Wind&quot;,&#13;&#10;                20, 21, 15,&#13;&#10;                R.drawable.moon_cloud_fast_wind,&#13;&#10;                R.drawable.weather_detail_card_background));&#13;&#10;&#13;&#10;        cityList.add(new CityWeather(&quot;Tokyo&quot;, &quot;Japan&quot;, &quot;Showers&quot;,&#13;&#10;                13, 16, 8,&#13;&#10;                R.drawable.sun_cloud_angled_rain,&#13;&#10;                R.drawable.weather_detail_card_background));&#13;&#10;&#13;&#10;        cityList.add(new CityWeather(&quot;Singapore&quot;, &quot;Singapore&quot;, &quot;Partly Cloudy&quot;,&#13;&#10;                31, 36, 26,&#13;&#10;                R.drawable.sun_cloud_mid_rain,&#13;&#10;                R.drawable.weather_detail_card_background));&#13;&#10;&#13;&#10;        cityList.add(new CityWeather(&quot;Paris&quot;, &quot;France&quot;, &quot;Clear Sky&quot;,&#13;&#10;                18, 22, 14,&#13;&#10;                R.drawable.sun_cloud_little_rain,&#13;&#10;                R.drawable.weather_detail_card_background));&#13;&#10;&#13;&#10;        cityList.add(new CityWeather(&quot;New York&quot;, &quot;United States&quot;, &quot;Cloudy&quot;,&#13;&#10;                16, 19, 12,&#13;&#10;                R.drawable.moon_cloud_mid_rain,&#13;&#10;                R.drawable.weather_detail_card_background));&#13;&#10;&#13;&#10;        cityList.add(new CityWeather(&quot;London&quot;, &quot;United Kingdom&quot;, &quot;Rainy&quot;,&#13;&#10;                12, 15, 9,&#13;&#10;                R.drawable.big_rain_drops,&#13;&#10;                R.drawable.weather_detail_card_background));&#13;&#10;&#13;&#10;        cityList.add(new CityWeather(&quot;Hanoi&quot;, &quot;Vietnam&quot;, &quot;Hot &amp; Sunny&quot;,&#13;&#10;                32, 35, 28,&#13;&#10;                R.drawable.sun_cloud_little_rain,&#13;&#10;                R.drawable.weather_detail_card_background));&#13;&#10;&#13;&#10;        // Setup RecyclerView&#13;&#10;        CityWeatherAdapter adapter = new CityWeatherAdapter(cityList, this::onCityClick);&#13;&#10;        binding.recyclerViewCities.setLayoutManager(new LinearLayoutManager(this));&#13;&#10;        binding.recyclerViewCities.setAdapter(adapter);&#13;&#10;    }&#13;&#10;&#13;&#10;    private void onCityClick(CityWeather city) {&#13;&#10;        // Return selected city to MainActivity&#13;&#10;        returnCityToMain(city.getCityName());&#13;&#10;    }&#13;&#10;&#13;&#10;    private void searchCity(String cityName) {&#13;&#10;        // Return searched city to MainActivity&#13;&#10;        returnCityToMain(cityName);&#13;&#10;    }&#13;&#10;&#13;&#10;    private void returnCityToMain(String cityName) {&#13;&#10;        Intent resultIntent = new Intent();&#13;&#10;        resultIntent.putExtra(EXTRA_CITY_NAME, cityName);&#13;&#10;        setResult(RESULT_OK, resultIntent);&#13;&#10;        finish();&#13;&#10;    }&#13;&#10;&#13;&#10;    private void returnLocationToMain(double latitude, double longitude) {&#13;&#10;        Intent resultIntent = new Intent();&#13;&#10;        resultIntent.putExtra(EXTRA_USE_GPS, true);&#13;&#10;        resultIntent.putExtra(EXTRA_LATITUDE, latitude);&#13;&#10;        resultIntent.putExtra(EXTRA_LONGITUDE, longitude);&#13;&#10;        setResult(RESULT_OK, resultIntent);&#13;&#10;        finish();&#13;&#10;    }&#13;&#10;&#13;&#10;    @Override&#13;&#10;    protected void onDestroy() {&#13;&#10;        super.onDestroy();&#13;&#10;        binding = null;&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/activities/SettingsActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/activities/SettingsActivity.java" />
              <option name="updatedContent" value="package com.example.weatherapp.ui.activities;&#10;&#10;import android.content.Context;&#10;import android.content.Intent;&#10;import android.content.SharedPreferences;&#10;import android.os.Bundle;&#10;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.work.WorkManager;&#10;&#10;import com.example.weatherapp.databinding.ActivitySettingsBinding;&#10;import com.example.weatherapp.notification.WeatherNotificationManager;&#10;import com.example.weatherapp.notification.WeatherNotificationWorker;&#10;import com.example.weatherapp.utils.LocaleHelper;&#10;&#10;public class SettingsActivity extends AppCompatActivity {&#10;&#10;    private ActivitySettingsBinding binding;&#10;    private SharedPreferences sharedPreferences;&#10;    private static final String PREFS_NAME = &quot;WeatherAppPrefs&quot;;&#10;    private static final String KEY_TEMPERATURE_UNIT = &quot;temperature_unit&quot;;&#10;    private static final String KEY_WIND_SPEED_UNIT = &quot;wind_speed_unit&quot;;&#10;    private static final String KEY_PRESSURE_UNIT = &quot;pressure_unit&quot;;&#10;    private static final String KEY_DARK_MODE = &quot;dark_mode&quot;;&#10;    private static final String KEY_NOTIFICATIONS = &quot;notifications&quot;;&#10;    private static final String KEY_LANGUAGE = &quot;language&quot;;&#10;&#10;    // Flags to prevent infinite loops&#10;    private boolean isUpdatingTemperature = false;&#10;    private boolean isUpdatingWind = false;&#10;    private boolean isUpdatingPressure = false;&#10;    private boolean isUpdatingLanguage = false;&#10;&#10;    @Override&#10;    protected void attachBaseContext(Context newBase) {&#10;        super.attachBaseContext(LocaleHelper.onAttach(newBase));&#10;    }&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        binding = ActivitySettingsBinding.inflate(getLayoutInflater());&#10;        setContentView(binding.getRoot());&#10;&#10;        sharedPreferences = getSharedPreferences(PREFS_NAME, MODE_PRIVATE);&#10;&#10;        setupToolbar();&#10;        loadSettings();&#10;        setupListeners();&#10;    }&#10;&#10;    private void setupToolbar() {&#10;        binding.btnBack.setOnClickListener(v -&gt; finish());&#10;    }&#10;&#10;    private void loadSettings() {&#10;        // Load Temperature Unit&#10;        String tempUnit = sharedPreferences.getString(KEY_TEMPERATURE_UNIT, &quot;celsius&quot;);&#10;        binding.switchCelsius.setChecked(tempUnit.equals(&quot;celsius&quot;));&#10;        binding.switchFahrenheit.setChecked(tempUnit.equals(&quot;fahrenheit&quot;));&#10;&#10;        // Load Wind Speed Unit&#10;        String windUnit = sharedPreferences.getString(KEY_WIND_SPEED_UNIT, &quot;ms&quot;);&#10;        binding.switchWindMs.setChecked(windUnit.equals(&quot;ms&quot;));&#10;        binding.switchWindKmh.setChecked(windUnit.equals(&quot;kmh&quot;));&#10;&#10;        // Load Pressure Unit&#10;        String pressureUnit = sharedPreferences.getString(KEY_PRESSURE_UNIT, &quot;hpa&quot;);&#10;        binding.switchPressureHpa.setChecked(pressureUnit.equals(&quot;hpa&quot;));&#10;        binding.switchPressureMbar.setChecked(pressureUnit.equals(&quot;mbar&quot;));&#10;&#10;        // Load Dark Mode&#10;        boolean darkMode = sharedPreferences.getBoolean(KEY_DARK_MODE, true);&#10;        binding.switchDarkMode.setChecked(darkMode);&#10;&#10;        // Load Notifications&#10;        boolean notifications = sharedPreferences.getBoolean(KEY_NOTIFICATIONS, true);&#10;        binding.switchNotifications.setChecked(notifications);&#10;&#10;        // Load Language - Fixed logic - Default to Vietnamese&#10;        String language = sharedPreferences.getString(KEY_LANGUAGE, &quot;vi&quot;);&#10;        binding.switchEnglish.setChecked(language.equals(&quot;en&quot;));&#10;        binding.switchVietnamese.setChecked(language.equals(&quot;vi&quot;));&#10;    }&#10;&#10;    private void setupListeners() {&#10;        // Temperature Unit - Fixed logic&#10;        binding.switchCelsius.setOnCheckedChangeListener((buttonView, isChecked) -&gt; {&#10;            if (isUpdatingTemperature) return;&#10;&#10;            if (isChecked) {&#10;                isUpdatingTemperature = true;&#10;                binding.switchFahrenheit.setChecked(false);&#10;                isUpdatingTemperature = false;&#10;                saveTemperatureUnit(&quot;celsius&quot;);&#10;            } else if (!binding.switchFahrenheit.isChecked()) {&#10;                // Don't allow both to be unchecked&#10;                isUpdatingTemperature = true;&#10;                binding.switchCelsius.setChecked(true);&#10;                isUpdatingTemperature = false;&#10;            }&#10;        });&#10;&#10;        binding.switchFahrenheit.setOnCheckedChangeListener((buttonView, isChecked) -&gt; {&#10;            if (isUpdatingTemperature) return;&#10;&#10;            if (isChecked) {&#10;                isUpdatingTemperature = true;&#10;                binding.switchCelsius.setChecked(false);&#10;                isUpdatingTemperature = false;&#10;                saveTemperatureUnit(&quot;fahrenheit&quot;);&#10;            } else if (!binding.switchCelsius.isChecked()) {&#10;                // Don't allow both to be unchecked&#10;                isUpdatingTemperature = true;&#10;                binding.switchFahrenheit.setChecked(true);&#10;                isUpdatingTemperature = false;&#10;            }&#10;        });&#10;&#10;        // Wind Speed Unit - Fixed logic&#10;        binding.switchWindMs.setOnCheckedChangeListener((buttonView, isChecked) -&gt; {&#10;            if (isUpdatingWind) return;&#10;&#10;            if (isChecked) {&#10;                isUpdatingWind = true;&#10;                binding.switchWindKmh.setChecked(false);&#10;                isUpdatingWind = false;&#10;                saveWindSpeedUnit(&quot;ms&quot;);&#10;            } else if (!binding.switchWindKmh.isChecked()) {&#10;                isUpdatingWind = true;&#10;                binding.switchWindMs.setChecked(true);&#10;                isUpdatingWind = false;&#10;            }&#10;        });&#10;&#10;        binding.switchWindKmh.setOnCheckedChangeListener((buttonView, isChecked) -&gt; {&#10;            if (isUpdatingWind) return;&#10;&#10;            if (isChecked) {&#10;                isUpdatingWind = true;&#10;                binding.switchWindMs.setChecked(false);&#10;                isUpdatingWind = false;&#10;                saveWindSpeedUnit(&quot;kmh&quot;);&#10;            } else if (!binding.switchWindMs.isChecked()) {&#10;                isUpdatingWind = true;&#10;                binding.switchWindKmh.setChecked(true);&#10;                isUpdatingWind = false;&#10;            }&#10;        });&#10;&#10;        // Pressure Unit - Fixed logic&#10;        binding.switchPressureHpa.setOnCheckedChangeListener((buttonView, isChecked) -&gt; {&#10;            if (isUpdatingPressure) return;&#10;&#10;            if (isChecked) {&#10;                isUpdatingPressure = true;&#10;                binding.switchPressureMbar.setChecked(false);&#10;                isUpdatingPressure = false;&#10;                savePressureUnit(&quot;hpa&quot;);&#10;            } else if (!binding.switchPressureMbar.isChecked()) {&#10;                isUpdatingPressure = true;&#10;                binding.switchPressureHpa.setChecked(true);&#10;                isUpdatingPressure = false;&#10;            }&#10;        });&#10;&#10;        binding.switchPressureMbar.setOnCheckedChangeListener((buttonView, isChecked) -&gt; {&#10;            if (isUpdatingPressure) return;&#10;&#10;            if (isChecked) {&#10;                isUpdatingPressure = true;&#10;                binding.switchPressureHpa.setChecked(false);&#10;                isUpdatingPressure = false;&#10;                savePressureUnit(&quot;mbar&quot;);&#10;            } else if (!binding.switchPressureHpa.isChecked()) {&#10;                isUpdatingPressure = true;&#10;                binding.switchPressureMbar.setChecked(true);&#10;                isUpdatingPressure = false;&#10;            }&#10;        });&#10;&#10;        // Dark Mode&#10;        binding.switchDarkMode.setOnCheckedChangeListener((buttonView, isChecked) -&gt; {&#10;            saveDarkMode(isChecked);&#10;        });&#10;&#10;        // Notifications - Schedule/Cancel notifications when toggled&#10;        binding.switchNotifications.setOnCheckedChangeListener((buttonView, isChecked) -&gt; {&#10;            saveNotifications(isChecked);&#10;            scheduleNotifications(isChecked);&#10;        });&#10;&#10;        // Language Settings&#10;        binding.switchEnglish.setOnCheckedChangeListener((buttonView, isChecked) -&gt; {&#10;            if (isUpdatingLanguage) return;&#10;&#10;            if (isChecked) {&#10;                isUpdatingLanguage = true;&#10;                binding.switchVietnamese.setChecked(false);&#10;                isUpdatingLanguage = false;&#10;                saveLanguage(&quot;en&quot;);&#10;                applyLanguage(&quot;en&quot;);&#10;            } else if (!binding.switchVietnamese.isChecked()) {&#10;                isUpdatingLanguage = true;&#10;                binding.switchEnglish.setChecked(true);&#10;                isUpdatingLanguage = false;&#10;            }&#10;        });&#10;&#10;        binding.switchVietnamese.setOnCheckedChangeListener((buttonView, isChecked) -&gt; {&#10;            if (isUpdatingLanguage) return;&#10;&#10;            if (isChecked) {&#10;                isUpdatingLanguage = true;&#10;                binding.switchEnglish.setChecked(false);&#10;                isUpdatingLanguage = false;&#10;                saveLanguage(&quot;vi&quot;);&#10;                applyLanguage(&quot;vi&quot;);&#10;            } else if (!binding.switchEnglish.isChecked()) {&#10;                isUpdatingLanguage = true;&#10;                binding.switchVietnamese.setChecked(true);&#10;                isUpdatingLanguage = false;&#10;            }&#10;        });&#10;&#10;        // About button&#10;        binding.btnAbout.setOnClickListener(v -&gt; {&#10;            // TODO: Open About activity or dialog&#10;        });&#10;    }&#10;&#10;    private void saveTemperatureUnit(String unit) {&#10;        sharedPreferences.edit().putString(KEY_TEMPERATURE_UNIT, unit).apply();&#10;        setResult(RESULT_OK); // Notify MainActivity to refresh&#10;    }&#10;&#10;    private void saveWindSpeedUnit(String unit) {&#10;        sharedPreferences.edit().putString(KEY_WIND_SPEED_UNIT, unit).apply();&#10;        setResult(RESULT_OK);&#10;    }&#10;&#10;    private void savePressureUnit(String unit) {&#10;        sharedPreferences.edit().putString(KEY_PRESSURE_UNIT, unit).apply();&#10;        setResult(RESULT_OK);&#10;    }&#10;&#10;    private void saveDarkMode(boolean enabled) {&#10;        sharedPreferences.edit().putBoolean(KEY_DARK_MODE, enabled).apply();&#10;    }&#10;&#10;    private void saveNotifications(boolean enabled) {&#10;        sharedPreferences.edit().putBoolean(KEY_NOTIFICATIONS, enabled).apply();&#10;    }&#10;&#10;    private void saveLanguage(String language) {&#10;        sharedPreferences.edit().putString(KEY_LANGUAGE, language).apply();&#10;&#10;        // Notify MainActivity that language changed&#10;        Intent resultIntent = new Intent();&#10;        resultIntent.putExtra(&quot;language_changed&quot;, true);&#10;        setResult(RESULT_OK, resultIntent);&#10;    }&#10;&#10;    private void applyLanguage(String languageCode) {&#10;        LocaleHelper.setLocale(this, languageCode);&#10;        recreate(); // Recreate activity to apply language&#10;    }&#10;&#10;    private void scheduleNotifications(boolean enabled) {&#10;        WorkManager workManager = WorkManager.getInstance(this);&#10;&#10;        if (enabled) {&#10;            // For testing: Use OneTimeWorkRequest with 2 minute delay&#10;            // Note: PeriodicWorkRequest minimum interval is 15 minutes on Android&#10;            androidx.work.OneTimeWorkRequest weatherWorkRequest =&#10;                    new androidx.work.OneTimeWorkRequest.Builder(&#10;                            WeatherNotificationWorker.class)&#10;                            .setInitialDelay(2, java.util.concurrent.TimeUnit.MINUTES)&#10;                            .build();&#10;&#10;            workManager.enqueueUniqueWork(&#10;                    &quot;WeatherNotification&quot;,&#10;                    androidx.work.ExistingWorkPolicy.REPLACE,&#10;                    weatherWorkRequest&#10;            );&#10;&#10;            android.widget.Toast.makeText(this, &quot;Weather notification will show in 2 minutes (test mode)&quot;,&#10;                    android.widget.Toast.LENGTH_LONG).show();&#10;        } else {&#10;            // Cancel all scheduled notifications&#10;            workManager.cancelUniqueWork(&quot;WeatherNotification&quot;);&#10;&#10;            // Also cancel any shown notifications&#10;            WeatherNotificationManager notificationManager = new WeatherNotificationManager(this);&#10;            notificationManager.cancelAllNotifications();&#10;&#10;            android.widget.Toast.makeText(this, &quot;Weather notifications disabled&quot;,&#10;                    android.widget.Toast.LENGTH_SHORT).show();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    protected void onDestroy() {&#10;        super.onDestroy();&#10;        binding = null;&#10;    }&#10;&#10;    // Helper methods to get settings from MainActivity&#10;    public static String getTemperatureUnit(SharedPreferences prefs) {&#10;        return prefs.getString(KEY_TEMPERATURE_UNIT, &quot;celsius&quot;);&#10;    }&#10;&#10;    public static String getWindSpeedUnit(SharedPreferences prefs) {&#10;        return prefs.getString(KEY_WIND_SPEED_UNIT, &quot;ms&quot;);&#10;    }&#10;&#10;    public static String getPressureUnit(SharedPreferences prefs) {&#10;        return prefs.getString(KEY_PRESSURE_UNIT, &quot;hpa&quot;);&#10;    }&#10;&#10;    @SuppressWarnings(&quot;unused&quot;)&#10;    public static String getLanguage(SharedPreferences prefs) {&#10;        return prefs.getString(KEY_LANGUAGE, &quot;en&quot;);&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/activities/WeatherDetailsActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/activities/WeatherDetailsActivity.java" />
              <option name="updatedContent" value="package com.example.weatherapp.ui.activities;&#10;&#10;import android.os.Bundle;&#10;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.recyclerview.widget.GridLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.example.weatherapp.R;&#10;&#10;public class WeatherDetailsActivity extends AppCompatActivity {&#10;&#10;    private RecyclerView rvMetrics;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_weather_details);&#10;&#10;        rvMetrics = findViewById(R.id.rvMetrics);&#10;&#10;        // Setup GridLayoutManager with 2 columns&#10;        setupRecyclerView();&#10;    }&#10;&#10;    private void setupRecyclerView() {&#10;        // Setup code for RecyclerView&#10;        rvMetrics.setLayoutManager(new GridLayoutManager(this, 2));&#10;        // Other setup code...&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/adapters/CityWeatherAdapter.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/adapters/CityWeatherAdapter.java" />
              <option name="originalContent" value="package com.example.weatherapp.ui.adapters;&#10;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.ImageView;&#10;import android.widget.LinearLayout;&#10;import android.widget.TextView;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import java.util.List;&#10;import java.util.Locale;&#10;&#10;public class CityWeatherAdapter extends RecyclerView.Adapter&lt;CityWeatherAdapter.ViewHolder&gt; {&#10;&#10;    private List&lt;CityWeather&gt; cityList;&#10;    private OnCityClickListener listener;&#10;&#10;    public interface OnCityClickListener {&#10;        void onCityClick(CityWeather city);&#10;    }&#10;&#10;    public CityWeatherAdapter(List&lt;CityWeather&gt; cityList, OnCityClickListener listener) {&#10;        this.cityList = cityList;&#10;        this.listener = listener;&#10;    }&#10;&#10;    @NonNull&#10;    @Override&#10;    public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {&#10;        View view = LayoutInflater.from(parent.getContext())&#10;                .inflate(R.layout.item_city_weather, parent, false);&#10;        return new ViewHolder(view);&#10;    }&#10;&#10;    @Override&#10;    public void onBindViewHolder(@NonNull ViewHolder holder, int position) {&#10;        CityWeather city = cityList.get(position);&#10;&#10;        // Set city name and country&#10;        holder.tvCityName.setText(city.getCityName());&#10;        holder.tvCountry.setText(city.getCountry());&#10;        holder.tvWeatherDesc.setText(city.getWeatherDescription());&#10;        holder.tvTemperature.setText(String.format(Locale.getDefault(), &quot;%d°&quot;, city.getTemperature()));&#10;        holder.tvTempRange.setText(String.format(Locale.getDefault(),&#10;                &quot;H:%d°  L:%d°&quot;, city.getHighTemp(), city.getLowTemp()));&#10;&#10;        // Set weather icon - always use resource ID&#10;        holder.ivWeatherIcon.setImageResource(city.getIconResourceId());&#10;&#10;        // Set gradient background for the card&#10;        holder.cardBackground.setBackgroundResource(city.getGradientBackground());&#10;&#10;        holder.itemView.setOnClickListener(v -&gt; listener.onCityClick(city));&#10;    }&#10;&#10;    @Override&#10;    public int getItemCount() {&#10;        return cityList.size();&#10;    }&#10;&#10;    static class ViewHolder extends RecyclerView.ViewHolder {&#10;        TextView tvCityName;&#10;        TextView tvCountry;&#10;        TextView tvWeatherDesc;&#10;        TextView tvTemperature;&#10;        TextView tvTempRange;&#10;        ImageView ivWeatherIcon;&#10;        LinearLayout cardBackground;&#10;&#10;        ViewHolder(View itemView) {&#10;            super(itemView);&#10;            tvCityName = itemView.findViewById(R.id.tvCityName);&#10;            tvCountry = itemView.findViewById(R.id.tvCountry);&#10;            tvWeatherDesc = itemView.findViewById(R.id.tvWeatherDesc);&#10;            tvTemperature = itemView.findViewById(R.id.tvTemperature);&#10;            tvTempRange = itemView.findViewById(R.id.tvTempRange);&#10;            ivWeatherIcon = itemView.findViewById(R.id.ivWeatherIcon);&#10;            cardBackground = itemView.findViewById(R.id.cardBackground);&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.weatherapp.ui.adapters;&#13;&#10;&#13;&#10;import android.view.LayoutInflater;&#13;&#10;import android.view.View;&#13;&#10;import android.view.ViewGroup;&#13;&#10;import android.widget.ImageView;&#13;&#10;import android.widget.LinearLayout;&#13;&#10;import android.widget.TextView;&#13;&#10;&#13;&#10;import androidx.annotation.NonNull;&#13;&#10;import androidx.recyclerview.widget.RecyclerView;&#13;&#10;&#13;&#10;import com.example.weatherapp.R;&#13;&#10;import com.example.weatherapp.data.models.CityWeather;&#13;&#10;&#13;&#10;import java.util.List;&#13;&#10;import java.util.Locale;&#13;&#10;&#13;&#10;public class CityWeatherAdapter extends RecyclerView.Adapter&lt;CityWeatherAdapter.ViewHolder&gt; {&#13;&#10;&#13;&#10;    private List&lt;CityWeather&gt; cityList;&#13;&#10;    private OnCityClickListener listener;&#13;&#10;&#13;&#10;    public interface OnCityClickListener {&#13;&#10;        void onCityClick(CityWeather city);&#13;&#10;    }&#13;&#10;&#13;&#10;    public CityWeatherAdapter(List&lt;CityWeather&gt; cityList, OnCityClickListener listener) {&#13;&#10;        this.cityList = cityList;&#13;&#10;        this.listener = listener;&#13;&#10;    }&#13;&#10;&#13;&#10;    @NonNull&#13;&#10;    @Override&#13;&#10;    public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {&#13;&#10;        View view = LayoutInflater.from(parent.getContext())&#13;&#10;                .inflate(R.layout.item_city_weather, parent, false);&#13;&#10;        return new ViewHolder(view);&#13;&#10;    }&#13;&#10;&#13;&#10;    @Override&#13;&#10;    public void onBindViewHolder(@NonNull ViewHolder holder, int position) {&#13;&#10;        CityWeather city = cityList.get(position);&#13;&#10;&#13;&#10;        // Set city name and country&#13;&#10;        holder.tvCityName.setText(city.getCityName());&#13;&#10;        holder.tvCountry.setText(city.getCountry());&#13;&#10;        holder.tvWeatherDesc.setText(city.getWeatherDescription());&#13;&#10;        holder.tvTemperature.setText(String.format(Locale.getDefault(), &quot;%d°&quot;, city.getTemperature()));&#13;&#10;        holder.tvTempRange.setText(String.format(Locale.getDefault(),&#13;&#10;                &quot;H:%d°  L:%d°&quot;, city.getHighTemp(), city.getLowTemp()));&#13;&#10;&#13;&#10;        // Set weather icon - always use resource ID&#13;&#10;        holder.ivWeatherIcon.setImageResource(city.getIconResourceId());&#13;&#10;&#13;&#10;        // Set gradient background for the card&#13;&#10;        holder.cardBackground.setBackgroundResource(city.getGradientBackground());&#13;&#10;&#13;&#10;        holder.itemView.setOnClickListener(v -&gt; listener.onCityClick(city));&#13;&#10;    }&#13;&#10;&#13;&#10;    @Override&#13;&#10;    public int getItemCount() {&#13;&#10;        return cityList.size();&#13;&#10;    }&#13;&#10;&#13;&#10;    static class ViewHolder extends RecyclerView.ViewHolder {&#13;&#10;        TextView tvCityName;&#13;&#10;        TextView tvCountry;&#13;&#10;        TextView tvWeatherDesc;&#13;&#10;        TextView tvTemperature;&#13;&#10;        TextView tvTempRange;&#13;&#10;        ImageView ivWeatherIcon;&#13;&#10;        LinearLayout cardBackground;&#13;&#10;&#13;&#10;        ViewHolder(View itemView) {&#13;&#10;            super(itemView);&#13;&#10;            tvCityName = itemView.findViewById(R.id.tvCityName);&#13;&#10;            tvCountry = itemView.findViewById(R.id.tvCountry);&#13;&#10;            tvWeatherDesc = itemView.findViewById(R.id.tvWeatherDesc);&#13;&#10;            tvTemperature = itemView.findViewById(R.id.tvTemperature);&#13;&#10;            tvTempRange = itemView.findViewById(R.id.tvTempRange);&#13;&#10;            ivWeatherIcon = itemView.findViewById(R.id.ivWeatherIcon);&#13;&#10;            cardBackground = itemView.findViewById(R.id.cardBackground);&#13;&#10;        }&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/adapters/OutfitSuggestionAdapter.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/ui/adapters/OutfitSuggestionAdapter.java" />
              <option name="originalContent" value="package com.example.weatherapp.ui.adapters;&#10;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.TextView;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import java.util.List;&#10;&#10;public class OutfitSuggestionAdapter extends RecyclerView.Adapter&lt;OutfitSuggestionAdapter.ViewHolder&gt; {&#10;&#10;    private List&lt;OutfitSuggestion&gt; suggestions;&#10;&#10;    public OutfitSuggestionAdapter(List&lt;OutfitSuggestion&gt; suggestions) {&#10;        this.suggestions = suggestions;&#10;    }&#10;&#10;    @NonNull&#10;    @Override&#10;    public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {&#10;        View view = LayoutInflater.from(parent.getContext())&#10;                .inflate(R.layout.item_outfit_suggestion, parent, false);&#10;        return new ViewHolder(view);&#10;    }&#10;&#10;    @Override&#10;    public void onBindViewHolder(@NonNull ViewHolder holder, int position) {&#10;        OutfitSuggestion suggestion = suggestions.get(position);&#10;        holder.bind(suggestion);&#10;    }&#10;&#10;    @Override&#10;    public int getItemCount() {&#10;        return suggestions.size();&#10;    }&#10;&#10;    public void updateSuggestions(List&lt;OutfitSuggestion&gt; newSuggestions) {&#10;        this.suggestions = newSuggestions;&#10;        notifyDataSetChanged();&#10;    }&#10;&#10;    static class ViewHolder extends RecyclerView.ViewHolder {&#10;        private TextView tvEmoji;&#10;        private TextView tvCategory;&#10;        private TextView tvSuggestion;&#10;        private TextView tvReasoning;&#10;&#10;        public ViewHolder(@NonNull View itemView) {&#10;            super(itemView);&#10;            tvEmoji = itemView.findViewById(R.id.tvEmoji);&#10;            tvCategory = itemView.findViewById(R.id.tvCategory);&#10;            tvSuggestion = itemView.findViewById(R.id.tvSuggestion);&#10;            tvReasoning = itemView.findViewById(R.id.tvReasoning);&#10;        }&#10;&#10;        public void bind(OutfitSuggestion suggestion) {&#10;            tvEmoji.setText(suggestion.getEmoji());&#10;            tvCategory.setText(suggestion.getCategory());&#10;            tvSuggestion.setText(suggestion.getSuggestion());&#10;            tvReasoning.setText(suggestion.getReasoning());&#10;        }&#10;    }&#10;}&#10;&#10;&#10;" />
              <option name="updatedContent" value="package com.example.weatherapp.ui.adapters;&#13;&#10;&#13;&#10;import android.view.LayoutInflater;&#13;&#10;import android.view.View;&#13;&#10;import android.view.ViewGroup;&#13;&#10;import android.widget.TextView;&#13;&#10;&#13;&#10;import androidx.annotation.NonNull;&#13;&#10;import androidx.recyclerview.widget.RecyclerView;&#13;&#10;&#13;&#10;import com.example.weatherapp.R;&#13;&#10;import com.example.weatherapp.data.models.OutfitSuggestion;&#13;&#10;&#13;&#10;import java.util.List;&#13;&#10;&#13;&#10;public class OutfitSuggestionAdapter extends RecyclerView.Adapter&lt;OutfitSuggestionAdapter.ViewHolder&gt; {&#13;&#10;&#13;&#10;    private List&lt;OutfitSuggestion&gt; suggestions;&#13;&#10;&#13;&#10;    public OutfitSuggestionAdapter(List&lt;OutfitSuggestion&gt; suggestions) {&#13;&#10;        this.suggestions = suggestions;&#13;&#10;    }&#13;&#10;&#13;&#10;    @NonNull&#13;&#10;    @Override&#13;&#10;    public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {&#13;&#10;        View view = LayoutInflater.from(parent.getContext())&#13;&#10;                .inflate(R.layout.item_outfit_suggestion, parent, false);&#13;&#10;        return new ViewHolder(view);&#13;&#10;    }&#13;&#10;&#13;&#10;    @Override&#13;&#10;    public void onBindViewHolder(@NonNull ViewHolder holder, int position) {&#13;&#10;        OutfitSuggestion suggestion = suggestions.get(position);&#13;&#10;        holder.bind(suggestion);&#13;&#10;    }&#13;&#10;&#13;&#10;    @Override&#13;&#10;    public int getItemCount() {&#13;&#10;        return suggestions.size();&#13;&#10;    }&#13;&#10;&#13;&#10;    public void updateSuggestions(List&lt;OutfitSuggestion&gt; newSuggestions) {&#13;&#10;        this.suggestions = newSuggestions;&#13;&#10;        notifyDataSetChanged();&#13;&#10;    }&#13;&#10;&#13;&#10;    static class ViewHolder extends RecyclerView.ViewHolder {&#13;&#10;        private TextView tvEmoji;&#13;&#10;        private TextView tvCategory;&#13;&#10;        private TextView tvSuggestion;&#13;&#10;        private TextView tvReasoning;&#13;&#10;&#13;&#10;        public ViewHolder(@NonNull View itemView) {&#13;&#10;            super(itemView);&#13;&#10;            tvEmoji = itemView.findViewById(R.id.tvEmoji);&#13;&#10;            tvCategory = itemView.findViewById(R.id.tvCategory);&#13;&#10;            tvSuggestion = itemView.findViewById(R.id.tvSuggestion);&#13;&#10;            tvReasoning = itemView.findViewById(R.id.tvReasoning);&#13;&#10;        }&#13;&#10;&#13;&#10;        public void bind(OutfitSuggestion suggestion) {&#13;&#10;            tvEmoji.setText(suggestion.getEmoji());&#13;&#10;            tvCategory.setText(suggestion.getCategory());&#13;&#10;            tvSuggestion.setText(suggestion.getSuggestion());&#13;&#10;            tvReasoning.setText(suggestion.getReasoning());&#13;&#10;        }&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/utils/FavoriteCitiesManager.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/utils/FavoriteCitiesManager.java" />
              <option name="originalContent" value="package com.example.weatherapp.utils;&#10;&#10;import android.content.Context;&#10;import android.content.SharedPreferences;&#10;import com.google.gson.Gson;&#10;import com.google.gson.reflect.TypeToken;&#10;import java.lang.reflect.Type;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;public class FavoriteCitiesManager {&#10;    private static final String PREFS_NAME = &quot;FavoriteCities&quot;;&#10;    private static final String KEY_CITIES = &quot;cities&quot;;&#10;    private static final int MAX_FAVORITE_CITIES = 10;&#10;&#10;    private final SharedPreferences sharedPreferences;&#10;    private final Gson gson;&#10;&#10;    public FavoriteCitiesManager(Context context) {&#10;        this.sharedPreferences = context.getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE);&#10;        this.gson = new Gson();&#10;    }&#10;&#10;    public List&lt;FavoriteCity&gt; getFavoriteCities() {&#10;        String json = sharedPreferences.getString(KEY_CITIES, null);&#10;        if (json == null) {&#10;            return new ArrayList&lt;&gt;();&#10;        }&#10;&#10;        Type type = new TypeToken&lt;List&lt;FavoriteCity&gt;&gt;(){}.getType();&#10;        List&lt;FavoriteCity&gt; cities = gson.fromJson(json, type);&#10;        return cities != null ? cities : new ArrayList&lt;&gt;();&#10;    }&#10;&#10;    public boolean addFavoriteCity(FavoriteCity city) {&#10;        List&lt;FavoriteCity&gt; cities = getFavoriteCities();&#10;&#10;        // Check if city already exists&#10;        for (FavoriteCity existingCity : cities) {&#10;            if (existingCity.getCityName().equalsIgnoreCase(city.getCityName())) {&#10;                return false; // City already in favorites&#10;            }&#10;        }&#10;&#10;        // Check max limit&#10;        if (cities.size() &gt;= MAX_FAVORITE_CITIES) {&#10;            return false; // Max limit reached&#10;        }&#10;&#10;        cities.add(city);&#10;        saveCities(cities);&#10;        return true;&#10;    }&#10;&#10;    public boolean removeFavoriteCity(String cityName) {&#10;        List&lt;FavoriteCity&gt; cities = getFavoriteCities();&#10;        boolean removed = cities.removeIf(city -&gt; city.getCityName().equalsIgnoreCase(cityName));&#10;&#10;        if (removed) {&#10;            saveCities(cities);&#10;        }&#10;        return removed;&#10;    }&#10;&#10;    public boolean isFavorite(String cityName) {&#10;        List&lt;FavoriteCity&gt; cities = getFavoriteCities();&#10;        for (FavoriteCity city : cities) {&#10;            if (city.getCityName().equalsIgnoreCase(cityName)) {&#10;                return true;&#10;            }&#10;        }&#10;        return false;&#10;    }&#10;&#10;    public void updateCityWeather(String cityName, double temp, String condition, String description) {&#10;        List&lt;FavoriteCity&gt; cities = getFavoriteCities();&#10;        for (FavoriteCity city : cities) {&#10;            if (city.getCityName().equalsIgnoreCase(cityName)) {&#10;                city.setCurrentTemp(temp);&#10;                city.setWeatherCondition(condition);&#10;                city.setWeatherDescription(description);&#10;                city.setLastUpdated(System.currentTimeMillis());&#10;                break;&#10;            }&#10;        }&#10;        saveCities(cities);&#10;    }&#10;&#10;    private void saveCities(List&lt;FavoriteCity&gt; cities) {&#10;        String json = gson.toJson(cities);&#10;        sharedPreferences.edit().putString(KEY_CITIES, json).apply();&#10;    }&#10;&#10;    public int getFavoriteCitiesCount() {&#10;        return getFavoriteCities().size();&#10;    }&#10;&#10;    public boolean canAddMoreCities() {&#10;        return getFavoriteCities().size() &lt; MAX_FAVORITE_CITIES;&#10;    }&#10;}&#10;&#10;&#10;" />
              <option name="updatedContent" value="package com.example.weatherapp.utils;&#10;&#10;import android.content.Context;&#10;import android.content.SharedPreferences;&#10;&#10;import com.example.weatherapp.data.models.FavoriteCity;&#10;import com.google.gson.Gson;&#10;import com.google.gson.reflect.TypeToken;&#10;&#10;import java.lang.reflect.Type;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;public class FavoriteCitiesManager {&#10;    private static final String PREFS_NAME = &quot;FavoriteCities&quot;;&#10;    private static final String KEY_CITIES = &quot;cities&quot;;&#10;    private static final int MAX_FAVORITE_CITIES = 10;&#10;&#10;    private final SharedPreferences sharedPreferences;&#10;    private final Gson gson;&#10;&#10;    public FavoriteCitiesManager(Context context) {&#10;        this.sharedPreferences = context.getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE);&#10;        this.gson = new Gson();&#10;    }&#10;&#10;    public List&lt;FavoriteCity&gt; getFavoriteCities() {&#10;        String json = sharedPreferences.getString(KEY_CITIES, null);&#10;        if (json == null) {&#10;            return new ArrayList&lt;&gt;();&#10;        }&#10;&#10;        Type type = new TypeToken&lt;List&lt;FavoriteCity&gt;&gt;(){}.getType();&#10;        List&lt;FavoriteCity&gt; cities = gson.fromJson(json, type);&#10;        return cities != null ? cities : new ArrayList&lt;&gt;();&#10;    }&#10;&#10;    public boolean addFavoriteCity(FavoriteCity city) {&#10;        List&lt;FavoriteCity&gt; cities = getFavoriteCities();&#10;&#10;        // Check if city already exists&#10;        for (FavoriteCity existingCity : cities) {&#10;            if (existingCity.getCityName().equalsIgnoreCase(city.getCityName())) {&#10;                return false; // City already in favorites&#10;            }&#10;        }&#10;&#10;        // Check max limit&#10;        if (cities.size() &gt;= MAX_FAVORITE_CITIES) {&#10;            return false; // Max limit reached&#10;        }&#10;&#10;        cities.add(city);&#10;        saveCities(cities);&#10;        return true;&#10;    }&#10;&#10;    public boolean removeFavoriteCity(String cityName) {&#10;        List&lt;FavoriteCity&gt; cities = getFavoriteCities();&#10;        boolean removed = cities.removeIf(city -&gt; city.getCityName().equalsIgnoreCase(cityName));&#10;&#10;        if (removed) {&#10;            saveCities(cities);&#10;        }&#10;        return removed;&#10;    }&#10;&#10;    public boolean isFavorite(String cityName) {&#10;        List&lt;FavoriteCity&gt; cities = getFavoriteCities();&#10;        for (FavoriteCity city : cities) {&#10;            if (city.getCityName().equalsIgnoreCase(cityName)) {&#10;                return true;&#10;            }&#10;        }&#10;        return false;&#10;    }&#10;&#10;    public void updateCityWeather(String cityName, double temp, String condition, String description) {&#10;        List&lt;FavoriteCity&gt; cities = getFavoriteCities();&#10;        for (FavoriteCity city : cities) {&#10;            if (city.getCityName().equalsIgnoreCase(cityName)) {&#10;                city.setCurrentTemp(temp);&#10;                city.setWeatherCondition(condition);&#10;                city.setWeatherDescription(description);&#10;                city.setLastUpdated(System.currentTimeMillis());&#10;                break;&#10;            }&#10;        }&#10;        saveCities(cities);&#10;    }&#10;&#10;    private void saveCities(List&lt;FavoriteCity&gt; cities) {&#10;        String json = gson.toJson(cities);&#10;        sharedPreferences.edit().putString(KEY_CITIES, json).apply();&#10;    }&#10;&#10;    public int getFavoriteCitiesCount() {&#10;        return getFavoriteCities().size();&#10;    }&#10;&#10;    public boolean canAddMoreCities() {&#10;        return getFavoriteCities().size() &lt; MAX_FAVORITE_CITIES;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/utils/OutfitSuggestionService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/utils/OutfitSuggestionService.java" />
              <option name="originalContent" value="package com.example.weatherapp.utils;&#10;&#10;import android.content.Context;&#10;import android.util.Log;&#10;&#10;import org.json.JSONArray;&#10;import org.json.JSONObject;&#10;&#10;import java.io.IOException;&#10;import java.net.SocketTimeoutException;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.concurrent.TimeUnit;&#10;&#10;import okhttp3.MediaType;&#10;import okhttp3.OkHttpClient;&#10;import okhttp3.Request;&#10;import okhttp3.RequestBody;&#10;import okhttp3.Response;&#10;import okhttp3.logging.HttpLoggingInterceptor;&#10;&#10;public class OutfitSuggestionService {&#10;    private static final String TAG = &quot;OutfitSuggestionService&quot;;&#10;&#10;    // Google Gemini API - MIỄN PHÍ 100%!&#10;    // Lấy API key tại: https://makersuite.google.com/app/apikey&#10;    private static final String GEMINI_API_KEY = &quot;AIzaSyAPtCim4ke9C8SwsY2bXszsQotGfxE-XH4&quot;;&#10;    private static final String GEMINI_API_URL = &quot;https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=&quot;;&#10;&#10;    private final Context context;&#10;    private final OkHttpClient client;&#10;&#10;    public OutfitSuggestionService(Context context) {&#10;        this.context = context;&#10;&#10;        HttpLoggingInterceptor loggingInterceptor = new HttpLoggingInterceptor();&#10;        loggingInterceptor.setLevel(HttpLoggingInterceptor.Level.BODY);&#10;&#10;        client = new OkHttpClient.Builder()&#10;                .addInterceptor(loggingInterceptor)&#10;                .connectTimeout(20, TimeUnit.SECONDS)&#10;                .readTimeout(45, TimeUnit.SECONDS)      // ≥ 45s cho LLM&#10;                .writeTimeout(30, TimeUnit.SECONDS)&#10;                .callTimeout(60, TimeUnit.SECONDS)      // Timeout tổng&#10;                .retryOnConnectionFailure(true)&#10;                .build();&#10;    }&#10;&#10;    public interface OutfitSuggestionCallback {&#10;        void onSuccess(List&lt;OutfitSuggestion&gt; suggestions);&#10;        void onError(String error);&#10;    }&#10;&#10;    public void getOutfitSuggestions(WeatherResponse weatherData, OutfitSuggestionCallback callback) {&#10;        // Kiểm tra API key - KHÔNG dùng API nếu key là placeholder&#10;        if (GEMINI_API_KEY.isEmpty() || GEMINI_API_KEY.equals(&quot;YOUR_GEMINI_API_KEY_HERE&quot;)) {&#10;            Log.d(TAG, &quot;Using default offline suggestions - No API key&quot;);&#10;            callback.onSuccess(getDefaultOutfitSuggestions(weatherData));&#10;            return;&#10;        }&#10;&#10;        // Log để biết đang sử dụng Gemini API&#10;        Log.d(TAG, &quot;=== USING GEMINI API ===&quot;);&#10;        Log.d(TAG, &quot;Model: gemini-2.5-flash&quot;);&#10;&#10;        // Gọi Gemini API trong background thread&#10;        new Thread(() -&gt; {&#10;            try {&#10;                Log.d(TAG, &quot;Calling Gemini API...&quot;);&#10;                List&lt;OutfitSuggestion&gt; suggestions = callGeminiAPI(weatherData);&#10;&#10;                if (suggestions != null &amp;&amp; !suggestions.isEmpty()) {&#10;                    Log.d(TAG, &quot;✅ Gemini API SUCCESS - Got &quot; + suggestions.size() + &quot; suggestions&quot;);&#10;                    callback.onSuccess(suggestions);&#10;                } else {&#10;                    Log.w(TAG, &quot;⚠️ Gemini API returned empty - Using default&quot;);&#10;                    callback.onSuccess(getDefaultOutfitSuggestions(weatherData));&#10;                }&#10;            } catch (Exception e) {&#10;                Log.e(TAG, &quot;❌ Gemini API ERROR: &quot; + e.getMessage());&#10;                // Fallback to default suggestions&#10;                callback.onSuccess(getDefaultOutfitSuggestions(weatherData));&#10;            }&#10;        }).start();&#10;    }&#10;&#10;    private List&lt;OutfitSuggestion&gt; callGeminiAPI(WeatherResponse weatherData) throws Exception {&#10;        return callGeminiAPIWithConfig(weatherData, 2048, false);&#10;    }&#10;&#10;    private List&lt;OutfitSuggestion&gt; callGeminiAPIWithConfig(WeatherResponse weatherData, int maxTokens, boolean isRetry) throws Exception {&#10;        String prompt = createPrompt(weatherData);&#10;&#10;        // Payload tối giản (đúng cú pháp /v1)&#10;        JSONObject requestJson = new JSONObject();&#10;        JSONArray contents = new JSONArray();&#10;        JSONObject content = new JSONObject();&#10;        JSONArray parts = new JSONArray();&#10;        JSONObject part = new JSONObject();&#10;&#10;        part.put(&quot;text&quot;, prompt);&#10;        parts.put(part);&#10;        content.put(&quot;role&quot;, &quot;user&quot;);&#10;        content.put(&quot;parts&quot;, parts);&#10;        contents.put(content);&#10;        requestJson.put(&quot;contents&quot;, contents);&#10;&#10;        // generationConfig - tối ưu để tránh MAX_TOKENS&#10;        JSONObject generationConfig = new JSONObject();&#10;        generationConfig.put(&quot;maxOutputTokens&quot;, maxTokens);&#10;        generationConfig.put(&quot;temperature&quot;, 0.0);  // Giảm độ sáng tạo, output nhất quán&#10;        generationConfig.put(&quot;candidateCount&quot;, 1);&#10;        generationConfig.put(&quot;topP&quot;, 0.9);&#10;        generationConfig.put(&quot;topK&quot;, 40);&#10;        requestJson.put(&quot;generationConfig&quot;, generationConfig);&#10;&#10;        Log.d(TAG, &quot;Config: maxTokens=&quot; + maxTokens + &quot;, isRetry=&quot; + isRetry);&#10;&#10;        RequestBody body = RequestBody.create(&#10;            requestJson.toString(),&#10;            MediaType.parse(&quot;application/json&quot;)&#10;        );&#10;&#10;        Request request = new Request.Builder()&#10;                .url(GEMINI_API_URL + GEMINI_API_KEY)&#10;                .post(body)&#10;                .build();&#10;&#10;        // Retry logic cho timeout&#10;        int maxRetries = 1;&#10;        for (int attempt = 0; attempt &lt;= maxRetries; attempt++) {&#10;            try (Response response = client.newCall(request).execute()) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    String responseBody = response.body().string();&#10;                    Log.d(TAG, &quot;✅ Gemini response received (&quot; + responseBody.length() + &quot; bytes)&quot;);&#10;                    return parseGeminiResponse(responseBody, weatherData, maxTokens, isRetry);&#10;                } else {&#10;                    String errorBody = response.body() != null ? response.body().string() : &quot;No error body&quot;;&#10;                    Log.e(TAG, &quot;❌ API failed: &quot; + response.code() + &quot; - &quot; + errorBody);&#10;                    return null;&#10;                }&#10;            } catch (SocketTimeoutException e) {&#10;                if (attempt &lt; maxRetries) {&#10;                    Log.w(TAG, &quot;⏱️ Timeout, retrying in 500ms... (attempt &quot; + (attempt + 1) + &quot;)&quot;);&#10;                    Thread.sleep(500);&#10;                } else {&#10;                    Log.e(TAG, &quot;❌ Timeout after &quot; + (attempt + 1) + &quot; attempts&quot;);&#10;                    throw e;&#10;                }&#10;            }&#10;        }&#10;        return null;&#10;    }&#10;&#10;    private String createPrompt(WeatherResponse weatherData) {&#10;        double temp = weatherData.getMain().getTemp();&#10;        String condition = weatherData.getWeather().get(0).getMain();&#10;        String description = weatherData.getWeather().get(0).getDescription();&#10;        double windSpeed = weatherData.getWind().getSpeed();&#10;        int humidity = weatherData.getMain().getHumidity();&#10;&#10;        // Prompt CỰC NGẮN + bó cứng độ dài từng field để tránh MAX_TOKENS&#10;        return &quot;Return ONLY this JSON array (EXACTLY 5 items). Keep each \&quot;suggestion\&quot; ≤ 4 words, \&quot;reasoning\&quot; ≤ 10 words.\n\n&quot; +&#10;                &quot;[\n&quot; +&#10;                &quot;  {\&quot;category\&quot;:\&quot;Upper Body\&quot;,\&quot;suggestion\&quot;:\&quot;\&quot;,\&quot;reasoning\&quot;:\&quot;\&quot;,\&quot;emoji\&quot;:\&quot;\&quot;},\n&quot; +&#10;                &quot;  {\&quot;category\&quot;:\&quot;Lower Body\&quot;,\&quot;suggestion\&quot;:\&quot;\&quot;,\&quot;reasoning\&quot;:\&quot;\&quot;,\&quot;emoji\&quot;:\&quot;\&quot;},\n&quot; +&#10;                &quot;  {\&quot;category\&quot;:\&quot;Footwear\&quot;,\&quot;suggestion\&quot;:\&quot;\&quot;,\&quot;reasoning\&quot;:\&quot;\&quot;,\&quot;emoji\&quot;:\&quot;\&quot;},\n&quot; +&#10;                &quot;  {\&quot;category\&quot;:\&quot;Accessories\&quot;,\&quot;suggestion\&quot;:\&quot;\&quot;,\&quot;reasoning\&quot;:\&quot;\&quot;,\&quot;emoji\&quot;:\&quot;️\&quot;},\n&quot; +&#10;                &quot;  {\&quot;category\&quot;:\&quot;Extra Tips\&quot;,\&quot;suggestion\&quot;:\&quot;\&quot;,\&quot;reasoning\&quot;:\&quot;\&quot;,\&quot;emoji\&quot;:\&quot;✨\&quot;}\n&quot; +&#10;                &quot;]\n\n&quot; +&#10;                &quot;Context: T=&quot; + Math.round(temp) + &quot;°C; &quot; + condition + &quot;(&quot; + description + &quot;); &quot; +&#10;                &quot;Wind=&quot; + String.format(&quot;%.1f&quot;, windSpeed) + &quot; m/s; Humidity=&quot; + humidity + &quot;%.\n&quot; +&#10;                &quot;Output must be valid JSON array only.&quot;;&#10;    }&#10;&#10;    private List&lt;OutfitSuggestion&gt; parseGeminiResponse(String responseBody, WeatherResponse weatherData,&#10;                                                        int currentMaxTokens, boolean isRetry) throws Exception {&#10;        List&lt;OutfitSuggestion&gt; suggestions = new ArrayList&lt;&gt;();&#10;        try {&#10;            Log.d(TAG, &quot; Parsing Gemini response...&quot;);&#10;&#10;            JSONObject res = new JSONObject(responseBody);&#10;&#10;            // Parser chống &quot;rỗng&quot; &amp; chống MAX_TOKENS&#10;            JSONArray candidates = res.optJSONArray(&quot;candidates&quot;);&#10;            if (candidates == null || candidates.length() == 0) {&#10;                throw new IOException(&quot;No candidates in response&quot;);&#10;            }&#10;&#10;            JSONObject c0 = candidates.getJSONObject(0);&#10;            String finish = c0.optString(&quot;finishReason&quot;, &quot;&quot;);&#10;            Log.d(TAG, &quot;Finish reason: &quot; + (finish.isEmpty() ? &quot;STOP&quot; : finish));&#10;&#10;            JSONObject content = c0.optJSONObject(&quot;content&quot;);&#10;            JSONArray parts = (content != null) ? content.optJSONArray(&quot;parts&quot;) : null;&#10;&#10;            // Nếu model chưa trả text (hoặc bị cắt do MAX_TOKENS) → RETRY 1 LẦN&#10;            if (parts == null || parts.length() == 0 || &quot;MAX_TOKENS&quot;.equals(finish)) {&#10;                if (!isRetry &amp;&amp; &quot;MAX_TOKENS&quot;.equals(finish)) {&#10;                    Log.w(TAG, &quot;⚠️ MAX_TOKENS reached (&quot; + currentMaxTokens + &quot; tokens), retrying with &quot; + (currentMaxTokens + 512) + &quot; tokens...&quot;);&#10;                    // Retry 1 lần với maxOutputTokens tăng thêm 512&#10;                    return callGeminiAPIWithConfig(weatherData, currentMaxTokens + 512, true);&#10;                } else {&#10;                    throw new IOException(&quot;Empty content or MAX_TOKENS after retry&quot;);&#10;                }&#10;            }&#10;&#10;            String text = parts.getJSONObject(0).optString(&quot;text&quot;, &quot;&quot;);&#10;            if (text.isEmpty()) {&#10;                throw new IOException(&quot;Response text is empty&quot;);&#10;            }&#10;&#10;            Log.d(TAG, &quot;Extracted text (&quot; + text.length() + &quot; chars): &quot; +&#10;                  text.substring(0, Math.min(100, text.length())) + &quot;...&quot;);&#10;&#10;            // Extract JSON array - tìm first '[' đến last ']'&#10;            int startIndex = text.indexOf(&quot;[&quot;);&#10;            int endIndex = text.lastIndexOf(&quot;]&quot;) + 1;&#10;&#10;            if (startIndex &gt;= 0 &amp;&amp; endIndex &gt; startIndex) {&#10;                String jsonStr = text.substring(startIndex, endIndex);&#10;&#10;                // Parse JSON array trực tiếp&#10;                JSONArray outfits = new JSONArray(jsonStr);&#10;                Log.d(TAG, &quot; JSON array has &quot; + outfits.length() + &quot; items&quot;);&#10;&#10;                for (int i = 0; i &lt; outfits.length(); i++) {&#10;                    JSONObject obj = outfits.getJSONObject(i);&#10;&#10;                    String category = obj.optString(&quot;category&quot;, &quot;Unknown&quot;);&#10;                    String suggestion = obj.optString(&quot;suggestion&quot;, &quot;&quot;);&#10;                    String reasoning = obj.optString(&quot;reasoning&quot;, &quot;&quot;);&#10;                    String emoji = obj.optString(&quot;emoji&quot;, &quot;&quot;);&#10;&#10;                    if (!suggestion.isEmpty()) {&#10;                        suggestions.add(new OutfitSuggestion(&#10;                                category,&#10;                                suggestion,&#10;                                reasoning,&#10;                                emoji&#10;                        ));&#10;                        Log.d(TAG, &quot;  ✓ &quot; + (i+1) + &quot;. &quot; + category + &quot;: &quot; + suggestion);&#10;                    }&#10;                }&#10;&#10;                Log.d(TAG, &quot;✅ Successfully parsed &quot; + suggestions.size() + &quot; suggestions&quot;);&#10;            } else {&#10;                throw new IOException(&quot;Could not find JSON array in response text&quot;);&#10;            }&#10;        } catch (Exception e) {&#10;            Log.e(TAG, &quot;❌ Parse error: &quot; + e.getMessage());&#10;            throw new IOException(&quot;Failed to parse Gemini response: &quot; + e.getMessage());&#10;        }&#10;        return suggestions;&#10;    }&#10;&#10;    private List&lt;OutfitSuggestion&gt; getDefaultOutfitSuggestions(WeatherResponse weatherData) {&#10;        List&lt;OutfitSuggestion&gt; suggestions = new ArrayList&lt;&gt;();&#10;        double temp = weatherData.getMain().getTemp();&#10;        String condition = weatherData.getWeather().get(0).getMain().toLowerCase();&#10;        double windSpeed = weatherData.getWind().getSpeed();&#10;&#10;        // Upper Body&#10;        if (temp &lt; 10) {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Upper Body&quot;,&#10;                    &quot;Heavy jacket or winter coat&quot;,&#10;                    &quot;It's cold outside, you need warm layers&quot;,&#10;                    &quot;&quot;&#10;            ));&#10;        } else if (temp &lt; 20) {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Upper Body&quot;,&#10;                    &quot;Light jacket or sweater&quot;,&#10;                    &quot;Mild temperature, a light layer is perfect&quot;,&#10;                    &quot;&quot;&#10;            ));&#10;        } else if (temp &lt; 28) {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Upper Body&quot;,&#10;                    &quot;T-shirt or casual shirt&quot;,&#10;                    &quot;Comfortable temperature for light clothing&quot;,&#10;                    &quot;&quot;&#10;            ));&#10;        } else {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Upper Body&quot;,&#10;                    &quot;Breathable tank top or light shirt&quot;,&#10;                    &quot;It's hot, stay cool with minimal clothing&quot;,&#10;                    &quot;&quot;&#10;            ));&#10;        }&#10;&#10;        // Lower Body&#10;        if (temp &lt; 15) {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Lower Body&quot;,&#10;                    &quot;Jeans or warm pants&quot;,&#10;                    &quot;Keep your legs warm in cooler weather&quot;,&#10;                    &quot;&quot;&#10;            ));&#10;        } else if (temp &lt; 25) {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Lower Body&quot;,&#10;                    &quot;Casual pants or jeans&quot;,&#10;                    &quot;Comfortable for moderate temperatures&quot;,&#10;                    &quot;&quot;&#10;            ));&#10;        } else {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Lower Body&quot;,&#10;                    &quot;Shorts or light skirt&quot;,&#10;                    &quot;Stay cool in warm weather&quot;,&#10;                    &quot;&quot;&#10;            ));&#10;        }&#10;&#10;        // Footwear&#10;        if (condition.contains(&quot;rain&quot;) || condition.contains(&quot;drizzle&quot;)) {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Footwear&quot;,&#10;                    &quot;Waterproof boots or rain shoes&quot;,&#10;                    &quot;Keep your feet dry in wet conditions&quot;,&#10;                    &quot;&quot;&#10;            ));&#10;        } else if (temp &lt; 10) {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Footwear&quot;,&#10;                    &quot;Boots or closed-toe shoes&quot;,&#10;                    &quot;Warm footwear for cold weather&quot;,&#10;                    &quot;&quot;&#10;            ));&#10;        } else if (temp &gt; 25) {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Footwear&quot;,&#10;                    &quot;Sandals or breathable sneakers&quot;,&#10;                    &quot;Keep your feet cool and comfortable&quot;,&#10;                    &quot;&quot;&#10;            ));&#10;        } else {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Footwear&quot;,&#10;                    &quot;Casual sneakers or shoes&quot;,&#10;                    &quot;Versatile footwear for pleasant weather&quot;,&#10;                    &quot;&quot;&#10;            ));&#10;        }&#10;&#10;        // Accessories&#10;        if (condition.contains(&quot;rain&quot;)) {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Accessories&quot;,&#10;                    &quot;Umbrella and waterproof bag&quot;,&#10;                    &quot;Essential protection from rain&quot;,&#10;                    &quot;☂️&quot;&#10;            ));&#10;        } else if (condition.contains(&quot;clear&quot;) || condition.contains(&quot;sun&quot;)) {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Accessories&quot;,&#10;                    &quot;Sunglasses and hat&quot;,&#10;                    &quot;Protect yourself from the sun&quot;,&#10;                    &quot;️&quot;&#10;            ));&#10;        } else if (temp &lt; 10) {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Accessories&quot;,&#10;                    &quot;Scarf and gloves&quot;,&#10;                    &quot;Extra warmth for cold weather&quot;,&#10;                    &quot;&quot;&#10;            ));&#10;        } else if (windSpeed &gt; 5) {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Accessories&quot;,&#10;                    &quot;Light scarf or windbreaker&quot;,&#10;                    &quot;Protect against wind&quot;,&#10;                    &quot;&quot;&#10;            ));&#10;        } else {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Accessories&quot;,&#10;                    &quot;Sunglasses&quot;,&#10;                    &quot;Optional but recommended for comfort&quot;,&#10;                    &quot;️&quot;&#10;            ));&#10;        }&#10;&#10;        // Extra Tips&#10;        if (condition.contains(&quot;snow&quot;)) {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Extra Tips&quot;,&#10;                    &quot;Layer up with thermal wear&quot;,&#10;                    &quot;Multiple layers trap heat better in snow&quot;,&#10;                    &quot;❄️&quot;&#10;            ));&#10;        } else if (temp &gt; 30) {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Extra Tips&quot;,&#10;                    &quot;Stay hydrated, use sunscreen&quot;,&#10;                    &quot;Protect your skin in hot weather&quot;,&#10;                    &quot;☀️&quot;&#10;            ));&#10;        } else if (weatherData.getMain().getHumidity() &gt; 80) {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Extra Tips&quot;,&#10;                    &quot;Choose moisture-wicking fabrics&quot;,&#10;                    &quot;High humidity makes you sweat more&quot;,&#10;                    &quot;&quot;&#10;            ));&#10;        } else {&#10;            suggestions.add(new OutfitSuggestion(&#10;                    &quot;Extra Tips&quot;,&#10;                    &quot;Dress in layers for flexibility&quot;,&#10;                    &quot;Easy to adjust to temperature changes&quot;,&#10;                    &quot;✨&quot;&#10;            ));&#10;        }&#10;&#10;        return suggestions;&#10;    }&#10;}&#10;&#10;&#10;" />
              <option name="updatedContent" value="package com.example.weatherapp.utils;&#13;&#10;&#13;&#10;import android.content.Context;&#13;&#10;import android.util.Log;&#13;&#10;&#13;&#10;import com.example.weatherapp.data.models.OutfitSuggestion;&#13;&#10;import com.example.weatherapp.data.responses.WeatherResponse;&#13;&#10;&#13;&#10;import org.json.JSONArray;&#13;&#10;import org.json.JSONObject;&#13;&#10;&#13;&#10;import java.io.IOException;&#13;&#10;import java.net.SocketTimeoutException;&#13;&#10;import java.util.ArrayList;&#13;&#10;import java.util.List;&#13;&#10;import java.util.concurrent.TimeUnit;&#13;&#10;&#13;&#10;import okhttp3.MediaType;&#13;&#10;import okhttp3.OkHttpClient;&#13;&#10;import okhttp3.Request;&#13;&#10;import okhttp3.RequestBody;&#13;&#10;import okhttp3.Response;&#13;&#10;import okhttp3.logging.HttpLoggingInterceptor;&#13;&#10;&#13;&#10;public class OutfitSuggestionService {&#13;&#10;    private static final String TAG = &quot;OutfitSuggestionService&quot;;&#13;&#10;&#13;&#10;    // Google Gemini API - MIỄN PHÍ 100%!&#13;&#10;    // Lấy API key tại: https://makersuite.google.com/app/apikey&#13;&#10;    private static final String GEMINI_API_KEY = &quot;AIzaSyAPtCim4ke9C8SwsY2bXszsQotGfxE-XH4&quot;;&#13;&#10;    private static final String GEMINI_API_URL = &quot;https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=&quot;;&#13;&#10;&#13;&#10;    private final Context context;&#13;&#10;    private final OkHttpClient client;&#13;&#10;&#13;&#10;    public OutfitSuggestionService(Context context) {&#13;&#10;        this.context = context;&#13;&#10;&#13;&#10;        HttpLoggingInterceptor loggingInterceptor = new HttpLoggingInterceptor();&#13;&#10;        loggingInterceptor.setLevel(HttpLoggingInterceptor.Level.BODY);&#13;&#10;&#13;&#10;        client = new OkHttpClient.Builder()&#13;&#10;                .addInterceptor(loggingInterceptor)&#13;&#10;                .connectTimeout(20, TimeUnit.SECONDS)&#13;&#10;                .readTimeout(45, TimeUnit.SECONDS)      // ≥ 45s cho LLM&#13;&#10;                .writeTimeout(30, TimeUnit.SECONDS)&#13;&#10;                .callTimeout(60, TimeUnit.SECONDS)      // Timeout tổng&#13;&#10;                .retryOnConnectionFailure(true)&#13;&#10;                .build();&#13;&#10;    }&#13;&#10;&#13;&#10;    public interface OutfitSuggestionCallback {&#13;&#10;        void onSuccess(List&lt;OutfitSuggestion&gt; suggestions);&#13;&#10;        void onError(String error);&#13;&#10;    }&#13;&#10;&#13;&#10;    public void getOutfitSuggestions(WeatherResponse weatherData, OutfitSuggestionCallback callback) {&#13;&#10;        // Kiểm tra API key - KHÔNG dùng API nếu key là placeholder&#13;&#10;        if (GEMINI_API_KEY.isEmpty() || GEMINI_API_KEY.equals(&quot;YOUR_GEMINI_API_KEY_HERE&quot;)) {&#13;&#10;            Log.d(TAG, &quot;Using default offline suggestions - No API key&quot;);&#13;&#10;            callback.onSuccess(getDefaultOutfitSuggestions(weatherData));&#13;&#10;            return;&#13;&#10;        }&#13;&#10;&#13;&#10;        // Log để biết đang sử dụng Gemini API&#13;&#10;        Log.d(TAG, &quot;=== USING GEMINI API ===&quot;);&#13;&#10;        Log.d(TAG, &quot;Model: gemini-2.5-flash&quot;);&#13;&#10;&#13;&#10;        // Gọi Gemini API trong background thread&#13;&#10;        new Thread(() -&gt; {&#13;&#10;            try {&#13;&#10;                Log.d(TAG, &quot;Calling Gemini API...&quot;);&#13;&#10;                List&lt;OutfitSuggestion&gt; suggestions = callGeminiAPI(weatherData);&#13;&#10;&#13;&#10;                if (suggestions != null &amp;&amp; !suggestions.isEmpty()) {&#13;&#10;                    Log.d(TAG, &quot;✅ Gemini API SUCCESS - Got &quot; + suggestions.size() + &quot; suggestions&quot;);&#13;&#10;                    callback.onSuccess(suggestions);&#13;&#10;                } else {&#13;&#10;                    Log.w(TAG, &quot;⚠️ Gemini API returned empty - Using default&quot;);&#13;&#10;                    callback.onSuccess(getDefaultOutfitSuggestions(weatherData));&#13;&#10;                }&#13;&#10;            } catch (Exception e) {&#13;&#10;                Log.e(TAG, &quot;❌ Gemini API ERROR: &quot; + e.getMessage());&#13;&#10;                // Fallback to default suggestions&#13;&#10;                callback.onSuccess(getDefaultOutfitSuggestions(weatherData));&#13;&#10;            }&#13;&#10;        }).start();&#13;&#10;    }&#13;&#10;&#13;&#10;    private List&lt;OutfitSuggestion&gt; callGeminiAPI(WeatherResponse weatherData) throws Exception {&#13;&#10;        return callGeminiAPIWithConfig(weatherData, 2048, false);&#13;&#10;    }&#13;&#10;&#13;&#10;    private List&lt;OutfitSuggestion&gt; callGeminiAPIWithConfig(WeatherResponse weatherData, int maxTokens, boolean isRetry) throws Exception {&#13;&#10;        String prompt = createPrompt(weatherData);&#13;&#10;&#13;&#10;        // Payload tối giản (đúng cú pháp /v1)&#13;&#10;        JSONObject requestJson = new JSONObject();&#13;&#10;        JSONArray contents = new JSONArray();&#13;&#10;        JSONObject content = new JSONObject();&#13;&#10;        JSONArray parts = new JSONArray();&#13;&#10;        JSONObject part = new JSONObject();&#13;&#10;&#13;&#10;        part.put(&quot;text&quot;, prompt);&#13;&#10;        parts.put(part);&#13;&#10;        content.put(&quot;role&quot;, &quot;user&quot;);&#13;&#10;        content.put(&quot;parts&quot;, parts);&#13;&#10;        contents.put(content);&#13;&#10;        requestJson.put(&quot;contents&quot;, contents);&#13;&#10;&#13;&#10;        // generationConfig - tối ưu để tránh MAX_TOKENS&#13;&#10;        JSONObject generationConfig = new JSONObject();&#13;&#10;        generationConfig.put(&quot;maxOutputTokens&quot;, maxTokens);&#13;&#10;        generationConfig.put(&quot;temperature&quot;, 0.0);  // Giảm độ sáng tạo, output nhất quán&#13;&#10;        generationConfig.put(&quot;candidateCount&quot;, 1);&#13;&#10;        generationConfig.put(&quot;topP&quot;, 0.9);&#13;&#10;        generationConfig.put(&quot;topK&quot;, 40);&#13;&#10;        requestJson.put(&quot;generationConfig&quot;, generationConfig);&#13;&#10;&#13;&#10;        Log.d(TAG, &quot;Config: maxTokens=&quot; + maxTokens + &quot;, isRetry=&quot; + isRetry);&#13;&#10;&#13;&#10;        RequestBody body = RequestBody.create(&#13;&#10;            requestJson.toString(),&#13;&#10;            MediaType.parse(&quot;application/json&quot;)&#13;&#10;        );&#13;&#10;&#13;&#10;        Request request = new Request.Builder()&#13;&#10;                .url(GEMINI_API_URL + GEMINI_API_KEY)&#13;&#10;                .post(body)&#13;&#10;                .build();&#13;&#10;&#13;&#10;        // Retry logic cho timeout&#13;&#10;        int maxRetries = 1;&#13;&#10;        for (int attempt = 0; attempt &lt;= maxRetries; attempt++) {&#13;&#10;            try (Response response = client.newCall(request).execute()) {&#13;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#13;&#10;                    String responseBody = response.body().string();&#13;&#10;                    Log.d(TAG, &quot;✅ Gemini response received (&quot; + responseBody.length() + &quot; bytes)&quot;);&#13;&#10;                    return parseGeminiResponse(responseBody, weatherData, maxTokens, isRetry);&#13;&#10;                } else {&#13;&#10;                    String errorBody = response.body() != null ? response.body().string() : &quot;No error body&quot;;&#13;&#10;                    Log.e(TAG, &quot;❌ API failed: &quot; + response.code() + &quot; - &quot; + errorBody);&#13;&#10;                    return null;&#13;&#10;                }&#13;&#10;            } catch (SocketTimeoutException e) {&#13;&#10;                if (attempt &lt; maxRetries) {&#13;&#10;                    Log.w(TAG, &quot;⏱️ Timeout, retrying in 500ms... (attempt &quot; + (attempt + 1) + &quot;)&quot;);&#13;&#10;                    Thread.sleep(500);&#13;&#10;                } else {&#13;&#10;                    Log.e(TAG, &quot;❌ Timeout after &quot; + (attempt + 1) + &quot; attempts&quot;);&#13;&#10;                    throw e;&#13;&#10;                }&#13;&#10;            }&#13;&#10;        }&#13;&#10;        return null;&#13;&#10;    }&#13;&#10;&#13;&#10;    private String createPrompt(WeatherResponse weatherData) {&#13;&#10;        double temp = weatherData.getMain().getTemp();&#13;&#10;        String condition = weatherData.getWeather().get(0).getMain();&#13;&#10;        String description = weatherData.getWeather().get(0).getDescription();&#13;&#10;        double windSpeed = weatherData.getWind().getSpeed();&#13;&#10;        int humidity = weatherData.getMain().getHumidity();&#13;&#10;&#13;&#10;        // Prompt CỰC NGẮN + bó cứng độ dài từng field để tránh MAX_TOKENS&#13;&#10;        return &quot;Return ONLY this JSON array (EXACTLY 5 items). Keep each \&quot;suggestion\&quot; ≤ 4 words, \&quot;reasoning\&quot; ≤ 10 words.\n\n&quot; +&#13;&#10;                &quot;[\n&quot; +&#13;&#10;                &quot;  {\&quot;category\&quot;:\&quot;Upper Body\&quot;,\&quot;suggestion\&quot;:\&quot;\&quot;,\&quot;reasoning\&quot;:\&quot;\&quot;,\&quot;emoji\&quot;:\&quot;\&quot;},\n&quot; +&#13;&#10;                &quot;  {\&quot;category\&quot;:\&quot;Lower Body\&quot;,\&quot;suggestion\&quot;:\&quot;\&quot;,\&quot;reasoning\&quot;:\&quot;\&quot;,\&quot;emoji\&quot;:\&quot;\&quot;},\n&quot; +&#13;&#10;                &quot;  {\&quot;category\&quot;:\&quot;Footwear\&quot;,\&quot;suggestion\&quot;:\&quot;\&quot;,\&quot;reasoning\&quot;:\&quot;\&quot;,\&quot;emoji\&quot;:\&quot;\&quot;},\n&quot; +&#13;&#10;                &quot;  {\&quot;category\&quot;:\&quot;Accessories\&quot;,\&quot;suggestion\&quot;:\&quot;\&quot;,\&quot;reasoning\&quot;:\&quot;\&quot;,\&quot;emoji\&quot;:\&quot;️\&quot;},\n&quot; +&#13;&#10;                &quot;  {\&quot;category\&quot;:\&quot;Extra Tips\&quot;,\&quot;suggestion\&quot;:\&quot;\&quot;,\&quot;reasoning\&quot;:\&quot;\&quot;,\&quot;emoji\&quot;:\&quot;✨\&quot;}\n&quot; +&#13;&#10;                &quot;]\n\n&quot; +&#13;&#10;                &quot;Context: T=&quot; + Math.round(temp) + &quot;°C; &quot; + condition + &quot;(&quot; + description + &quot;); &quot; +&#13;&#10;                &quot;Wind=&quot; + String.format(&quot;%.1f&quot;, windSpeed) + &quot; m/s; Humidity=&quot; + humidity + &quot;%.\n&quot; +&#13;&#10;                &quot;Output must be valid JSON array only.&quot;;&#13;&#10;    }&#13;&#10;&#13;&#10;    private List&lt;OutfitSuggestion&gt; parseGeminiResponse(String responseBody, WeatherResponse weatherData,&#13;&#10;                                                        int currentMaxTokens, boolean isRetry) throws Exception {&#13;&#10;        List&lt;OutfitSuggestion&gt; suggestions = new ArrayList&lt;&gt;();&#13;&#10;        try {&#13;&#10;            Log.d(TAG, &quot; Parsing Gemini response...&quot;);&#13;&#10;&#13;&#10;            JSONObject res = new JSONObject(responseBody);&#13;&#10;&#13;&#10;            // Parser chống &quot;rỗng&quot; &amp; chống MAX_TOKENS&#13;&#10;            JSONArray candidates = res.optJSONArray(&quot;candidates&quot;);&#13;&#10;            if (candidates == null || candidates.length() == 0) {&#13;&#10;                throw new IOException(&quot;No candidates in response&quot;);&#13;&#10;            }&#13;&#10;&#13;&#10;            JSONObject c0 = candidates.getJSONObject(0);&#13;&#10;            String finish = c0.optString(&quot;finishReason&quot;, &quot;&quot;);&#13;&#10;            Log.d(TAG, &quot;Finish reason: &quot; + (finish.isEmpty() ? &quot;STOP&quot; : finish));&#13;&#10;&#13;&#10;            JSONObject content = c0.optJSONObject(&quot;content&quot;);&#13;&#10;            JSONArray parts = (content != null) ? content.optJSONArray(&quot;parts&quot;) : null;&#13;&#10;&#13;&#10;            // Nếu model chưa trả text (hoặc bị cắt do MAX_TOKENS) → RETRY 1 LẦN&#13;&#10;            if (parts == null || parts.length() == 0 || &quot;MAX_TOKENS&quot;.equals(finish)) {&#13;&#10;                if (!isRetry &amp;&amp; &quot;MAX_TOKENS&quot;.equals(finish)) {&#13;&#10;                    Log.w(TAG, &quot;⚠️ MAX_TOKENS reached (&quot; + currentMaxTokens + &quot; tokens), retrying with &quot; + (currentMaxTokens + 512) + &quot; tokens...&quot;);&#13;&#10;                    // Retry 1 lần với maxOutputTokens tăng thêm 512&#13;&#10;                    return callGeminiAPIWithConfig(weatherData, currentMaxTokens + 512, true);&#13;&#10;                } else {&#13;&#10;                    throw new IOException(&quot;Empty content or MAX_TOKENS after retry&quot;);&#13;&#10;                }&#13;&#10;            }&#13;&#10;&#13;&#10;            String text = parts.getJSONObject(0).optString(&quot;text&quot;, &quot;&quot;);&#13;&#10;            if (text.isEmpty()) {&#13;&#10;                throw new IOException(&quot;Response text is empty&quot;);&#13;&#10;            }&#13;&#10;&#13;&#10;            Log.d(TAG, &quot;Extracted text (&quot; + text.length() + &quot; chars): &quot; +&#13;&#10;                  text.substring(0, Math.min(100, text.length())) + &quot;...&quot;);&#13;&#10;&#13;&#10;            // Extract JSON array - tìm first '[' đến last ']'&#13;&#10;            int startIndex = text.indexOf(&quot;[&quot;);&#13;&#10;            int endIndex = text.lastIndexOf(&quot;]&quot;) + 1;&#13;&#10;&#13;&#10;            if (startIndex &gt;= 0 &amp;&amp; endIndex &gt; startIndex) {&#13;&#10;                String jsonStr = text.substring(startIndex, endIndex);&#13;&#10;&#13;&#10;                // Parse JSON array trực tiếp&#13;&#10;                JSONArray outfits = new JSONArray(jsonStr);&#13;&#10;                Log.d(TAG, &quot; JSON array has &quot; + outfits.length() + &quot; items&quot;);&#13;&#10;&#13;&#10;                for (int i = 0; i &lt; outfits.length(); i++) {&#13;&#10;                    JSONObject obj = outfits.getJSONObject(i);&#13;&#10;&#13;&#10;                    String category = obj.optString(&quot;category&quot;, &quot;Unknown&quot;);&#13;&#10;                    String suggestion = obj.optString(&quot;suggestion&quot;, &quot;&quot;);&#13;&#10;                    String reasoning = obj.optString(&quot;reasoning&quot;, &quot;&quot;);&#13;&#10;                    String emoji = obj.optString(&quot;emoji&quot;, &quot;&quot;);&#13;&#10;&#13;&#10;                    if (!suggestion.isEmpty()) {&#13;&#10;                        suggestions.add(new OutfitSuggestion(&#13;&#10;                                category,&#13;&#10;                                suggestion,&#13;&#10;                                reasoning,&#13;&#10;                                emoji&#13;&#10;                        ));&#13;&#10;                        Log.d(TAG, &quot;  ✓ &quot; + (i+1) + &quot;. &quot; + category + &quot;: &quot; + suggestion);&#13;&#10;                    }&#13;&#10;                }&#13;&#10;&#13;&#10;                Log.d(TAG, &quot;✅ Successfully parsed &quot; + suggestions.size() + &quot; suggestions&quot;);&#13;&#10;            } else {&#13;&#10;                throw new IOException(&quot;Could not find JSON array in response text&quot;);&#13;&#10;            }&#13;&#10;        } catch (Exception e) {&#13;&#10;            Log.e(TAG, &quot;❌ Parse error: &quot; + e.getMessage());&#13;&#10;            throw new IOException(&quot;Failed to parse Gemini response: &quot; + e.getMessage());&#13;&#10;        }&#13;&#10;        return suggestions;&#13;&#10;    }&#13;&#10;&#13;&#10;    private List&lt;OutfitSuggestion&gt; getDefaultOutfitSuggestions(WeatherResponse weatherData) {&#13;&#10;        List&lt;OutfitSuggestion&gt; suggestions = new ArrayList&lt;&gt;();&#13;&#10;        double temp = weatherData.getMain().getTemp();&#13;&#10;        String condition = weatherData.getWeather().get(0).getMain().toLowerCase();&#13;&#10;        double windSpeed = weatherData.getWind().getSpeed();&#13;&#10;&#13;&#10;        // Upper Body&#13;&#10;        if (temp &lt; 10) {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Upper Body&quot;,&#13;&#10;                    &quot;Heavy jacket or winter coat&quot;,&#13;&#10;                    &quot;It's cold outside, you need warm layers&quot;,&#13;&#10;                    &quot;&quot;&#13;&#10;            ));&#13;&#10;        } else if (temp &lt; 20) {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Upper Body&quot;,&#13;&#10;                    &quot;Light jacket or sweater&quot;,&#13;&#10;                    &quot;Mild temperature, a light layer is perfect&quot;,&#13;&#10;                    &quot;&quot;&#13;&#10;            ));&#13;&#10;        } else if (temp &lt; 28) {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Upper Body&quot;,&#13;&#10;                    &quot;T-shirt or casual shirt&quot;,&#13;&#10;                    &quot;Comfortable temperature for light clothing&quot;,&#13;&#10;                    &quot;&quot;&#13;&#10;            ));&#13;&#10;        } else {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Upper Body&quot;,&#13;&#10;                    &quot;Breathable tank top or light shirt&quot;,&#13;&#10;                    &quot;It's hot, stay cool with minimal clothing&quot;,&#13;&#10;                    &quot;&quot;&#13;&#10;            ));&#13;&#10;        }&#13;&#10;&#13;&#10;        // Lower Body&#13;&#10;        if (temp &lt; 15) {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Lower Body&quot;,&#13;&#10;                    &quot;Jeans or warm pants&quot;,&#13;&#10;                    &quot;Keep your legs warm in cooler weather&quot;,&#13;&#10;                    &quot;&quot;&#13;&#10;            ));&#13;&#10;        } else if (temp &lt; 25) {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Lower Body&quot;,&#13;&#10;                    &quot;Casual pants or jeans&quot;,&#13;&#10;                    &quot;Comfortable for moderate temperatures&quot;,&#13;&#10;                    &quot;&quot;&#13;&#10;            ));&#13;&#10;        } else {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Lower Body&quot;,&#13;&#10;                    &quot;Shorts or light skirt&quot;,&#13;&#10;                    &quot;Stay cool in warm weather&quot;,&#13;&#10;                    &quot;&quot;&#13;&#10;            ));&#13;&#10;        }&#13;&#10;&#13;&#10;        // Footwear&#13;&#10;        if (condition.contains(&quot;rain&quot;) || condition.contains(&quot;drizzle&quot;)) {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Footwear&quot;,&#13;&#10;                    &quot;Waterproof boots or rain shoes&quot;,&#13;&#10;                    &quot;Keep your feet dry in wet conditions&quot;,&#13;&#10;                    &quot;&quot;&#13;&#10;            ));&#13;&#10;        } else if (temp &lt; 10) {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Footwear&quot;,&#13;&#10;                    &quot;Boots or closed-toe shoes&quot;,&#13;&#10;                    &quot;Warm footwear for cold weather&quot;,&#13;&#10;                    &quot;&quot;&#13;&#10;            ));&#13;&#10;        } else if (temp &gt; 25) {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Footwear&quot;,&#13;&#10;                    &quot;Sandals or breathable sneakers&quot;,&#13;&#10;                    &quot;Keep your feet cool and comfortable&quot;,&#13;&#10;                    &quot;&quot;&#13;&#10;            ));&#13;&#10;        } else {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Footwear&quot;,&#13;&#10;                    &quot;Casual sneakers or shoes&quot;,&#13;&#10;                    &quot;Versatile footwear for pleasant weather&quot;,&#13;&#10;                    &quot;&quot;&#13;&#10;            ));&#13;&#10;        }&#13;&#10;&#13;&#10;        // Accessories&#13;&#10;        if (condition.contains(&quot;rain&quot;)) {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Accessories&quot;,&#13;&#10;                    &quot;Umbrella and waterproof bag&quot;,&#13;&#10;                    &quot;Essential protection from rain&quot;,&#13;&#10;                    &quot;☂️&quot;&#13;&#10;            ));&#13;&#10;        } else if (condition.contains(&quot;clear&quot;) || condition.contains(&quot;sun&quot;)) {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Accessories&quot;,&#13;&#10;                    &quot;Sunglasses and hat&quot;,&#13;&#10;                    &quot;Protect yourself from the sun&quot;,&#13;&#10;                    &quot;️&quot;&#13;&#10;            ));&#13;&#10;        } else if (temp &lt; 10) {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Accessories&quot;,&#13;&#10;                    &quot;Scarf and gloves&quot;,&#13;&#10;                    &quot;Extra warmth for cold weather&quot;,&#13;&#10;                    &quot;&quot;&#13;&#10;            ));&#13;&#10;        } else if (windSpeed &gt; 5) {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Accessories&quot;,&#13;&#10;                    &quot;Light scarf or windbreaker&quot;,&#13;&#10;                    &quot;Protect against wind&quot;,&#13;&#10;                    &quot;&quot;&#13;&#10;            ));&#13;&#10;        } else {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Accessories&quot;,&#13;&#10;                    &quot;Sunglasses&quot;,&#13;&#10;                    &quot;Optional but recommended for comfort&quot;,&#13;&#10;                    &quot;️&quot;&#13;&#10;            ));&#13;&#10;        }&#13;&#10;&#13;&#10;        // Extra Tips&#13;&#10;        if (condition.contains(&quot;snow&quot;)) {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Extra Tips&quot;,&#13;&#10;                    &quot;Layer up with thermal wear&quot;,&#13;&#10;                    &quot;Multiple layers trap heat better in snow&quot;,&#13;&#10;                    &quot;❄️&quot;&#13;&#10;            ));&#13;&#10;        } else if (temp &gt; 30) {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Extra Tips&quot;,&#13;&#10;                    &quot;Stay hydrated, use sunscreen&quot;,&#13;&#10;                    &quot;Protect your skin in hot weather&quot;,&#13;&#10;                    &quot;☀️&quot;&#13;&#10;            ));&#13;&#10;        } else if (weatherData.getMain().getHumidity() &gt; 80) {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Extra Tips&quot;,&#13;&#10;                    &quot;Choose moisture-wicking fabrics&quot;,&#13;&#10;                    &quot;High humidity makes you sweat more&quot;,&#13;&#10;                    &quot;&quot;&#13;&#10;            ));&#13;&#10;        } else {&#13;&#10;            suggestions.add(new OutfitSuggestion(&#13;&#10;                    &quot;Extra Tips&quot;,&#13;&#10;                    &quot;Dress in layers for flexibility&quot;,&#13;&#10;                    &quot;Easy to adjust to temperature changes&quot;,&#13;&#10;                    &quot;✨&quot;&#13;&#10;            ));&#13;&#10;        }&#13;&#10;&#13;&#10;        return suggestions;&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/widget/WeatherWidget.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/weatherapp/widget/WeatherWidget.java" />
              <option name="originalContent" value="package com.example.weatherapp.widget;&#10;&#10;import android.app.PendingIntent;&#10;import android.appwidget.AppWidgetManager;&#10;import android.appwidget.AppWidgetProvider;&#10;import android.content.Context;&#10;import android.content.Intent;&#10;import android.content.SharedPreferences;&#10;import android.widget.RemoteViews;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;/**&#10; * Weather Widget for home screen&#10; */&#10;public class WeatherWidget extends AppWidgetProvider {&#10;&#10;    private static final String API_KEY = &quot;bd5e378503939ddaee76f12ad7a97608&quot;;&#10;&#10;    static void updateAppWidget(Context context, AppWidgetManager appWidgetManager,&#10;                                int appWidgetId) {&#10;&#10;        // Get saved city from preferences&#10;        SharedPreferences prefs = context.getSharedPreferences(&quot;WeatherAppPrefs&quot;, Context.MODE_PRIVATE);&#10;        String cityName = prefs.getString(&quot;last_city&quot;, &quot;Hanoi&quot;);&#10;        String tempUnit = prefs.getString(&quot;temperature_unit&quot;, &quot;celsius&quot;);&#10;&#10;        // Construct the RemoteViews object&#10;        RemoteViews views = new RemoteViews(context.getPackageName(), R.layout.weather_widget);&#10;&#10;        // Set loading state&#10;        views.setTextViewText(R.id.widget_city_name, cityName);&#10;        views.setTextViewText(R.id.widget_temperature, &quot;Loading...&quot;);&#10;        views.setTextViewText(R.id.widget_condition, &quot;&quot;);&#10;&#10;        // Create an Intent to launch MainActivity when clicked&#10;        Intent intent = new Intent(context, MainActivity.class);&#10;        PendingIntent pendingIntent = PendingIntent.getActivity(context, 0, intent,&#10;            PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_IMMUTABLE);&#10;        views.setOnClickPendingIntent(R.id.widget_container, pendingIntent);&#10;&#10;        // Update widget immediately with loading state&#10;        appWidgetManager.updateAppWidget(appWidgetId, views);&#10;&#10;        // Fetch weather data&#10;        fetchWeatherData(context, appWidgetManager, appWidgetId, cityName, tempUnit);&#10;    }&#10;&#10;    // Public method for MainActivity to update widget with weather data&#10;    public static void updateWidget(Context context, AppWidgetManager appWidgetManager,&#10;                                   int appWidgetId, WeatherResponse weather) {&#10;        SharedPreferences prefs = context.getSharedPreferences(&quot;WeatherAppPrefs&quot;, Context.MODE_PRIVATE);&#10;        String tempUnit = prefs.getString(&quot;temperature_unit&quot;, &quot;celsius&quot;);&#10;        updateWidgetWithWeatherData(context, appWidgetManager, appWidgetId, weather, tempUnit);&#10;    }&#10;&#10;    private static void fetchWeatherData(Context context, AppWidgetManager appWidgetManager,&#10;                                        int appWidgetId, String cityName, String tempUnit) {&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#10;        String units = tempUnit.equals(&quot;celsius&quot;) ? &quot;metric&quot; : &quot;imperial&quot;;&#10;&#10;        Call&lt;WeatherResponse&gt; call = apiService.getWeatherByCity(cityName, API_KEY, units);&#10;        call.enqueue(new Callback&lt;WeatherResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;WeatherResponse&gt; call, Response&lt;WeatherResponse&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    WeatherResponse weather = response.body();&#10;                    updateWidgetWithWeatherData(context, appWidgetManager, appWidgetId, weather, tempUnit);&#10;                } else {&#10;                    updateWidgetWithError(context, appWidgetManager, appWidgetId, cityName);&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;WeatherResponse&gt; call, Throwable t) {&#10;                updateWidgetWithError(context, appWidgetManager, appWidgetId, cityName);&#10;            }&#10;        });&#10;    }&#10;&#10;    private static void updateWidgetWithWeatherData(Context context, AppWidgetManager appWidgetManager,&#10;                                                   int appWidgetId, WeatherResponse weather, String tempUnit) {&#10;        RemoteViews views = new RemoteViews(context.getPackageName(), R.layout.weather_widget);&#10;&#10;        // Update city name&#10;        views.setTextViewText(R.id.widget_city_name, weather.getName());&#10;&#10;        // Update temperature&#10;        double temp = weather.getMain().getTemp();&#10;        String tempSymbol = tempUnit.equals(&quot;celsius&quot;) ? &quot;°&quot; : &quot;°F&quot;;&#10;        views.setTextViewText(R.id.widget_temperature, String.format(&quot;%.0f%s&quot;, temp, tempSymbol));&#10;&#10;        // Update weather condition&#10;        if (weather.getWeather() != null &amp;&amp; !weather.getWeather().isEmpty()) {&#10;            String condition = weather.getWeather().get(0).getMain();&#10;            views.setTextViewText(R.id.widget_condition, condition);&#10;&#10;            // Set weather icon&#10;            int iconRes = getWeatherIconResource(condition.toLowerCase());&#10;            views.setImageViewResource(R.id.widget_icon, iconRes);&#10;        }&#10;&#10;        // Update temperature range&#10;        double tempMax = weather.getMain().getTempMax();&#10;        double tempMin = weather.getMain().getTempMin();&#10;        views.setTextViewText(R.id.widget_temp_range,&#10;            String.format(&quot;H:%.0f%s  L:%.0f%s&quot;, tempMax, tempSymbol, tempMin, tempSymbol));&#10;&#10;        // Create an Intent to launch MainActivity when clicked&#10;        Intent intent = new Intent(context, MainActivity.class);&#10;        PendingIntent pendingIntent = PendingIntent.getActivity(context, 0, intent,&#10;            PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_IMMUTABLE);&#10;        views.setOnClickPendingIntent(R.id.widget_container, pendingIntent);&#10;&#10;        // Instruct the widget manager to update the widget&#10;        appWidgetManager.updateAppWidget(appWidgetId, views);&#10;    }&#10;&#10;    private static void updateWidgetWithError(Context context, AppWidgetManager appWidgetManager,&#10;                                             int appWidgetId, String cityName) {&#10;        RemoteViews views = new RemoteViews(context.getPackageName(), R.layout.weather_widget);&#10;        views.setTextViewText(R.id.widget_city_name, cityName);&#10;        views.setTextViewText(R.id.widget_temperature, &quot;N/A&quot;);&#10;        views.setTextViewText(R.id.widget_condition, &quot;Unable to load&quot;);&#10;        views.setTextViewText(R.id.widget_temp_range, &quot;&quot;);&#10;&#10;        // Create an Intent to launch MainActivity when clicked&#10;        Intent intent = new Intent(context, MainActivity.class);&#10;        PendingIntent pendingIntent = PendingIntent.getActivity(context, 0, intent,&#10;            PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_IMMUTABLE);&#10;        views.setOnClickPendingIntent(R.id.widget_container, pendingIntent);&#10;&#10;        appWidgetManager.updateAppWidget(appWidgetId, views);&#10;    }&#10;&#10;    private static int getWeatherIconResource(String weatherCondition) {&#10;        switch (weatherCondition) {&#10;            case &quot;clear&quot;:&#10;                return R.drawable.sun_cloud_little_rain;&#10;            case &quot;clouds&quot;:&#10;                return R.drawable.moon_cloud_mid_rain;&#10;            case &quot;rain&quot;:&#10;                return R.drawable.big_rain_drops;&#10;            case &quot;drizzle&quot;:&#10;                return R.drawable.sun_cloud_mid_rain;&#10;            case &quot;thunderstorm&quot;:&#10;                return R.drawable.cloud_3_zap;&#10;            case &quot;snow&quot;:&#10;                return R.drawable.big_snow;&#10;            case &quot;mist&quot;:&#10;            case &quot;fog&quot;:&#10;            case &quot;haze&quot;:&#10;                return R.drawable.moon_cloud_fast_wind;&#10;            default:&#10;                return R.drawable.sun_cloud_angled_rain;&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onUpdate(Context context, AppWidgetManager appWidgetManager, int[] appWidgetIds) {&#10;        // There may be multiple widgets active, so update all of them&#10;        for (int appWidgetId : appWidgetIds) {&#10;            updateAppWidget(context, appWidgetManager, appWidgetId);&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onEnabled(Context context) {&#10;        // Enter relevant functionality for when the first widget is created&#10;    }&#10;&#10;    @Override&#10;    public void onDisabled(Context context) {&#10;        // Enter relevant functionality for when the last widget is disabled&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.weatherapp.widget;&#13;&#10;&#13;&#10;import android.app.PendingIntent;&#13;&#10;import android.appwidget.AppWidgetManager;&#13;&#10;import android.appwidget.AppWidgetProvider;&#13;&#10;import android.content.Context;&#13;&#10;import android.content.Intent;&#13;&#10;import android.content.SharedPreferences;&#13;&#10;import android.widget.RemoteViews;&#13;&#10;&#13;&#10;import com.example.weatherapp.R;&#13;&#10;import com.example.weatherapp.data.api.RetrofitClient;&#13;&#10;import com.example.weatherapp.data.api.WeatherApiService;&#13;&#10;import com.example.weatherapp.data.responses.WeatherResponse;&#13;&#10;import com.example.weatherapp.ui.activities.MainActivity;&#13;&#10;&#13;&#10;import retrofit2.Call;&#13;&#10;import retrofit2.Callback;&#13;&#10;import retrofit2.Response;&#13;&#10;&#13;&#10;/**&#13;&#10; * Weather Widget for home screen&#13;&#10; */&#13;&#10;public class WeatherWidget extends AppWidgetProvider {&#13;&#10;&#13;&#10;    private static final String API_KEY = &quot;bd5e378503939ddaee76f12ad7a97608&quot;;&#13;&#10;&#13;&#10;    static void updateAppWidget(Context context, AppWidgetManager appWidgetManager,&#13;&#10;                                int appWidgetId) {&#13;&#10;&#13;&#10;        // Get saved city from preferences&#13;&#10;        SharedPreferences prefs = context.getSharedPreferences(&quot;WeatherAppPrefs&quot;, Context.MODE_PRIVATE);&#13;&#10;        String cityName = prefs.getString(&quot;last_city&quot;, &quot;Hanoi&quot;);&#13;&#10;        String tempUnit = prefs.getString(&quot;temperature_unit&quot;, &quot;celsius&quot;);&#13;&#10;&#13;&#10;        // Construct the RemoteViews object&#13;&#10;        RemoteViews views = new RemoteViews(context.getPackageName(), R.layout.weather_widget);&#13;&#10;&#13;&#10;        // Set loading state&#13;&#10;        views.setTextViewText(R.id.widget_city_name, cityName);&#13;&#10;        views.setTextViewText(R.id.widget_temperature, &quot;Loading...&quot;);&#13;&#10;        views.setTextViewText(R.id.widget_condition, &quot;&quot;);&#13;&#10;&#13;&#10;        // Create an Intent to launch MainActivity when clicked&#13;&#10;        Intent intent = new Intent(context, MainActivity.class);&#13;&#10;        PendingIntent pendingIntent = PendingIntent.getActivity(context, 0, intent,&#13;&#10;            PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_IMMUTABLE);&#13;&#10;        views.setOnClickPendingIntent(R.id.widget_container, pendingIntent);&#13;&#10;&#13;&#10;        // Update widget immediately with loading state&#13;&#10;        appWidgetManager.updateAppWidget(appWidgetId, views);&#13;&#10;&#13;&#10;        // Fetch weather data&#13;&#10;        fetchWeatherData(context, appWidgetManager, appWidgetId, cityName, tempUnit);&#13;&#10;    }&#13;&#10;&#13;&#10;    // Public method for MainActivity to update widget with weather data&#13;&#10;    public static void updateWidget(Context context, AppWidgetManager appWidgetManager,&#13;&#10;                                   int appWidgetId, WeatherResponse weather) {&#13;&#10;        SharedPreferences prefs = context.getSharedPreferences(&quot;WeatherAppPrefs&quot;, Context.MODE_PRIVATE);&#13;&#10;        String tempUnit = prefs.getString(&quot;temperature_unit&quot;, &quot;celsius&quot;);&#13;&#10;        updateWidgetWithWeatherData(context, appWidgetManager, appWidgetId, weather, tempUnit);&#13;&#10;    }&#13;&#10;&#13;&#10;    private static void fetchWeatherData(Context context, AppWidgetManager appWidgetManager,&#13;&#10;                                        int appWidgetId, String cityName, String tempUnit) {&#13;&#10;        WeatherApiService apiService = RetrofitClient.getInstance().getWeatherApi();&#13;&#10;        String units = tempUnit.equals(&quot;celsius&quot;) ? &quot;metric&quot; : &quot;imperial&quot;;&#13;&#10;&#13;&#10;        Call&lt;WeatherResponse&gt; call = apiService.getWeatherByCity(cityName, API_KEY, units);&#13;&#10;        call.enqueue(new Callback&lt;WeatherResponse&gt;() {&#13;&#10;            @Override&#13;&#10;            public void onResponse(Call&lt;WeatherResponse&gt; call, Response&lt;WeatherResponse&gt; response) {&#13;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#13;&#10;                    WeatherResponse weather = response.body();&#13;&#10;                    updateWidgetWithWeatherData(context, appWidgetManager, appWidgetId, weather, tempUnit);&#13;&#10;                } else {&#13;&#10;                    updateWidgetWithError(context, appWidgetManager, appWidgetId, cityName);&#13;&#10;                }&#13;&#10;            }&#13;&#10;&#13;&#10;            @Override&#13;&#10;            public void onFailure(Call&lt;WeatherResponse&gt; call, Throwable t) {&#13;&#10;                updateWidgetWithError(context, appWidgetManager, appWidgetId, cityName);&#13;&#10;            }&#13;&#10;        });&#13;&#10;    }&#13;&#10;&#13;&#10;    private static void updateWidgetWithWeatherData(Context context, AppWidgetManager appWidgetManager,&#13;&#10;                                                   int appWidgetId, WeatherResponse weather, String tempUnit) {&#13;&#10;        RemoteViews views = new RemoteViews(context.getPackageName(), R.layout.weather_widget);&#13;&#10;&#13;&#10;        // Update city name&#13;&#10;        views.setTextViewText(R.id.widget_city_name, weather.getName());&#13;&#10;&#13;&#10;        // Update temperature&#13;&#10;        double temp = weather.getMain().getTemp();&#13;&#10;        String tempSymbol = tempUnit.equals(&quot;celsius&quot;) ? &quot;°&quot; : &quot;°F&quot;;&#13;&#10;        views.setTextViewText(R.id.widget_temperature, String.format(&quot;%.0f%s&quot;, temp, tempSymbol));&#13;&#10;&#13;&#10;        // Update weather condition&#13;&#10;        if (weather.getWeather() != null &amp;&amp; !weather.getWeather().isEmpty()) {&#13;&#10;            String condition = weather.getWeather().get(0).getMain();&#13;&#10;            views.setTextViewText(R.id.widget_condition, condition);&#13;&#10;&#13;&#10;            // Set weather icon&#13;&#10;            int iconRes = getWeatherIconResource(condition.toLowerCase());&#13;&#10;            views.setImageViewResource(R.id.widget_icon, iconRes);&#13;&#10;        }&#13;&#10;&#13;&#10;        // Update temperature range&#13;&#10;        double tempMax = weather.getMain().getTempMax();&#13;&#10;        double tempMin = weather.getMain().getTempMin();&#13;&#10;        views.setTextViewText(R.id.widget_temp_range,&#13;&#10;            String.format(&quot;H:%.0f%s  L:%.0f%s&quot;, tempMax, tempSymbol, tempMin, tempSymbol));&#13;&#10;&#13;&#10;        // Create an Intent to launch MainActivity when clicked&#13;&#10;        Intent intent = new Intent(context, MainActivity.class);&#13;&#10;        PendingIntent pendingIntent = PendingIntent.getActivity(context, 0, intent,&#13;&#10;            PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_IMMUTABLE);&#13;&#10;        views.setOnClickPendingIntent(R.id.widget_container, pendingIntent);&#13;&#10;&#13;&#10;        // Instruct the widget manager to update the widget&#13;&#10;        appWidgetManager.updateAppWidget(appWidgetId, views);&#13;&#10;    }&#13;&#10;&#13;&#10;    private static void updateWidgetWithError(Context context, AppWidgetManager appWidgetManager,&#13;&#10;                                             int appWidgetId, String cityName) {&#13;&#10;        RemoteViews views = new RemoteViews(context.getPackageName(), R.layout.weather_widget);&#13;&#10;        views.setTextViewText(R.id.widget_city_name, cityName);&#13;&#10;        views.setTextViewText(R.id.widget_temperature, &quot;N/A&quot;);&#13;&#10;        views.setTextViewText(R.id.widget_condition, &quot;Unable to load&quot;);&#13;&#10;        views.setTextViewText(R.id.widget_temp_range, &quot;&quot;);&#13;&#10;&#13;&#10;        // Create an Intent to launch MainActivity when clicked&#13;&#10;        Intent intent = new Intent(context, MainActivity.class);&#13;&#10;        PendingIntent pendingIntent = PendingIntent.getActivity(context, 0, intent,&#13;&#10;            PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_IMMUTABLE);&#13;&#10;        views.setOnClickPendingIntent(R.id.widget_container, pendingIntent);&#13;&#10;&#13;&#10;        appWidgetManager.updateAppWidget(appWidgetId, views);&#13;&#10;    }&#13;&#10;&#13;&#10;    private static int getWeatherIconResource(String weatherCondition) {&#13;&#10;        switch (weatherCondition) {&#13;&#10;            case &quot;clear&quot;:&#13;&#10;                return R.drawable.sun_cloud_little_rain;&#13;&#10;            case &quot;clouds&quot;:&#13;&#10;                return R.drawable.moon_cloud_mid_rain;&#13;&#10;            case &quot;rain&quot;:&#13;&#10;                return R.drawable.big_rain_drops;&#13;&#10;            case &quot;drizzle&quot;:&#13;&#10;                return R.drawable.sun_cloud_mid_rain;&#13;&#10;            case &quot;thunderstorm&quot;:&#13;&#10;                return R.drawable.cloud_3_zap;&#13;&#10;            case &quot;snow&quot;:&#13;&#10;                return R.drawable.big_snow;&#13;&#10;            case &quot;mist&quot;:&#13;&#10;            case &quot;fog&quot;:&#13;&#10;            case &quot;haze&quot;:&#13;&#10;                return R.drawable.moon_cloud_fast_wind;&#13;&#10;            default:&#13;&#10;                return R.drawable.sun_cloud_angled_rain;&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    @Override&#13;&#10;    public void onUpdate(Context context, AppWidgetManager appWidgetManager, int[] appWidgetIds) {&#13;&#10;        // There may be multiple widgets active, so update all of them&#13;&#10;        for (int appWidgetId : appWidgetIds) {&#13;&#10;            updateAppWidget(context, appWidgetManager, appWidgetId);&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    @Override&#13;&#10;    public void onEnabled(Context context) {&#13;&#10;        // Enter relevant functionality for when the first widget is created&#13;&#10;    }&#13;&#10;&#13;&#10;    @Override&#13;&#10;    public void onDisabled(Context context) {&#13;&#10;        // Enter relevant functionality for when the last widget is disabled&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/bg_clear_night_new.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/bg_clear_night_new.xml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;&#10;    &lt;gradient&#10;        android:type=&quot;linear&quot;&#10;        android:angle=&quot;135&quot;&#10;        android:startColor=&quot;#0F2027&quot;&#10;        android:centerColor=&quot;#203A43&quot;&#10;        android:endColor=&quot;#2C5364&quot; /&gt;&#10;&lt;/shape&gt;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;&#10;    &lt;gradient&#10;        android:type=&quot;linear&quot;&#10;        android:angle=&quot;135&quot;&#10;        android:startColor=&quot;#0F2027&quot;&#10;        android:centerColor=&quot;#203A43&quot;&#10;        android:endColor=&quot;#2C5364&quot; /&gt;&#10;&lt;/shape&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/big_rain_drops.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/big_rain_drops.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;bitmap xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:src=&quot;@drawable/big_rain_drops&quot; /&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/big_snow.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/big_snow.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;bitmap xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:src=&quot;@drawable/big_snow&quot; /&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/cloud_3_zap.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/cloud_3_zap.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;bitmap xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:src=&quot;@drawable/cloud_3_zap&quot; /&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/moon_cloud_fast_wind.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/moon_cloud_fast_wind.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;bitmap xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:src=&quot;@drawable/moon_cloud_fast_wind&quot; /&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/moon_cloud_mid_rain.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/moon_cloud_mid_rain.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;bitmap xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:src=&quot;@drawable/moon_cloud_mid_rain&quot; /&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/sun_cloud_angled_rain.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/sun_cloud_angled_rain.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;bitmap xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:src=&quot;@drawable/sun_cloud_angled_rain&quot; /&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/sun_cloud_little_rain.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/sun_cloud_little_rain.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;bitmap xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:src=&quot;@drawable/sun_cloud_little_rain&quot; /&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/sun_cloud_mid_rain.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/sun_cloud_mid_rain.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;bitmap xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:src=&quot;@drawable/sun_cloud_mid_rain&quot; /&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/tornado.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/tornado.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;bitmap xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:src=&quot;@drawable/tornado&quot; /&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/cleanup_and_commit.ps1">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/cleanup_and_commit.ps1" />
              <option name="updatedContent" value="# PowerShell Script to cleanup old .md files and commit to Git&#10;Write-Host &quot;Starting cleanup and Git commit process...&quot; -ForegroundColor Green&#10;&#10;# Change to project directory&#10;Set-Location &quot;C:\Users\DELL\AndroidStudioProjects\WeatherApp&quot;&#10;&#10;# Delete old .md files (keep README.md)&#10;Write-Host &quot;`nDeleting old documentation files...&quot; -ForegroundColor Yellow&#10;$filesToDelete = @(&#10;    &quot;WEATHER_CARDS_BEAUTIFICATION.md&quot;,&#10;    &quot;SIMPLIFIED_WEATHER_CARDS.md&quot;,&#10;    &quot;SETTINGS_PREMIUM_REFINEMENTS.md&quot;,&#10;    &quot;REFACTOR_GUIDE.md&quot;,&#10;    &quot;PREMIUM_LEVEL_IMPROVEMENTS.md&quot;,&#10;    &quot;OUTFIT_SUGGESTION_GUIDE.md&quot;,&#10;    &quot;LAYOUT_SPECIFICATIONS.md&quot;,&#10;    &quot;GLASSMORPHISM_IMPLEMENTATION.md&quot;,&#10;    &quot;DYNAMIC_BACKGROUND_IMPLEMENTATION.md&quot;,&#10;    &quot;DESIGN_SYSTEM.md&quot;,&#10;    &quot;DASHBOARD_AND_ANIMATIONS.md&quot;,&#10;    &quot;BUILD_FIX_SUMMARY.md&quot;,&#10;    &quot;VIETNAMESE_ONLY_UPDATE.md&quot;,&#10;    &quot;REFINEMENTS_COMPLETED.md&quot;,&#10;    &quot;TOP_BAR_IMPLEMENTATION.md&quot;&#10;)&#10;&#10;foreach ($file in $filesToDelete) {&#10;    if (Test-Path $file) {&#10;        Remove-Item $file -Force&#10;        Write-Host &quot;Deleted: $file&quot; -ForegroundColor Gray&#10;    }&#10;}&#10;&#10;# Delete the refactor script as it's no longer needed&#10;if (Test-Path &quot;refactor_project.ps1&quot;) {&#10;    Remove-Item &quot;refactor_project.ps1&quot; -Force&#10;    Write-Host &quot;Deleted: refactor_project.ps1&quot; -ForegroundColor Gray&#10;}&#10;&#10;Write-Host &quot;`n✓ Cleanup complete!&quot; -ForegroundColor Green&#10;&#10;# Git operations&#10;Write-Host &quot;`nInitializing Git repository...&quot; -ForegroundColor Yellow&#10;&#10;# Check if Git is initialized&#10;if (!(Test-Path &quot;.git&quot;)) {&#10;    git init&#10;    Write-Host &quot;Git repository initialized&quot; -ForegroundColor Cyan&#10;} else {&#10;    Write-Host &quot;Git repository already exists&quot; -ForegroundColor Cyan&#10;}&#10;&#10;# Create .gitignore if it doesn't exist&#10;if (!(Test-Path &quot;.gitignore&quot;)) {&#10;    Write-Host &quot;Creating .gitignore...&quot; -ForegroundColor Yellow&#10;    @&quot;&#10;# Built application files&#10;*.apk&#10;*.ap_&#10;*.aab&#10;&#10;# Files for the ART/Dalvik VM&#10;*.dex&#10;&#10;# Java class files&#10;*.class&#10;&#10;# Generated files&#10;bin/&#10;gen/&#10;out/&#10;build/&#10;&#10;# Gradle files&#10;.gradle/&#10;build/&#10;&#10;# Local configuration file (sdk path, etc)&#10;local.properties&#10;&#10;# Android Studio generated files and folders&#10;captures/&#10;.externalNativeBuild/&#10;.cxx/&#10;*.iml&#10;.idea/&#10;*.hprof&#10;&#10;# Keystore files&#10;*.jks&#10;*.keystore&#10;&#10;# Google Services (e.g. APIs or Firebase)&#10;google-services.json&#10;&#10;# Android Profiling&#10;*.hprof&#10;&#10;# API Keys (security)&#10;**/apikeys.properties&#10;**/secrets.properties&#10;&#10;# OS-specific files&#10;.DS_Store&#10;Thumbs.db&#10;&quot;@ | Out-File -FilePath &quot;.gitignore&quot; -Encoding UTF8&#10;    Write-Host &quot;.gitignore created&quot; -ForegroundColor Cyan&#10;}&#10;&#10;# Add remote if not exists&#10;Write-Host &quot;`nConfiguring remote repository...&quot; -ForegroundColor Yellow&#10;$remoteExists = git remote -v | Select-String &quot;origin&quot;&#10;if (!$remoteExists) {&#10;    git remote add origin https://github.com/nichikei/weather-app.git&#10;    Write-Host &quot;Remote 'origin' added&quot; -ForegroundColor Cyan&#10;} else {&#10;    Write-Host &quot;Remote 'origin' already exists&quot; -ForegroundColor Cyan&#10;}&#10;&#10;# Stage all files&#10;Write-Host &quot;`nStaging files...&quot; -ForegroundColor Yellow&#10;git add .&#10;Write-Host &quot;All files staged&quot; -ForegroundColor Cyan&#10;&#10;# Commit&#10;Write-Host &quot;`nCommitting changes...&quot; -ForegroundColor Yellow&#10;git commit -m &quot;Refactor: Reorganize project structure with clean architecture&#10;&#10;- Restructured packages into ui/, data/, utils/, notification/, widget/&#10;- Moved activities to ui/activities/&#10;- Moved adapters to ui/adapters/&#10;- Organized data layer into models/, api/, responses/&#10;- Updated all package declarations and imports&#10;- Cleaned up old documentation files&#10;- Created new comprehensive README.md in Vietnamese&quot;&#10;&#10;Write-Host &quot;✓ Changes committed!&quot; -ForegroundColor Green&#10;&#10;# Push to GitHub&#10;Write-Host &quot;`nPushing to GitHub...&quot; -ForegroundColor Yellow&#10;Write-Host &quot;Note: You may need to authenticate with GitHub&quot; -ForegroundColor Cyan&#10;&#10;# Try to push&#10;$pushResult = git push -u origin main 2&gt;&amp;1&#10;if ($LASTEXITCODE -ne 0) {&#10;    # If main branch doesn't exist, try master&#10;    Write-Host &quot;Trying 'master' branch...&quot; -ForegroundColor Yellow&#10;    git branch -M main&#10;    git push -u origin main 2&gt;&amp;1&#10;}&#10;&#10;if ($LASTEXITCODE -eq 0) {&#10;    Write-Host &quot;`n✓ Successfully pushed to GitHub!&quot; -ForegroundColor Green&#10;} else {&#10;    Write-Host &quot;`n⚠ Push failed. You may need to:&quot; -ForegroundColor Red&#10;    Write-Host &quot;  1. Authenticate with GitHub (gh auth login)&quot; -ForegroundColor White&#10;    Write-Host &quot;  2. Or manually push: git push -u origin main&quot; -ForegroundColor White&#10;}&#10;&#10;Write-Host &quot;`n=== Process Complete ===&quot; -ForegroundColor Green&#10;Write-Host &quot;Your project is now:&quot; -ForegroundColor White&#10;Write-Host &quot;  ✓ Refactored with clean architecture&quot; -ForegroundColor Cyan&#10;Write-Host &quot;  ✓ Cleaned up unnecessary files&quot; -ForegroundColor Cyan&#10;Write-Host &quot;  ✓ Has a professional README.md&quot; -ForegroundColor Cyan&#10;Write-Host &quot;  ✓ Ready to push to GitHub&quot; -ForegroundColor Cyan&#10;Write-Host &quot;`nRepository: https://github.com/nichikei/weather-app&quot; -ForegroundColor Yellow&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/fix_all_bom.ps1">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/fix_all_bom.ps1" />
              <option name="updatedContent" value="# PowerShell Script to remove BOM from ALL Java files&#10;$ErrorActionPreference = &quot;Stop&quot;&#10;&#10;Write-Host &quot;Fixing BOM encoding for ALL Java files...&quot; -ForegroundColor Green&#10;&#10;$javaFiles = Get-ChildItem -Path &quot;app\src\main\java&quot; -Filter &quot;*.java&quot; -Recurse&#10;&#10;$fixed = 0&#10;$skipped = 0&#10;&#10;foreach ($file in $javaFiles) {&#10;    try {&#10;        # Read file as bytes to detect BOM&#10;        $bytes = [System.IO.File]::ReadAllBytes($file.FullName)&#10;        &#10;        # Check if file starts with UTF-8 BOM (EF BB BF)&#10;        if ($bytes.Length -ge 3 -and $bytes[0] -eq 0xEF -and $bytes[1] -eq 0xBB -and $bytes[2] -eq 0xBF) {&#10;            # File has BOM, read and rewrite without BOM&#10;            $content = [System.IO.File]::ReadAllText($file.FullName, [System.Text.Encoding]::UTF8)&#10;            &#10;            # Remove BOM if present in string&#10;            if ($content[0] -eq [char]0xFEFF) {&#10;                $content = $content.Substring(1)&#10;            }&#10;            &#10;            # Write without BOM&#10;            $utf8NoBom = New-Object System.Text.UTF8Encoding $false&#10;            [System.IO.File]::WriteAllText($file.FullName, $content, $utf8NoBom)&#10;            &#10;            Write-Host &quot;Fixed: $($file.FullName.Replace($PWD.Path + '\', ''))&quot; -ForegroundColor Green&#10;            $fixed++&#10;        } else {&#10;            $skipped++&#10;        }&#10;    }&#10;    catch {&#10;        Write-Host &quot;Error: $($file.Name) - $($_.Exception.Message)&quot; -ForegroundColor Red&#10;    }&#10;}&#10;&#10;Write-Host &quot;`n=== Summary ===&quot; -ForegroundColor Cyan&#10;Write-Host &quot;Fixed: $fixed files&quot; -ForegroundColor Green&#10;Write-Host &quot;Skipped (no BOM): $skipped files&quot; -ForegroundColor Yellow&#10;&#10;Write-Host &quot;`nDone! Now rebuild your project:&quot; -ForegroundColor Yellow&#10;Write-Host &quot;  Build &gt; Clean Project&quot; -ForegroundColor White&#10;Write-Host &quot;  Build &gt; Rebuild Project&quot; -ForegroundColor White&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/fix_bom_encoding.ps1">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/fix_bom_encoding.ps1" />
              <option name="originalContent" value="# PowerShell Script to fix BOM encoding issues&#10;# This script reads files and rewrites them without BOM&#10;&#10;$ErrorActionPreference = &quot;Stop&quot;&#10;$baseDir = &quot;C:\Users\DELL\AndroidStudioProjects\WeatherApp\app\src\main\java\com\example\weatherapp&quot;&#10;&#10;Write-Host &quot;Fixing UTF-8 BOM encoding issues...&quot; -ForegroundColor Green&#10;&#10;# List of files to fix&#10;$filesToFix = @(&#10;    &quot;data\api\OpenAIService.java&quot;,&#10;    &quot;data\api\RetrofitClient.java&quot;,&#10;    &quot;data\api\WeatherApiService.java&quot;,&#10;    &quot;data\models\CityWeather.java&quot;,&#10;    &quot;data\models\FavoriteCity.java&quot;,&#10;    &quot;data\models\HourlyForecast.java&quot;,&#10;    &quot;data\models\OutfitSuggestion.java&quot;,&#10;    &quot;data\models\WeatherAlert.java&quot;,&#10;    &quot;data\models\WeeklyForecast.java&quot;,&#10;    &quot;data\responses\AirQualityResponse.java&quot;,&#10;    &quot;data\responses\HourlyForecastResponse.java&quot;,&#10;    &quot;data\responses\OpenAIRequest.java&quot;,&#10;    &quot;data\responses\OpenAIResponse.java&quot;,&#10;    &quot;data\responses\UVIndexResponse.java&quot;,&#10;    &quot;data\responses\WeatherAlertsResponse.java&quot;,&#10;    &quot;data\responses\WeatherResponse.java&quot;,&#10;    &quot;notification\NotificationReceiver.java&quot;,&#10;    &quot;notification\WeatherNotificationManager.java&quot;,&#10;    &quot;notification\WeatherNotificationWorker.java&quot;,&#10;    &quot;ui\activities\ChartsActivity.java&quot;,&#10;    &quot;ui\activities\FavoriteCitiesActivity.java&quot;,&#10;    &quot;ui\activities\MainActivity.java&quot;,&#10;    &quot;ui\activities\OutfitSuggestionActivity.java&quot;,&#10;    &quot;ui\activities\SearchActivity.java&quot;,&#10;    &quot;ui\activities\SettingsActivity.java&quot;,&#10;    &quot;ui\activities\WeatherDetailsActivity.java&quot;,&#10;    &quot;ui\adapters\CityWeatherAdapter.java&quot;,&#10;    &quot;ui\adapters\OutfitSuggestionAdapter.java&quot;,&#10;    &quot;utils\BlurHelper.java&quot;,&#10;    &quot;utils\FavoriteCitiesManager.java&quot;,&#10;    &quot;utils\LocaleHelper.java&quot;,&#10;    &quot;utils\OutfitSuggestionService.java&quot;,&#10;    &quot;widget\WeatherWidget.java&quot;&#10;)&#10;&#10;$fixed = 0&#10;$failed = 0&#10;&#10;foreach ($file in $filesToFix) {&#10;    $fullPath = Join-Path $baseDir $file&#10;    &#10;    if (Test-Path $fullPath) {&#10;        try {&#10;            # Read content as UTF-8 (which includes BOM if present)&#10;            $content = Get-Content $fullPath -Raw -Encoding UTF8&#10;            &#10;            # Remove BOM character if present&#10;            if ($content[0] -eq [char]0xFEFF) {&#10;                $content = $content.Substring(1)&#10;            }&#10;            &#10;            # Write back without BOM&#10;            $utf8NoBom = New-Object System.Text.UTF8Encoding $false&#10;            [System.IO.File]::WriteAllText($fullPath, $content, $utf8NoBom)&#10;            &#10;            Write-Host &quot;Fixed: $file&quot; -ForegroundColor Green&#10;            $fixed++&#10;        }&#10;        catch {&#10;            Write-Host &quot;Failed: $file - $($_.Exception.Message)&quot; -ForegroundColor Red&#10;            $failed++&#10;        }&#10;    }&#10;    else {&#10;        Write-Host &quot;Not found: $file&quot; -ForegroundColor Yellow&#10;    }&#10;}&#10;&#10;Write-Host &quot;`n=== Summary ===&quot; -ForegroundColor Cyan&#10;Write-Host &quot;Fixed: $fixed files&quot; -ForegroundColor Green&#10;if ($failed -gt 0) {&#10;    Write-Host &quot;Failed: $failed files&quot; -ForegroundColor Red&#10;}&#10;&#10;Write-Host &quot;`nDone! Now rebuild your project in Android Studio:&quot; -ForegroundColor Yellow&#10;Write-Host &quot;  Build &gt; Clean Project&quot; -ForegroundColor White&#10;Write-Host &quot;  Build &gt; Rebuild Project&quot; -ForegroundColor White&#10;" />
              <option name="updatedContent" value="# PowerShell Script to fix BOM encoding issues&#10;# This script reads files and rewrites them without BOM&#10;&#10;$ErrorActionPreference = &quot;Stop&quot;&#10;$baseDir = &quot;C:\Users\DELL\AndroidStudioProjects\WeatherApp\app\src\main\java\com\example\weatherapp&quot;&#10;&#10;Write-Host &quot;Fixing UTF-8 BOM encoding issues...&quot; -ForegroundColor Green&#10;&#10;# List of files to fix&#10;$filesToFix = @(&#10;    &quot;data\api\OpenAIService.java&quot;,&#10;    &quot;data\api\RetrofitClient.java&quot;,&#10;    &quot;data\api\WeatherApiService.java&quot;,&#10;    &quot;data\models\CityWeather.java&quot;,&#10;    &quot;data\models\FavoriteCity.java&quot;,&#10;    &quot;data\models\HourlyForecast.java&quot;,&#10;    &quot;data\models\OutfitSuggestion.java&quot;,&#10;    &quot;data\models\WeatherAlert.java&quot;,&#10;    &quot;data\models\WeeklyForecast.java&quot;,&#10;    &quot;data\responses\AirQualityResponse.java&quot;,&#10;    &quot;data\responses\HourlyForecastResponse.java&quot;,&#10;    &quot;data\responses\OpenAIRequest.java&quot;,&#10;    &quot;data\responses\OpenAIResponse.java&quot;,&#10;    &quot;data\responses\UVIndexResponse.java&quot;,&#10;    &quot;data\responses\WeatherAlertsResponse.java&quot;,&#10;    &quot;data\responses\WeatherResponse.java&quot;,&#10;    &quot;notification\NotificationReceiver.java&quot;,&#10;    &quot;notification\WeatherNotificationManager.java&quot;,&#10;    &quot;notification\WeatherNotificationWorker.java&quot;,&#10;    &quot;ui\activities\ChartsActivity.java&quot;,&#10;    &quot;ui\activities\FavoriteCitiesActivity.java&quot;,&#10;    &quot;ui\activities\MainActivity.java&quot;,&#10;    &quot;ui\activities\OutfitSuggestionActivity.java&quot;,&#10;    &quot;ui\activities\SearchActivity.java&quot;,&#10;    &quot;ui\activities\SettingsActivity.java&quot;,&#10;    &quot;ui\activities\WeatherDetailsActivity.java&quot;,&#10;    &quot;ui\adapters\CityWeatherAdapter.java&quot;,&#10;    &quot;ui\adapters\OutfitSuggestionAdapter.java&quot;,&#10;    &quot;utils\BlurHelper.java&quot;,&#10;    &quot;utils\FavoriteCitiesManager.java&quot;,&#10;    &quot;utils\LocaleHelper.java&quot;,&#10;    &quot;utils\OutfitSuggestionService.java&quot;,&#10;    &quot;widget\WeatherWidget.java&quot;&#10;)&#10;&#10;$fixed = 0&#10;$failed = 0&#10;&#10;foreach ($file in $filesToFix) {&#10;    $fullPath = Join-Path $baseDir $file&#10;    &#10;    if (Test-Path $fullPath) {&#10;        try {&#10;            # Read content as UTF-8 (which includes BOM if present)&#10;            $content = Get-Content $fullPath -Raw -Encoding UTF8&#10;            &#10;            # Remove BOM character if present&#10;            if ($content[0] -eq [char]0xFEFF) {&#10;                $content = $content.Substring(1)&#10;            }&#10;            &#10;            # Write back without BOM&#10;            $utf8NoBom = New-Object System.Text.UTF8Encoding $false&#10;            [System.IO.File]::WriteAllText($fullPath, $content, $utf8NoBom)&#10;            &#10;            Write-Host &quot;Fixed: $file&quot; -ForegroundColor Green&#10;            $fixed++&#10;        }&#10;        catch {&#10;            Write-Host &quot;Failed: $file - $($_.Exception.Message)&quot; -ForegroundColor Red&#10;            $failed++&#10;        }&#10;    }&#10;    else {&#10;        Write-Host &quot;Not found: $file&quot; -ForegroundColor Yellow&#10;    }&#10;}&#10;&#10;Write-Host &quot;`n=== Summary ===&quot; -ForegroundColor Cyan&#10;Write-Host &quot;Fixed: $fixed files&quot; -ForegroundColor Green&#10;if ($failed -gt 0) {&#10;    Write-Host &quot;Failed: $failed files&quot; -ForegroundColor Red&#10;}&#10;&#10;Write-Host &quot;`nDone! Now rebuild your project in Android Studio:&quot; -ForegroundColor Yellow&#10;Write-Host &quot;  Build &gt; Clean Project&quot; -ForegroundColor White&#10;Write-Host &quot;  Build &gt; Rebuild Project&quot; -ForegroundColor White&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>